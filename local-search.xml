<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–(å†…å­˜æº¢å‡ºåç»­)</title>
    <link href="/2025/07/21/%E7%AE%97%E6%B3%95%E5%A4%8D%E6%9D%82%E5%BA%A6%E4%BC%98%E5%8C%96(%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E5%90%8E%E7%BB%AD)/"/>
    <url>/2025/07/21/%E7%AE%97%E6%B3%95%E5%A4%8D%E6%9D%82%E5%BA%A6%E4%BC%98%E5%8C%96(%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E5%90%8E%E7%BB%AD)/</url>
    
    <content type="html"><![CDATA[<h2 id="ğŸ“Š-ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–-å†…å­˜æº¢å‡ºåç»­">ğŸ“Š ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–(å†…å­˜æº¢å‡ºåç»­)</h2><p><strong>ğŸš¨ â€“ â€“ é—®é¢˜æè¿° â€“ â€“</strong><br>åœ¨åš<code>è®¾è®¡ç¨¿è½¬å¸ƒå±€ä»£ç </code>æ—¶ï¼Œé‡‡ç”¨çš„ä»»æ„ä¸ªæ•°å…ƒç´ å½¢æˆè‹¥å¹²ä¸ª<code>ç»„åˆ</code>çš„æ–¹å¼æ¥è¯†åˆ«å¸ƒå±€ã€‚åœ¨åš k=33 æ—¶ï¼Œä¹Ÿå°±æ˜¯ 3,262,623(çº¦ 326 ä¸‡)ä¸ªç»„åˆçš„æ—¶å€™ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºäº†ã€‚å› ä¸ºå ç”¨å†…å­˜æ¥è¿‘ 1Gã€‚<code>(8 * 33 + 32) * 3262623 = 992,637,392B = 969,372 KB = 946.7 MB = 0.92 GB</code>ã€‚è™½ç„¶å¯ä»¥ç”Ÿæˆä¸€ä¸ªç»„åˆå°±æ‰§è¡Œåˆ¤æ–­å¸ƒå±€ï¼Œä½†æ˜¯è¦éå†$2^n$ä¸ªç»„åˆï¼Œæ˜¯æŒ‡æ•°çº§çš„å¤æ‚åº¦ï¼Œå½“ n=39 æ—¶ï¼Œ æœ‰ 5497 äº¿ç§ç»„åˆï¼Œä¸€å° mac pro(8 æ ¸ 16G)è·‘ 326 ä¸‡æ¬¡è¦ 10 åˆ†é’Ÿä»¥ä¸Šã€‚æ‰€ä»¥åªèƒ½ä¿®æ”¹ç®—æ³•ï¼Œç›®å‰ç»„åˆçš„æ–¹å¼ï¼Œç”Ÿæˆç»„åˆçš„ç®—æ³•æ˜¯æŒ‡æ•°çº§ï¼Œæ˜¯æ— æ³•å†æ—¥å¸¸ç”Ÿäº§ä¸­è·‘çš„ã€‚</p><p><strong>ğŸ” â€“ â€“ é”™è¯¯ä¸­è¿›æ­¥ â€“ â€“</strong></p><ol><li><p><strong>ğŸ’­ æ€è€ƒï¼š</strong> ä¸€å¼€å§‹çš„æ€è·¯æ˜¯åœ¨æƒ³ï¼Œä¸æ˜¯æ¯ä¸ªç»„åˆéƒ½å¯èƒ½å½¢æˆå¸ƒå±€çš„ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸€äº›ç»„åˆå¾ˆæ˜æ˜¾ä¸€å®šä¸è¡Œå½¢æˆç»„åˆï¼Œé‚£ä¹ˆç¼©å°ç»„åˆçš„ä¸ªæ•°ï¼Œå°±èƒ½é™ä½ç®—æ³•å¤æ‚åº¦ï¼Œä¸ç”¨æšä¸¾æ‰€æœ‰çš„ç»„åˆã€‚</p></li><li><p><strong>ğŸ¯ å‘ç°ç‰¹å¾ï¼š</strong> åªæœ‰ç›¸é‚»çš„å…ƒç´ æ‰æœ‰å¯èƒ½å½¢æˆç»„åˆã€‚æŠŠç›¸é‚»çš„å…ƒç´ ä½¿ç”¨é“¾è¡¨è¿èµ·æ¥ï¼Œå…¶å®è¿™ç§å½¢å¼åœ¨æ•°æ®ç»“æ„ä¸Šå«<code>å·¥ç¨‹é‚»æ¥çŸ©é˜µ</code>,å¯ä»¥æŠŠç›¸é‚»å…³ç³»è¡¨è¾¾ä¸º<code>é‚»æ¥çŸ©é˜µ</code>ï¼Œå»éå†æ¯ä¸ªé‚»æ¥<code>è·¯å¾„</code>å°±è¡Œã€‚è®°å½•åœ¨å››ä¸ªæ–¹å‘ä¸Šé‚»æ¥çš„èŠ‚ç‚¹ï¼Œç„¶åæŠŠå…³ç³»è¡¨è¾¾ä¸ºé‚»æ¥çŸ©é˜µã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ğŸ”— é“¾çš„èŠ‚ç‚¹ç±»å‹</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChainNode</span> &#123;<br>  <span class="hljs-attr">value</span>: <span class="hljs-title class_">RelationalLayoutEntity</span> | <span class="hljs-title class_">LayoutBlock</span>;<br>  <span class="hljs-attr">block</span>: <span class="hljs-title class_">Block</span>;<br>  <span class="hljs-attr">index</span>?: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">top</span>: <span class="hljs-title class_">ChainNode</span>[]; <span class="hljs-comment">// ä¸Šæ–¹çš„é‚»æ¥node</span><br>  <span class="hljs-attr">bottom</span>: <span class="hljs-title class_">ChainNode</span>[]; <span class="hljs-comment">// ä¸‹æ–¹çš„é‚»æ¥node</span><br>  <span class="hljs-attr">left</span>: <span class="hljs-title class_">ChainNode</span>[]; <span class="hljs-comment">// å·¦è¾¹çš„é‚»æ¥node</span><br>  <span class="hljs-attr">right</span>: <span class="hljs-title class_">ChainNode</span>[]; <span class="hljs-comment">// å³è¾¹çš„é‚»æ¥node</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>ğŸŒ æ¢ç´¢é‚»æ¥çŸ©é˜µï¼š</strong><br>é‚»æ¥çŸ©é˜µï¼Œæœ¬èº«æ˜¯ä¸€ç§å›¾å…³ç³»ï¼Œåˆ†ä¸ºå¥½å‡ ç§ï¼šæœ‰å‘å›¾(å•å‘å°±æ˜¯ä¸€æ¡è·¯å¾„)ã€æ— å‘å›¾(A å’Œ B ç›¸è¿ï¼Œåªæ˜¯ä¸€æ¡è·¯å¾„)ã€è¿é€šå›¾(ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½å­˜åœ¨è·¯å¾„) ã€ éè¿é€šå›¾(å­˜åœ¨æ— æ³•åˆ°è¾¾çš„èŠ‚ç‚¹ï¼Œå›¾è¢«åˆ†ä¸ºå¤šä¸ªè¿é€šåˆ†é‡)ã€å®Œå…¨å›¾(ä»»æ„ä¸¤ä¸ªä¸åŒèŠ‚ç‚¹éƒ½æœ‰è¾¹è¿æ¥)ã€æ ‘ (è¿é€šçš„æ— ç¯æ— å‘å›¾ï¼Œn ä¸ªèŠ‚ç‚¹æœ‰ n-1 æ¡è¾¹)ã€æœ‰å‘æ— ç¯å›¾(ä» A å‘å‡ºï¼Œæ€ä¹ˆèµ°éƒ½èµ°ä¸åˆ° A)ã€æœ‰å‘æœ‰ç¯å›¾(ä» A ç»•ä¸€åœˆï¼Œè¿˜èƒ½èµ°åˆ° A).è™½ç„¶æœ‰è¿™ä¹ˆå¤šç§ï¼Œä½†æ˜¯éå†æ–¹æ³•å°±ä¸€ç§ï¼Œåªè¦ä½¿ç”¨é‚»æ¥çŸ©é˜µï¼Œé‚£ä¹ˆå°±ä¸€ç§éå†æ–¹æ³•ï¼Œå¦‚ä¸‹(enumerateAllSimplePaths):<br>ğŸ“Š é‚»æ¥çŸ©é˜µï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ğŸ”¢ é‚»æ¥çŸ©é˜µæ•°æ®ç»“æ„</span><br><span class="hljs-keyword">const</span> adjMatrix = [<br>  <span class="hljs-comment">// 1  2  3  4  5</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>], <span class="hljs-comment">// 1</span><br>  [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], <span class="hljs-comment">// 2</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], <span class="hljs-comment">// 3</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], <span class="hljs-comment">// 4</span><br>  [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], <span class="hljs-comment">// 5</span><br>];<br></code></pre></td></tr></table></figure><p>ğŸ”„ éå†é‚»æ¥çŸ©é˜µï¼š</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xquery">  <span class="hljs-keyword">function</span> enumerateAllSimplePaths(adjMatrix:<span class="hljs-built_in"> number</span>[][]):<span class="hljs-built_in"> number</span>[][] &#123;<br>    const n = adjMatrix.length;<br>    const results:<span class="hljs-built_in"> number</span>[][] = [];<br>    const visited:<span class="hljs-built_in"> boolean</span>[] = new Array(n).fill<span class="hljs-built_in">(false</span>);<br><br>  <span class="hljs-keyword">function</span> dfs(current:<span class="hljs-built_in"> number</span>, target:<span class="hljs-built_in"> number</span>,<span class="hljs-built_in"> path</span>:<span class="hljs-built_in"> number</span>[]) &#123;<br>    <span class="hljs-keyword">if</span> (current === target) &#123;<br>      results.push([..<span class="hljs-built_in">.path</span>]);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    visited[current] =<span class="hljs-built_in"> true</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-keyword">next</span> = <span class="hljs-number">0</span>; <span class="hljs-keyword">next</span> &lt; n; <span class="hljs-keyword">next</span>++) &#123;<br>      <span class="hljs-keyword">if</span> (adjMatrix[current][<span class="hljs-keyword">next</span>] === <span class="hljs-number">1</span> &amp;&amp; !visited[<span class="hljs-keyword">next</span>]) &#123;<br>       <span class="hljs-built_in"> path</span>.push(<span class="hljs-keyword">next</span>);<br>        dfs(<span class="hljs-keyword">next</span>, target,<span class="hljs-built_in"> path</span>);<br>       <span class="hljs-built_in"> path</span>.pop();<br>      &#125;<br>    &#125;<br>    visited[current] =<span class="hljs-built_in"> false</span>;<br>  &#125;<br><br>  /**<br>   * æšä¸¾æ‰€æœ‰ (i, j) é¡¶ç‚¹å¯¹ï¼Œi &lt; j ä¿è¯ä¸é‡å¤<br>   * i æ˜¯èµ·ç‚¹<br>   * j æ˜¯ç»ˆç‚¹ï¼ˆç›®æ ‡ï¼‰<br>   *<span class="hljs-built_in"> path</span> æ˜¯å½“å‰å·²ç»èµ°è¿‡çš„è·¯å¾„ï¼ˆèµ·å§‹åªæœ‰ [i]ï¼‰<br>   */<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i + <span class="hljs-number">1</span>; j &lt; n; j++) &#123;<br>      dfs(i, j, [i]);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> results;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç®—æ³•çš„ç¥å¥‡ä¹‹å¤„å°±æ˜¯å¯¹ä¸åŒçš„ç§ç±»çš„å›¾ï¼Œå¾—å‡ºæ¥çš„æ—¶é—´å¤æ‚åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œé’ˆå¯¹æœ‰å‘æœ‰ç¯å›¾ï¼Œæ—¶é—´å¤æ‚åº¦æ™®é€šæƒ…å†µæ˜¯å¤šé¡¹å¼çº§åˆ«çš„ï¼Œæœ€åçš„æ˜¯ n^2 * 2^nï¼Œè™½ç„¶é™ä½äº†æ—¶é—´å¤æ‚åº¦ï¼Œä½†æ˜¯å¿…ç„¶é¿å…ä¸äº†æœ€æ¬¢çš„æƒ…å†µã€‚æ‰€ä»¥ä¸¢å¼ƒäº†è¿™ä¸ªæ–¹æ¡ˆã€‚åŒæ—¶ä¹Ÿæ¢ç´¢äº† SCC åˆ†æ²»æ–¹æ³•ç­‰å…¶ä»–æšä¸¾ç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿéƒ½å¾ˆé«˜ï¼Œå¹¶ä¸”å¾ˆè·¯å¾„æ•°é‡æ˜¯å¼ºç›¸å…³çš„ã€‚</p></li></ol><p><strong>âœ¨ â€“ â€“ è§£å†³æ–¹æ¡ˆ â€“ â€“</strong><br>ğŸ¯ è°ƒæ•´æ€è·¯ï¼Œèƒ½è¢«æ”¾åœ¨ä¸€èµ·è¯†åˆ«å¸ƒå±€çš„ï¼Œä¸€å®šæ˜¯è¢«ä¸€ä¸ªå¤–æ¥çŸ©å½¢æ¡†åŒ…å«çš„ï¼Œé—®é¢˜ä¹Ÿå°±è½¬æ¢æˆåªè¦æšä¸¾å‡ºæ‰€æœ‰çš„<code>åŒ…å«ä»»æ„ä¸ªæ•°å…ƒç´ çŸ©å½¢æ¡†</code>å°±è¡Œäº†ï¼Œæšä¸¾å‡ºæ‰€æœ‰çš„åŒ…å«çŸ©å½¢æ¡†,å¯ä»¥ä½¿ç”¨è®¡ç®—ä»»æ„ä¸¤ä¸ªå…ƒç´ çš„å¤–æ¥çŸ©å½¢æ¡†ï¼Œç„¶åå»é‡å°±è¡Œäº†ã€‚æ—¶é—´å¤æ‚åº¦ä¹Ÿå°±æ˜¯ n^2,å½“ç„¶è¿˜æœ‰å…¶ä»–çš„æ¡ä»¶é™åˆ¶å¤–æ¥çŸ©å½¢èƒ½ä¸èƒ½æˆç«‹ï¼Œæœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦æ˜¯ n^3.ä¸‹é¢æ˜¯ä¼ªä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">enumerateRectangleCombinations</span>(<span class="hljs-params"></span><br><span class="hljs-params">  entity: Entity <span class="hljs-comment">// åŒ…å«æ‰€æœ‰å®½é«˜ä¿¡æ¯ï¼Œä»¥åŠå”¯ä¸€æ ‡è¯†</span></span><br><span class="hljs-params"></span>)&#123;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; entity.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i + <span class="hljs-number">1</span>; j &lt; entity.<span class="hljs-property">length</span>; j++) &#123;<br>      <span class="hljs-keyword">const</span> node1 = entity[i];<br>      <span class="hljs-keyword">const</span> node2 = entity[j];<br><br>      <span class="hljs-comment">// è®¡ç®—ä¸¤ä¸ªèŠ‚ç‚¹å½¢æˆçš„çŸ©å½¢è¾¹ç•Œ</span><br>      <span class="hljs-keyword">const</span> rectangleBounds = <span class="hljs-title function_">calculateRectangleBounds</span>(node1, node2);<br><br>      <span class="hljs-comment">// æ‰¾å‡ºå®Œå…¨åŒ…å«åœ¨çŸ©å½¢å†…çš„æ‰€æœ‰èŠ‚ç‚¹</span><br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">containedNodes</span>: <span class="hljs-title class_">Entity</span>[] = [];<br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">containedIndices</span>: number[] = [];<br><br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-title class_">Entity</span>.<span class="hljs-property">length</span>; k++) &#123;<br>        <span class="hljs-keyword">const</span> node = <span class="hljs-title class_">Entity</span>[k];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNodeContainedInRectangle</span>(node, rectangleBounds)) &#123;<br>          containedNodes.<span class="hljs-title function_">push</span>(node);<br>          containedIndices.<span class="hljs-title function_">push</span>(k);<br>        &#125;<br>      &#125;<br><br>      <span class="hljs-comment">// æ£€æŸ¥çŸ©å½¢èƒ½ä¸èƒ½æˆç«‹</span><br>      <span class="hljs-keyword">let</span> flag = <span class="hljs-literal">false</span>;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span>; k &lt; entityOrBlockSet.<span class="hljs-property">length</span>; k++) &#123;<br>        <span class="hljs-keyword">const</span> node = entityOrBlockSet[k];<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isNodeIntersectingWithRectangle</span>(node, rectangleBounds)) &#123;<br>          flag = <span class="hljs-literal">true</span>;<br>          <span class="hljs-keyword">break</span>;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆåŠŸå°†æŒ‡æ•°çº§çš„æ—¶é—´å¤æ‚åº¦é™åˆ° n^3ï¼Œæ’’èŠ± ğŸ‰ã€‚</p><h2 id="ğŸ“-æ€»ç»“">ğŸ“ æ€»ç»“</h2><p>ğŸ’¡ ä¼˜åŒ–ç®—æ³•å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p><ol><li>é€šè¿‡ä¼˜åŒ–<strong>æ‘†å¼„</strong><code>æŠ½è±¡çš„å®ç‰©</code>çš„æ–¹å¼æ¥ä½¿<strong>æ‘†å¼„</strong>çš„æ¬¡æ•°å°‘</li><li>åœ¨è§£å†³é—®é¢˜ä¸Šé¢ï¼Œå‡å°‘å¯èƒ½æ€§æ–¹æ¡ˆçš„æ•°é‡</li></ol><p>ğŸ”¥ ä»Šå¤©å¯¹ç¬¬ 2 æ¡æ„Ÿå—å¾ˆæ·±ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>nodejs</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>nodejs å†…å­˜æº¢å‡º</title>
    <link href="/2025/07/05/nodejs%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA/"/>
    <url>/2025/07/05/nodejs%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="ğŸ’¾-nodejs-å†…å­˜æº¢å‡º">ğŸ’¾ nodejs å†…å­˜æº¢å‡º</h2><p>åœ¨åš<code>è®¾è®¡ç¨¿è½¬å¸ƒå±€ä»£ç </code>æ—¶ï¼Œé‡‡ç”¨çš„ä»»æ„ä¸ªæ•°å…ƒç´ å½¢æˆè‹¥å¹²ä¸ª<code>ç»„åˆ</code>çš„æ–¹å¼æ¥è¯†åˆ«å¸ƒå±€ï¼Œç”±äºç»„åˆçš„ä¸ªæ•°è¿‡å¤šï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œç¨‹åºå´©æºƒã€‚<br><img src="/img/heap_out_of_memory.jpg" alt="å†…å­˜æº¢å‡ºæˆªå›¾"><br>ğŸ“Š <strong>â€“ â€“ å›é¡¾ç»„åˆ â€“ â€“</strong></p><p>ä» $n$ ä¸ªä¸åŒå…ƒç´ é‡Œï¼Œå–å‡º $k$ ä¸ªå…ƒç´ ï¼Œä¸è€ƒè™‘é¡ºåºï¼Œå¾—åˆ°çš„é›†åˆç§°ä¸º <strong>ç»„åˆ</strong>ã€‚</p><p>å…¬å¼ï¼š</p><p>$$<br>C(n, k) = \binom{n}{k} = \frac{n!}{k! \cdot (n-k)!}<br>$$</p><p>ğŸ“ ä¾‹å­ï¼š<br>ä» $[A,B,C]$ ä¸­å– 2 ä¸ªå…ƒç´ çš„ç»„åˆæ˜¯ï¼š</p><ul><li>$[A,B]$</li><li>$[A,C]$</li><li>$[B,C]$</li></ul><p>æ‰€æœ‰ç»„åˆæ•°ä¹‹å’Œæ˜¯ï¼š</p><p>$$<br>\sum_{k=0}^{n} C(n,k) = 2^n<br>$$</p><p>âš ï¸ <strong>â€“ â€“ å›å¿†é—®é¢˜ â€“ â€“</strong></p><p>å¦‚æœ n = 39 çš„è¯ï¼Œè¦ç”Ÿæˆæ‰€æœ‰<code>ç»„åˆ</code>, ä¸€å…±æœ‰ 5497 äº¿ç§ç»„åˆï¼Œnodejs ç¨‹åºä¾èµ– v8 çš„å†…å­˜åˆ†é…ï¼Œä¸€èˆ¬é»˜è®¤åªæœ‰ 1G ~ 2G è¿è¡Œå†…å­˜ï¼Œåœ¨åš k=33 æ—¶ï¼Œä¹Ÿå°±æ˜¯ 3,262,623(çº¦ 326 ä¸‡)ä¸ªç»„åˆçš„æ—¶å€™ï¼Œå†…å­˜å¢é•¿äº†<code>1673.96MB</code>ï¼Œç„¶åå°±å†…å­˜æº¢å‡ºäº†ã€‚</p><p>$$<br>\sum_{k=0}^{n} C(n,k) = 2^n = 549755813888<br>$$</p><p>ğŸ—ºï¸ ç®€å•ä¼°ç®—ä¸€ä¸‹ä¸€ä¸ªæ•°å­—å‹çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯<code>number[]</code>ç±»å‹æ•°æ®ï¼Œå æ®å¤šå°‘å†…å­˜ã€‚</p><p>ğŸ”¢ <strong>javascript æ•°å­—å­˜å‚¨æ–¹å¼</strong></p><p>åœ¨ JavaScript ä¸­ï¼Œæ‰€æœ‰æ•°å­—éƒ½æ˜¯ä»¥ IEEE 754 åŒç²¾åº¦æµ®ç‚¹æ•°(64 ä½)æ ¼å¼å­˜å‚¨çš„ï¼Œç†è®ºä¸Šæ¯ä¸ªæ•°å­—å ç”¨ <code>8å­—èŠ‚</code>ã€‚<br><code>[ ç¬¦å·ä½ 1 ] [ æŒ‡æ•° 11 ] [ å°¾æ•° 52 ]</code></p><p>âš¡ &gt; v8 å¯¹ SMI (Small Integer) è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯¹äºèŒƒå›´åœ¨ -2^30 åˆ° 2^30-1 ä¹‹é—´çš„æ•´æ•°ï¼ŒSMI ç›´æ¥å­˜å‚¨åœ¨æŒ‡é’ˆä¸­ï¼Œä¸éœ€è¦é¢å¤–çš„å †å†…å­˜åˆ†é…ã€‚åœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼ŒSMI å ç”¨ 8 å­—èŠ‚ï¼ˆåŒ…å«æ ‡è®°ä½ï¼‰</p><p>ğŸ“¦ <strong>javascript æ•°ç»„å­˜å‚¨æ–¹å¼(Fast SMI Elements)</strong></p><blockquote><p>å¦‚æœæ•°ç»„é‡Œéƒ½æ˜¯ 32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆSMI, Small Integerï¼‰ï¼ŒV8 ä¼šç›´æ¥ç”¨ç´§å‡‘çš„æ–¹å¼å­˜å‚¨è¿™äº›æ•´æ•°ã€‚å†…å­˜é‡Œæ˜¯ è¿ç»­çš„æ•´æ•°å­˜å‚¨ï¼Œå‡ ä¹ç­‰ä»·äº C++ çš„ int[]ã€‚</p></blockquote><p>å­˜å‚¨ç»“æ„ï¼š<code>arr -&gt; [ 1 | 2 | 3 | 4 ]</code><br>å¯¹è±¡å¤´éƒ¨ï¼šçº¦ 24-32 å­—èŠ‚ï¼ˆåŒ…å«ç±»å‹ä¿¡æ¯ã€å±æ€§æ˜ å°„ç­‰ï¼‰<br>length å±æ€§ï¼šå¦‚æœæ˜¯ SMIï¼Œä¸å ç”¨é¢å¤–å †å†…å­˜<br>Elements æ•°ç»„ï¼šå­˜å‚¨å®é™…å…ƒç´ çš„è¿ç»­å†…å­˜å—</p><p>å‡è®¾æœ‰ä¸€ä¸ªåŒ…å« n ä¸ªå°æ•´æ•°çš„å¯†é›†æ•°ç»„ï¼š<code>const arr = [1, 2, 3, 4, 5];</code><br>å†…å­˜å ç”¨çº¦ä¸ºï¼š</p><ul><li>æ•°ç»„å¯¹è±¡å¼€é”€ï¼š~32 å­—èŠ‚</li><li>5 ä¸ª SMI æ•´æ•°ï¼š5 Ã— 8 å­—èŠ‚ = 40 å­—èŠ‚</li><li>æ€»è®¡ï¼š~72 å­—èŠ‚</li></ul><p>ğŸ§® <strong>è®¡ç®— n=39ï¼Œk=33 æ—¶æ‰€æœ‰ç»„åˆçš„å†…å­˜å¤§å°</strong><br>å¸¦å…¥æ‰€æœ‰æ•°å­—è®¡ç®—ï¼š<br><code>(8 * 33 + 32) * 3262623 = 992,637,392B = 969,372 KB = 946.7 MB = 0.92 GB</code></p><p>ä¹Ÿå°±æ˜¯å•çº¯è¿™äº›æ•°å­—æ•°å­—ï¼Œå°±æœ‰æ¥è¿‘ 1Gï¼Œåœ¨æˆ‘çš„ç¨‹åºä¸­è¿˜æœ‰å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ï¼Œå†…å­˜å¢é•¿äº†<code>1673.96MB</code>ï¼Œè¶…å‡ºäº†å†…å­˜ã€‚</p><h2 id="ğŸ’¡-è§£å†³æ–¹æ¡ˆ">ğŸ’¡ è§£å†³æ–¹æ¡ˆ</h2><p>ä¸æ”¶é›†æ‰€æœ‰ç»„åˆï¼Œæ¯ä¸€æ¬¡ç”Ÿæˆç»„åˆå°±å»æ‰§è¡Œåç»­é€»è¾‘ï¼Œè€Œä¸æ˜¯æŠŠæ‰€æœ‰ç»„åˆéƒ½æ”¾åœ¨ä¸€ä¸ªå¤§æ•°ç»„é‡Œ(<code>[ç»„åˆ1ï¼Œç»„åˆ2ï¼Œ...æ‰€æœ‰ç»„åˆ]</code>),å†é€šè¿‡éå†çš„æ–¹å¼å»æ‰§è¡Œåç»­é€»è¾‘ã€‚âš ï¸ ä½†æ˜¯è¿™æ ·æœ‰æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿™ä¹ˆå¤šä¸ªç»„åˆ(5497 äº¿)ï¼Œè¿™ç§è®¡ç®—é‡çº§ï¼Œä¸æ˜¯ä¸€ä¸ªæ™®é€šæœåŠ¡å™¨èƒ½è·‘å®Œçš„ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ç”¨ mac pro(8 æ ¸ 16G)å¯åŠ¨ï¼Œè·‘ 326 ä¸‡ä¸ªç»„åˆè¦ <code>10åˆ†é’Ÿ</code>ä»¥ä¸Šã€‚æ‰€ä»¥ä¹Ÿå°±åªèƒ½ä¼˜åŒ–ç®—æ³•ï¼Œæ²¡é”™åé¢ä¸€ç¯‡æ˜¯è®²è¿°æˆ‘ä¼˜åŒ–ç®—æ³•çš„ç»å†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>nodejs</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>éƒ¨ç½²paddlex,è¯†åˆ«æ–‡å­—</title>
    <link href="/2025/06/15/ocr/%E9%83%A8%E7%BD%B2paddlex,%E8%AF%86%E5%88%AB%E6%96%87%E5%AD%97/"/>
    <url>/2025/06/15/ocr/%E9%83%A8%E7%BD%B2paddlex,%E8%AF%86%E5%88%AB%E6%96%87%E5%AD%97/</url>
    
    <content type="html"><![CDATA[<h2 id="ç›´æ¥éƒ¨ç½²-paddlex">ç›´æ¥éƒ¨ç½² paddlex</h2><ol><li><p><code>docker pull ccr-2vdh3abv-pub.cnc.bj.baidubce.com/paddlex/paddlex:paddlex3.0.1-paddlepaddle3.0.0-cpu</code></p></li><li><p>åˆ›å»ºå®¹å™¨å¹¶è¿›å¦‚ç»ˆç«¯ï¼šç¬¬ä¸€ä¸ªæ˜¯ M1 èŠ¯ç‰‡çš„ macï¼Œç¬¬äºŒä¸ªäº‹ linux x86</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -it --name paddlex-server <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  --platform linux/amd64 <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  -v $PWD:/paddle <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  --shm-size=<span class="hljs-number">8</span>g <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  -p <span class="hljs-number">5001</span>:<span class="hljs-number">5001</span> <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  ccr-<span class="hljs-number">2</span>vdh3abv-pub.cnc.bj.baidubce.com/paddlex/paddlex:paddlex3.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>-paddlepaddle3.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>-cpu <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  /bin/bash<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -it --name paddlex-server <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  -v $PWD:/paddle <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  --shm-size=<span class="hljs-number">8</span>g <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  -p <span class="hljs-number">5001</span>:<span class="hljs-number">5001</span> <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  ccr-<span class="hljs-number">2</span>vdh3abv-pub.cnc.bj.baidubce.com/paddlex/paddlex:paddlex3.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>-paddlepaddle3.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>-cpu <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  /bin/bash<br></code></pre></td></tr></table></figure></li><li><p>åœ¨å®¹å™¨é‡Œé¢å®‰è£… API æœåŠ¡åŒ…ï¼š<code>paddlex --install serving</code></p></li><li><p>å®‰è£…ä¾èµ–ï¼š<code>pip3 install &quot;paddlex[ocr]==3.0.1&quot;</code></p></li><li><p>å¯åŠ¨æœåŠ¡ï¼š<code>paddlex --serve --pipeline OCR --port 5001</code></p></li><li><p>æ­¥éª¤ 5 è¿™ç§å¯åŠ¨ä¼šå¯¼è‡´ç»“æŸè¿›ç¨‹ï¼Œpaddlex æœåŠ¡å°±ä¸åœ¨äº†ã€‚<code>docker exec -it 6d087391d28e /bin/bash -c &quot;nohup paddlex --serve --pipeline OCR --host 0.0.0.0 --port 5001&quot;</code>æˆ–æœ‰æ—¥å¿—ï¼š<code>docker exec -it 6d087391d28e /bin/bash -c &quot;nohup paddlex --serve --pipeline OCR --host 0.0.0.0 --port 5001 &gt; serve.log 2&gt;&amp;1 &amp;&quot;</code> 6d087391d28e æ˜¯å®¹å™¨åå­—ã€‚</p></li><li><p>æµ‹è¯•æ¥å£:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp">curl -X POST http:<span class="hljs-comment">//localhost:5001/ocr \</span><br><span class="hljs-comment">-H &quot;Content-Type: application/json&quot; \</span><br><span class="hljs-comment">-d &#x27;&#123;</span><br><span class="hljs-string">&quot;file&quot;</span>: <span class="hljs-string">&quot;https://imagev2.xmcdn.com/storages/ef1b-audiofreehighqps/A9/E5/GKwRIRwMIDZVAAAU8APGHO9Z.png&quot;</span>,<br><span class="hljs-string">&quot;fileType&quot;</span>: <span class="hljs-number">1</span>,<br><span class="hljs-string">&quot;useDocOrientationClassify&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;useDocUnwarping&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;useTextlineOrientation&quot;</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;textDetLimitSideLen&quot;</span>: <span class="hljs-number">736</span>,<br><span class="hljs-string">&quot;textDetLimitType&quot;</span>: <span class="hljs-string">&quot;min&quot;</span>,<br><span class="hljs-string">&quot;textDetThresh&quot;</span>: <span class="hljs-number">0.4</span>,<br><span class="hljs-string">&quot;textDetBoxThresh&quot;</span>: <span class="hljs-number">0.5</span>,<br><span class="hljs-string">&quot;textDetUnclipRatio&quot;</span>: <span class="hljs-number">1.8</span>,<br><span class="hljs-string">&quot;textRecScoreThresh&quot;</span>: <span class="hljs-number">0.5</span><br>&#125;&#x27;<br></code></pre></td></tr></table></figure></li></ol><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs scilab">curl -X POST http:<span class="hljs-comment">//localhost:5001/ocr \</span><br> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \<br> -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">&quot;</span>file<span class="hljs-string">&quot;: &quot;</span>https:<span class="hljs-comment">//imagev2.xmcdn.com/storages/ef1b-audiofreehighqps/A9/E5/GKwRIRwMIDZVAAAU8APGHO9Z.png&quot;,</span><br> <span class="hljs-string">&quot;returnVisualize&quot;</span>: false<br>&#125;<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">curl -X POST http://127.0.0.1:5001/ocr \</span><br><span class="hljs-string"> -H &quot;</span>Content-Type: application/json<span class="hljs-string">&quot; \</span><br><span class="hljs-string"> -d &#x27;</span>&#123;<br><span class="hljs-string">&quot;file&quot;</span>: <span class="hljs-string">&quot;https://imagev2.xmcdn.com/storages/ef1b-audiofreehighqps/A9/E5/GKwRIRwMIDZVAAAU8APGHO9Z.png&quot;</span><br>&#125;<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">curl -X POST https://www.qunyangbang.cn/ocr/ocr \</span><br><span class="hljs-string"> -H &quot;</span>Content-Type: application/json<span class="hljs-string">&quot; \</span><br><span class="hljs-string"> -d &#x27;</span>&#123;<br><span class="hljs-string">&quot;file&quot;</span>: <span class="hljs-string">&quot;https://imagev2.xmcdn.com/storages/ef1b-audiofreehighqps/A9/E5/GKwRIRwMIDZVAAAU8APGHO9Z.png&quot;</span>,<br><span class="hljs-string">&quot;hideOCRImage&quot;</span>: true,<br><span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">1</span><br>&#125;<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">curl -X &#x27;</span>GET&#x27; \<br> <span class="hljs-string">&#x27;http://localhost:5001/health&#x27;</span> \<br> -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span><br><br></code></pre></td></tr></table></figure><ol start="8"><li><p>ä¿®æ”¹ä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¢åŠ æ¥å£å‚æ•°<code>hideOCRImage</code>ï¼Œæ§åˆ¶æ¥å£è¿”å›å­—æ®µã€‚(æ–‡ä»¶åœ°å€ï¼š<code>/var/lib/docker/overlay2/c625c7c4a365d03b3ddd293b65d01d572538b8e23bd8136ae9a54451af3cba81/merged/root/PaddleX</code>)<br><code>paddlex/inference/serving/basic_serving/_pipeline_apps/ocr.py</code></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># æ ¹æ® hideOCRImage å­—æ®µå†³å®šæ˜¯å¦åŒ…å«æ‰€æœ‰å›¾åƒå­—æ®µ</span><br>result_dict = &#123;<span class="hljs-string">&quot;prunedResult&quot;</span>: pruned_res&#125;<br><br><span class="hljs-comment"># åªæœ‰å½“ hideOCRImage ä¸ä¸º True æ—¶æ‰åŒ…å«æ‰€æœ‰å›¾åƒå­—æ®µ</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.hideOCRImage:<br>    result_dict[<span class="hljs-string">&quot;ocrImage&quot;</span>] = imgs.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;ocr_img&quot;</span>)<br>    result_dict[<span class="hljs-string">&quot;docPreprocessingImage&quot;</span>] = imgs.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;doc_preprocessing_img&quot;</span>)<br>    result_dict[<span class="hljs-string">&quot;inputImage&quot;</span>] = imgs.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;input_img&quot;</span>)<br><br>ocr_results.append(result_dict)<br><br></code></pre></td></tr></table></figure><p><code>paddlex/inference/serving/schemas/ocr.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">InferRequest</span>(ocr.BaseInferRequest):<br>    useDocOrientationClassify: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">bool</span>] = <span class="hljs-literal">None</span><br>    useDocUnwarping: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">bool</span>] = <span class="hljs-literal">None</span><br>    useTextlineOrientation: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">bool</span>] = <span class="hljs-literal">None</span><br>    textDetLimitSideLen: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">int</span>] = <span class="hljs-literal">None</span><br>    textDetLimitType: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span><br>    <span class="hljs-comment"># Better to use &quot;threshold&quot;? Be consistent with the pipeline API though.</span><br>    textDetThresh: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span><br>    textDetBoxThresh: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span><br>    textDetUnclipRatio: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span><br>    textRecScoreThresh: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span><br>    hideOCRImage: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">bool</span>] = <span class="hljs-literal">None</span> <span class="hljs-comment"># è¿™è¡Œ</span><br><br></code></pre></td></tr></table></figure></li></ol><h3 id="nginx-é…ç½®">nginx é…ç½®</h3><p>ä¸»è¦æ˜¯è®¿é—®çš„æ—¶å€™å¢åŠ /ocr å‰ç¼€ï¼Œåœ¨ nginx è¿™é‡Œå»æ‰</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /ocr &#123;<br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/ocr/(.*)$</span> /<span class="hljs-variable">$1</span> <span class="hljs-literal">break</span>;<br>    <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:5001/;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="æŠ¥é”™">æŠ¥é”™</h3><ol><li>è®¿é—®/docs æ¥å£æ¥çœ‹æ–‡æ¡£ï¼ŒæŠ¥é”™ï¼š<br><img src="./image.png" alt="image"><br>è§£å†³ï¼šé™ä½ serving ç‰ˆæœ¬ï¼Œ<code>pip install &quot;paddlex[serving]==3.0.0&quot;</code></li></ol><h3 id="å‚è€ƒ">å‚è€ƒ</h3><ol><li>paddlex æ–‡æ¡£ï¼š<a href="https://paddlepaddle.github.io/PaddleX/latest/index.html">https://paddlepaddle.github.io/PaddleX/latest/index.html</a></li><li>paddlex æœ¬åœ°å®‰è£…ï¼š<a href="https://paddlepaddle.github.io/PaddleX/latest/installation/installation.html">https://paddlepaddle.github.io/PaddleX/latest/installation/installation.html</a></li><li>PaddleX æœåŠ¡åŒ–éƒ¨ç½²æŒ‡å—ï¼š<a href="https://paddlepaddle.github.io/PaddleX/latest/pipeline_deploy/serving.html">https://paddlepaddle.github.io/PaddleX/latest/pipeline_deploy/serving.html</a></li><li>paddlepaddle å®‰è£…ï¼š<a href="https://www.paddlepaddle.org.cn/install/quick?docurl=/documentation/docs/zh/install/docker/macos-docker.html">https://www.paddlepaddle.org.cn/install/quick?docurl=/documentation/docs/zh/install/docker/macos-docker.html</a></li><li>PaddlePaddle docker é•œåƒå®‰è£…ï¼š<a href="https://www.paddlepaddle.org.cn/documentation/docs/zh/install/docker/linux-docker.html#anchor-0">https://www.paddlepaddle.org.cn/documentation/docs/zh/install/docker/linux-docker.html#anchor-0</a></li><li>PaddleOCR æœ¬åœ°å®‰è£…ï¼Œæœ¬åœ°å¼€å‘ï¼š<a href="https://paddlepaddle.github.io/PaddleOCR/latest/version3.x/installation.html">https://paddlepaddle.github.io/PaddleOCR/latest/version3.x/installation.html</a></li><li>PP-StructureV3 äº§çº¿ä½¿ç”¨æ•™ç¨‹ï¼š<a href="https://paddlepaddle.github.io/PaddleOCR/latest/version3.x/pipeline_usage/PP-StructureV3.html">https://paddlepaddle.github.io/PaddleOCR/latest/version3.x/pipeline_usage/PP-StructureV3.html</a></li><li>å•å­—åæ ‡è¿”å›ï¼š<a href="https://github.com/PaddlePaddle/PaddleOCR/pull/10515">https://github.com/PaddlePaddle/PaddleOCR/pull/10515</a><ul><li><code> --return_word_box=True</code>å‚æ•°</li></ul></li></ol><h2 id="å‘½ä»¤å‚è€ƒ">å‘½ä»¤å‚è€ƒ</h2><ol><li><p>æ­å»º dockerï¼š<a href="https://cloud.tencent.com/document/product/213/46000#azYB6haoacR0zO9ry1cHx">https://cloud.tencent.com/document/product/213/46000#azYB6haoacR0zO9ry1cHx</a></p><ol><li><code>sudo yum install docker -y</code></li><li><code>sudo systemctl start docker</code></li><li><code>sudo docker info</code></li></ol></li><li><p>ä½¿ç”¨ docker å®‰è£… paddleOCRï¼š<a href="https://www.paddlepaddle.org.cn/documentation/docs/zh/install/docker/linux-docker.html#anchor-0">å‚è€ƒ 1</a>;<a href="https://www.paddlepaddle.org.cn/install/quick?docurl=/documentation/docs/zh/install/docker/linux-docker.html">å‚è€ƒ 2</a></p><ol><li>æ‹‰å–é¢„å®‰è£… PaddlePaddle çš„é•œåƒï¼š<code>docker pull ccr-2vdh3abv-pub.cnc.bj.baidubce.com/paddlepaddle/paddle:3.0.0</code></li><li>ç”¨é•œåƒæ„å»ºå¹¶è¿›å…¥ Docker å®¹å™¨ï¼š<code>docker run --name paddle -it -v $PWD:/paddle ccr-2vdh3abv-pub.cnc.bj.baidubce.com/paddlepaddle/paddle:3.0.0 /bin/bash</code><ol><li>ç¬¬äºŒæ¬¡ç›´æ¥è¿›å…¥å®¹å™¨ï¼š<code>docker exec -it paddlex-server /bin/bash</code></li><li>æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼š<code>docker ps -a</code></li><li>æŸ¥çœ‹æ‰€æœ‰é•œåƒï¼š<code>docker images</code></li><li>åœæ­¢å®¹å™¨è¿è¡Œï¼š<code>docker stop paddle</code></li><li>åˆ é™¤å®¹å™¨ï¼š<code>docker rm paddle</code></li><li>åˆ é™¤é•œåƒï¼š<code>docker rmi a5d1b6184e99</code></li><li>åˆ é™¤æ‰€æœ‰é•œåƒï¼š<code>docker rmi $(docker images -q)</code></li><li>å¯åŠ¨å®¹å™¨ï¼š<code> docker start paddle_server</code></li><li>æŸ¥çœ‹å®¹å™¨æ˜ å°„å®¿ä¸»æœºçš„è·¯å¾„ï¼š<code>docker inspect paddlex-server</code></li><li>æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹ idï¼š<code>ps aux | grep &quot;paddlex --serve&quot;</code></li></ol></li><li>åœ¨å®¹å™¨ä¸­ä¸‹è½½ PaddleOCR æºç ï¼š<code>git clone https://github.com/PaddlePaddle/PaddleOCR.git</code>æˆ–è€… gitee çš„ä»“åº“ï¼š<code>git clone https://gitee.com/paddlepaddle/PaddleOCR</code></li><li>è¿›å…¥é¡¹ç›®ï¼Œåˆ‡æ¢æŒ‡å®šåˆ†æ”¯ï¼š<code>cd PaddleOCR &amp;&amp; git checkout release/3.0</code></li><li>å®‰è£…ä¾èµ–ï¼š<code>pip3 install -r requirements.txt -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</code></li><li>è®¾ç½®æ¸…åæºï¼š<code>pip3 config set global.index-url https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</code></li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>other</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MasterGo MCP å°è¯•</title>
    <link href="/2025/05/15/masterGo_MCP/"/>
    <url>/2025/05/15/masterGo_MCP/</url>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2><ol><li><p>å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ° mcp.json æ–‡ä»¶ä¸­ (æƒé™é—®é¢˜ï¼Œ7 æœˆ 10 å·ä¹‹å‰å‡­å€Ÿ tokenï¼Œä»»æ„ç”¨æˆ·éƒ½å¯ä»¥ï¼Œä¹‹ååªèƒ½ç¼–è¾‘å¸­ä½å’Œç ”å‘å¸­ä½çš„ token å¯ä»¥è®¿é—® mcpï¼ŒåŸæ–‡åœ°å€ï¼š<a href="https://mastergo.com/static/advance-notice-prototype.html">https://mastergo.com/static/advance-notice-prototype.html</a>)</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs perl">&#123;<br>  <span class="hljs-string">&quot;mcpServers&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;mastergo-magic-mcp&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;command&quot;</span>: <span class="hljs-string">&quot;npx&quot;</span>,<br>      <span class="hljs-string">&quot;args&quot;</span>: [<br>        <span class="hljs-string">&quot;-y&quot;</span>,<br>        <span class="hljs-string">&quot;<span class="hljs-variable">@mastergo</span>/magic-mcp&quot;</span>,<br>        <span class="hljs-string">&quot;--token=MG_MCP_TOKEN&quot;</span>,<br>        <span class="hljs-string">&quot;--url=https://mastergo.com&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;env&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;NPM_CONFIG_REGISTRY&quot;</span>: <span class="hljs-string">&quot;https://registry.npmjs.org/&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img2/masterGo_MCP_1.jpg" alt="image"></p></li><li><p>è·å– tokenï¼Œæ›¿æ¢ mcp.json æ–‡ä»¶ä¸­çš„&lt;MG_MCP_TOKEN&gt;<br><img src="/img2/masterGo_MCP_2.jpg" alt="image"><br><img src="/img2/masterGo_MCP_3.jpg" alt="image"></p></li><li><p>ä¿å­˜åï¼Œå›åˆ°è®¾ç½®é¡µé¢ï¼Œå¦‚æœæ˜¾ç¤ºç»¿è‰²ï¼Œå¹¶ä¸”å‡ºç°äº† Tools æœ‰ mcp__getDSL å°±æ˜¯æˆåŠŸäº†ã€‚</p></li><li><p>æ¥åˆ° MasterGo ä¸­ï¼Œé€‰ä¸­ä¸€ä¸ªå›¾å±‚ï¼Œæ­¤æ—¶å›¾å±‚æ˜¯ frame ç±»å‹çš„è¯ï¼Œé“¾æ¥ä¸Šä¼šå¢åŠ  layerId å‚æ•°ï¼Œç„¶åå¤åˆ¶é“¾æ¥<br><img src="/img2/masterGo_MCP_4.jpg" alt="image"></p></li><li><p>å¤åˆ¶ URL åˆ° cursor ä¸­ï¼Œè¾“å…¥ä¸€ä¸‹ prompt è¿›è¡Œç”Ÿæˆä»£ç <br><img src="/img2/masterGo_MCP_5.jpg" alt="image"></p></li><li><p>ä»¥ä¸‹ä¸‰ä¸ªç”Ÿæˆæ•ˆæœï¼šå›¾ 1 æ˜¯å®˜æ–¹ demoã€å›¾ 2 æ˜¯æ”¶å¬é¢†å¥–çš„æ•´ä¸ªé¡µé¢ã€å›¾ 3 æ˜¯å•ä¸ªæŒ‰é’®ã€‚<br><img src="/img2/masterGo_MCP_6.jpg" alt="image"><br><img src="/img2/masterGo_MCP_7.jpg" alt="image"><br><img src="/img2/masterGo_MCP_8.jpg" alt="image"></p></li></ol><h3 id="æ¢ç´¢-MCP-å®ç°åŸç†">æ¢ç´¢ MCP å®ç°åŸç†</h3><ol><li><p>æ’ä»¶ github åœ°å€ï¼š<a href="https://github.com/mastergo-design/mastergo-magic-mcp">https://github.com/mastergo-design/mastergo-magic-mcp</a></p></li><li><p>æ’ä»¶æä¾› mcp å·¥å…·ï¼š</p><ul><li>mcp__getDslï¼Œæè¿°å¦‚ä¸‹ï¼Œæ¦‚æ‹¬ä¸ºï¼šæä¾› fileId å’Œ layerId å­—æ®µï¼Œè¿”å›åŸå§‹çš„ DSLã€‚åŒ…å«æ‰€æœ‰ä¿¡æ¯ã€‚</li></ul><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk"><br><span class="hljs-comment">&quot;Use this tool to retrieve the DSL (Domain Specific Language) data from MasterGo design files and the rules you must follow when generating code.</span><br><span class="hljs-comment">This tool is useful when you need to analyze the structure of a design, understand component hierarchy, or extract design properties.</span><br><span class="hljs-comment">You must provide a fileId and layerId to identify the specific design element.</span><br><span class="hljs-comment">This tool returns the raw DSL data in JSON format that you can then parse and analyze.</span><br><span class="hljs-comment">This tool also returns the rules you must follow when generating code.</span><br><span class="hljs-comment">The DSL data can also be used to transform and generate code for different frameworks.&quot;</span><br><br></code></pre></td></tr></table></figure></li></ol><ul><li><p>mcp__getComponentLinkï¼Œæè¿°å¦‚ä¸‹ï¼Œæ¦‚æ‹¬ä¸ºï¼šå½“ mcp_getDsl è¿”å›çš„æ•°æ®åŒ…å« componentDocumentLinks æ•°ç»„æ—¶ã€‚è·å–åˆ°æ¯ä¸ªç»„ä»¶çš„æ–‡æ¡£(masterGo æ ·å¼ç»„ä»¶çš„æ–‡æ¡£),æ ¹æ®æ–‡æ¡£ä¿¡æ¯ç”Ÿæˆå¯¹åº”çš„ç»„ä»¶ã€‚</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><br>When <span class="hljs-keyword">the</span> data returned <span class="hljs-keyword">by</span> mcp\*\*getDsl <span class="hljs-keyword">contains</span> <span class="hljs-keyword">a</span> non-<span class="hljs-literal">empty</span> componentDocumentLinks array, this tool is used <span class="hljs-built_in">to</span> sequentially retrieve URLs <span class="hljs-built_in">from</span> <span class="hljs-keyword">the</span> componentDocumentLinks array <span class="hljs-keyword">and</span> <span class="hljs-keyword">then</span> obtain component documentation data. The returned document data is used <span class="hljs-keyword">for</span> you <span class="hljs-built_in">to</span> generate frontend code based <span class="hljs-keyword">on</span> <span class="hljs-title">components</span>.<br></code></pre></td></tr></table></figure></li><li><p>mcp__getMetaï¼Œæè¿°å¦‚ä¸‹ï¼Œæ¦‚æ‹¬ä¸ºï¼šç”¨æ¥ç»™ç”¨æˆ·æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç½‘ç«™ï¼Œæˆ–è€…é«˜çº§ç½‘ç«™ã€‚æä¾› fileId å’Œ layerId å­—æ®µï¼Œè¿”å›ç½‘ç«™å’Œé¡µé¢çš„è§„åˆ™å’Œç»“æœ(åœ¨ masterGo ä¸­çš„å›¾å±‚ï¼Œå›¾å±‚é‡Œæœ‰è§„åˆ™å’Œä¿¡æ¯)ã€‚cursor ä¼šæ ¹æ®å…ƒä¿¡æ¯ï¼Œç”Ÿæˆ <a href="http://task.md">task.md</a>ï¼Œç„¶åå»é€’å½’çš„å»å¯»æ‰¾ masterGo è®¾è®¡é¡µé¢ï¼Œç„¶åé€ä¸€ç”Ÿæˆé¡µé¢ï¼Œå¹¶ä¸”ä¼šåŠ ä¸Š mete ä¿¡æ¯é‡Œçš„è·³è½¬ï¼Œæˆ–è€…å…¶ä»–äº‹ä»¶ã€‚ä½¿ç”¨é“¾æ¥ï¼š<a href="https://mastergo.com/file/155675508499265?fileOpenFrom=home&amp;page_id=8740%3A3698&amp;devMode=true">https://mastergo.com/file/155675508499265?fileOpenFrom=home&amp;page_id=8740%3A3698&amp;devMode=true</a></p></li><li><p>mcp__getComponentGeneratorï¼Œæè¿°å¦‚ä¸‹ï¼Œæ¦‚æ‹¬ä¸ºï¼Œæä¾› rootPathã€fileIdã€layerIdï¼Œè¿”å›ç»„ä»¶å¼€å‘å·¥ä½œæµçš„æ–‡ä»¶(<a href="http://component-workflow.md">component-workflow.md</a>)ï¼Œè®© cursor æ ¹æ® <a href="http://component-workflow.md">component-workflow.md</a> è§„åˆ™å¼€å‘ç»„ä»¶ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br>Users need <span class="hljs-keyword">to</span> actively <span class="hljs-keyword">call</span> this tool <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> the component development workflow. <span class="hljs-keyword">When</span> Generator <span class="hljs-keyword">is</span> mentioned, please actively <span class="hljs-keyword">call</span> this tool.<br>This tool provides a structured workflow <span class="hljs-keyword">for</span> component development <span class="hljs-keyword">following</span> best practices.<br>You must provide an absolute rootPath <span class="hljs-keyword">of</span> workspace <span class="hljs-keyword">to</span> save workflow files.<br><br></code></pre></td></tr></table></figure></li><li><p>mcp__getDsl è¿”å›ç»“æœå’Œ masterGo æ’ä»¶ä¸­çš„ DSL æ¯”è¾ƒï¼Œæ¦‚æ‹¬ä¸ºï¼Œå‡ ä¹å®Œå…¨ä¸ä¸€æ ·çš„å­—æ®µï¼ŒMCP è¿”å›çš„ DSL æ•°æ®ä¸­çš„æ ·å¼æ•°æ®æ˜¯ç¨åŠ å¤„ç†è¿‡çš„ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><br>&#123;<br>  <span class="hljs-string">&quot;dsl&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;styles&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;paint_1:0363&quot;</span>: &#123; <span class="hljs-string">&quot;value&quot;</span>: [<span class="hljs-string">&quot;#FFFFFF&quot;</span>], <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;Whites/White&quot;</span> &#125;,<br>      <span class="hljs-string">&quot;effect_1:0365&quot;</span>: &#123; <span class="hljs-string">&quot;value&quot;</span>: [<span class="hljs-string">&quot;box-shadow: 0px 0px 0px 20px rgba(0, 0, 0, 0.02);&quot;</span>], <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;box shadow&quot;</span> &#125;,<br>      <span class="hljs-string">&quot;paint_1:0404&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: [<br>          &#123;<br>            <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://image-resource.mastergo.com/57000091966935/57000091966937/6d01dc22287b99530477ebcb8831f8bb.png&quot;</span>,<br>            <span class="hljs-string">&quot;filters&quot;</span>: <span class="hljs-string">&quot;&quot;</span><br>          &#125;<br>        ]<br>      &#125;,<br>      <span class="hljs-string">&quot;paint_1:0373&quot;</span>: &#123; <span class="hljs-string">&quot;value&quot;</span>: [<span class="hljs-string">&quot;#313237&quot;</span>], <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;Blacks/High emphasis&quot;</span> &#125;,<br>      <span class="hljs-string">&quot;font_1:0372&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;family&quot;</span>: <span class="hljs-string">&quot;Amiko-Bold&quot;</span>,<br>          <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">25</span>,<br>          <span class="hljs-string">&quot;decoration&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>          <span class="hljs-string">&quot;case&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>          <span class="hljs-string">&quot;lineHeight&quot;</span>: <span class="hljs-string">&quot;33.79999923706055&quot;</span>,<br>          <span class="hljs-string">&quot;letterSpacing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;Headings/Heading&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;paint_1:0379&quot;</span>: &#123; <span class="hljs-string">&quot;value&quot;</span>: [<span class="hljs-string">&quot;#718797&quot;</span>], <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;Blacks/Mid emphasis&quot;</span> &#125;,<br>      <span class="hljs-string">&quot;font_1:0378&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;family&quot;</span>: <span class="hljs-string">&quot;Inter-Regular&quot;</span>,<br>          <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">16</span>,<br>          <span class="hljs-string">&quot;decoration&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>          <span class="hljs-string">&quot;case&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>          <span class="hljs-string">&quot;lineHeight&quot;</span>: <span class="hljs-string">&quot;26.399999618530273&quot;</span>,<br>          <span class="hljs-string">&quot;letterSpacing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;Body/body&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;paint_1:0401&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: [<br>          &#123;<br>            <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://image-resource.mastergo.com/57000091966935/57000091966937/b253f033eb4e3f396f8ee23280a1b034.png&quot;</span>,<br>            <span class="hljs-string">&quot;filters&quot;</span>: <span class="hljs-string">&quot;&quot;</span><br>          &#125;<br>        ]<br>      &#125;,<br>      <span class="hljs-string">&quot;font_1:0399&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;family&quot;</span>: <span class="hljs-string">&quot;Inter-SemiBold&quot;</span>,<br>          <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">16</span>,<br>          <span class="hljs-string">&quot;decoration&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>          <span class="hljs-string">&quot;case&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>          <span class="hljs-string">&quot;lineHeight&quot;</span>: <span class="hljs-string">&quot;26.399999618530273&quot;</span>,<br>          <span class="hljs-string">&quot;letterSpacing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;Body/BodyBold&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;font_1:0395&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;family&quot;</span>: <span class="hljs-string">&quot;Inter-Regular&quot;</span>,<br>          <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">12</span>,<br>          <span class="hljs-string">&quot;decoration&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>          <span class="hljs-string">&quot;case&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>          <span class="hljs-string">&quot;lineHeight&quot;</span>: <span class="hljs-string">&quot;16.799999237060547&quot;</span>,<br>          <span class="hljs-string">&quot;letterSpacing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;Other/caption&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;paint_1:0383&quot;</span>: &#123; <span class="hljs-string">&quot;value&quot;</span>: [] &#125;,<br>      <span class="hljs-string">&quot;paint_1:0387&quot;</span>: &#123; <span class="hljs-string">&quot;value&quot;</span>: [<span class="hljs-string">&quot;#5374FF&quot;</span>], <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;AppColors/ppl&quot;</span> &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;nodes&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;FRAME&quot;</span>,<br>        <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0222&quot;</span>,<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;simple layer 1&quot;</span>,<br>        <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">540</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">680</span>, <span class="hljs-string">&quot;relativeX&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;relativeY&quot;</span>: <span class="hljs-number">0</span> &#125;,<br>        <span class="hljs-string">&quot;fill&quot;</span>: <span class="hljs-string">&quot;paint_1:0363&quot;</span>,<br>        <span class="hljs-string">&quot;children&quot;</span>: [<br>          &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;LAYER&quot;</span>,<br>            <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0245&quot;</span>,<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Rectangle 8&quot;</span>,<br>            <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">500</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">380.2801208496094</span>, <span class="hljs-string">&quot;relativeX&quot;</span>: <span class="hljs-number">20</span>, <span class="hljs-string">&quot;relativeY&quot;</span>: <span class="hljs-number">20</span> &#125;,<br>            <span class="hljs-string">&quot;flexShrink&quot;</span>: <span class="hljs-number">1</span>,<br>            <span class="hljs-string">&quot;borderRadius&quot;</span>: <span class="hljs-string">&quot;10px&quot;</span>,<br>            <span class="hljs-string">&quot;fill&quot;</span>: <span class="hljs-string">&quot;paint_1:0404&quot;</span><br>          &#125;,<br>          &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;FRAME&quot;</span>,<br>            <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0223&quot;</span>,<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Frame 42&quot;</span>,<br>            <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">500</span>,<br>              <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">259.7198791503906</span>,<br>              <span class="hljs-string">&quot;relativeX&quot;</span>: <span class="hljs-number">20</span>,<br>              <span class="hljs-string">&quot;relativeY&quot;</span>: <span class="hljs-number">400.2801208496094</span><br>            &#125;,<br>            <span class="hljs-string">&quot;flexGrow&quot;</span>: <span class="hljs-number">1</span>,<br>            <span class="hljs-string">&quot;flexShrink&quot;</span>: <span class="hljs-number">1</span>,<br>            <span class="hljs-string">&quot;children&quot;</span>: [<br>              &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;FRAME&quot;</span>,<br>                <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0224&quot;</span>,<br>                <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Frame 30&quot;</span>,<br>                <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">460</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">121</span>, <span class="hljs-string">&quot;relativeX&quot;</span>: <span class="hljs-number">20</span>, <span class="hljs-string">&quot;relativeY&quot;</span>: <span class="hljs-number">40</span> &#125;,<br>                <span class="hljs-string">&quot;flexShrink&quot;</span>: <span class="hljs-number">1</span>,<br>                <span class="hljs-string">&quot;children&quot;</span>: [<br>                  &#123;<br>                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;TEXT&quot;</span>,<br>                    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0225&quot;</span>,<br>                    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Use the bluetooth SMS andwidth, then you can&quot;</span>,<br>                    <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">460</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">68</span> &#125;,<br>                    <span class="hljs-string">&quot;flexShrink&quot;</span>: <span class="hljs-number">1</span>,<br>                    <span class="hljs-string">&quot;text&quot;</span>: [&#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;Use the bluetooth SMS andwidth, then you can&quot;</span>, <span class="hljs-string">&quot;font&quot;</span>: <span class="hljs-string">&quot;font_1:0372&quot;</span> &#125;],<br>                    <span class="hljs-string">&quot;textColor&quot;</span>: [&#123; <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;end&quot;</span>: <span class="hljs-number">44</span>, <span class="hljs-string">&quot;color&quot;</span>: <span class="hljs-string">&quot;paint_1:0373&quot;</span> &#125;],<br>                    <span class="hljs-string">&quot;textAlign&quot;</span>: <span class="hljs-string">&quot;left&quot;</span>,<br>                    <span class="hljs-string">&quot;textMode&quot;</span>: <span class="hljs-string">&quot;auto-height&quot;</span><br>                  &#125;,<br>                  &#123;<br>                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;TEXT&quot;</span>,<br>                    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0228&quot;</span>,<br>                    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Compressing the monitor won&#x27;t do anything, we need to synthesize the cross-platform HTTP feed.&quot;</span>,<br>                    <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">460</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">53</span>, <span class="hljs-string">&quot;relativeY&quot;</span>: <span class="hljs-number">68</span> &#125;,<br>                    <span class="hljs-string">&quot;flexShrink&quot;</span>: <span class="hljs-number">1</span>,<br>                    <span class="hljs-string">&quot;text&quot;</span>: [<br>                      &#123;<br>                        <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;Compressing the monitor won&#x27;t do anything, we need to synthesize the cross-platform HTTP feed.&quot;</span>,<br>                        <span class="hljs-string">&quot;font&quot;</span>: <span class="hljs-string">&quot;font_1:0378&quot;</span><br>                      &#125;<br>                    ],<br>                    <span class="hljs-string">&quot;textColor&quot;</span>: [&#123; <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;end&quot;</span>: <span class="hljs-number">94</span>, <span class="hljs-string">&quot;color&quot;</span>: <span class="hljs-string">&quot;paint_1:0379&quot;</span> &#125;],<br>                    <span class="hljs-string">&quot;textAlign&quot;</span>: <span class="hljs-string">&quot;left&quot;</span>,<br>                    <span class="hljs-string">&quot;textMode&quot;</span>: <span class="hljs-string">&quot;auto-height&quot;</span><br>                  &#125;<br>                ],<br>                <span class="hljs-string">&quot;flexContainerInfo&quot;</span>: &#123; <span class="hljs-string">&quot;flexDirection&quot;</span>: <span class="hljs-string">&quot;column&quot;</span>, <span class="hljs-string">&quot;mainSizing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span>, <span class="hljs-string">&quot;crossSizing&quot;</span>: <span class="hljs-string">&quot;fixed&quot;</span> &#125;<br>              &#125;,<br>              &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;FRAME&quot;</span>,<br>                <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0231&quot;</span>,<br>                <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Frame 31&quot;</span>,<br>                <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">460</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">44</span>, <span class="hljs-string">&quot;relativeX&quot;</span>: <span class="hljs-number">20</span>, <span class="hljs-string">&quot;relativeY&quot;</span>: <span class="hljs-number">195.71987915039062</span> &#125;,<br>                <span class="hljs-string">&quot;flexShrink&quot;</span>: <span class="hljs-number">1</span>,<br>                <span class="hljs-string">&quot;children&quot;</span>: [<br>                  &#123;<br>                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;GROUP&quot;</span>,<br>                    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0235&quot;</span>,<br>                    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Group 1&quot;</span>,<br>                    <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">194</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">44</span> &#125;,<br>                    <span class="hljs-string">&quot;children&quot;</span>: [<br>                      &#123;<br>                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;FRAME&quot;</span>,<br>                        <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0236&quot;</span>,<br>                        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Frame 23&quot;</span>,<br>                        <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">194</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">44</span> &#125;,<br>                        <span class="hljs-string">&quot;children&quot;</span>: [<br>                          &#123;<br>                            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;LAYER&quot;</span>,<br>                            <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0237&quot;</span>,<br>                            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Rectangle 19&quot;</span>,<br>                            <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">40</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">40</span>, <span class="hljs-string">&quot;relativeY&quot;</span>: <span class="hljs-number">2</span> &#125;,<br>                            <span class="hljs-string">&quot;borderRadius&quot;</span>: <span class="hljs-string">&quot;155px&quot;</span>,<br>                            <span class="hljs-string">&quot;fill&quot;</span>: <span class="hljs-string">&quot;paint_1:0401&quot;</span><br>                          &#125;,<br>                          &#123;<br>                            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;FRAME&quot;</span>,<br>                            <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0238&quot;</span>,<br>                            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Frame 24&quot;</span>,<br>                            <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">144</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">44</span>, <span class="hljs-string">&quot;relativeX&quot;</span>: <span class="hljs-number">50</span> &#125;,<br>                            <span class="hljs-string">&quot;children&quot;</span>: [<br>                              &#123;<br>                                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;TEXT&quot;</span>,<br>                                <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0239&quot;</span>,<br>                                <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Darlene Robertson&quot;</span>,<br>                                <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">144</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">27</span> &#125;,<br>                                <span class="hljs-string">&quot;text&quot;</span>: [&#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;Darlene Robertson&quot;</span>, <span class="hljs-string">&quot;font&quot;</span>: <span class="hljs-string">&quot;font_1:0399&quot;</span> &#125;],<br>                                <span class="hljs-string">&quot;textColor&quot;</span>: [&#123; <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;end&quot;</span>: <span class="hljs-number">17</span>, <span class="hljs-string">&quot;color&quot;</span>: <span class="hljs-string">&quot;paint_1:0373&quot;</span> &#125;],<br>                                <span class="hljs-string">&quot;textAlign&quot;</span>: <span class="hljs-string">&quot;left&quot;</span>,<br>                                <span class="hljs-string">&quot;textMode&quot;</span>: <span class="hljs-string">&quot;single-line&quot;</span><br>                              &#125;,<br>                              &#123;<br>                                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;TEXT&quot;</span>,<br>                                <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0242&quot;</span>,<br>                                <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;March 12, 2021&quot;</span>,<br>                                <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">87</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">17</span>, <span class="hljs-string">&quot;relativeY&quot;</span>: <span class="hljs-number">27</span> &#125;,<br>                                <span class="hljs-string">&quot;text&quot;</span>: [&#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;March 12, 2021&quot;</span>, <span class="hljs-string">&quot;font&quot;</span>: <span class="hljs-string">&quot;font_1:0395&quot;</span> &#125;],<br>                                <span class="hljs-string">&quot;textColor&quot;</span>: [&#123; <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&quot;end&quot;</span>: <span class="hljs-number">14</span>, <span class="hljs-string">&quot;color&quot;</span>: <span class="hljs-string">&quot;paint_1:0379&quot;</span> &#125;],<br>                                <span class="hljs-string">&quot;textAlign&quot;</span>: <span class="hljs-string">&quot;left&quot;</span>,<br>                                <span class="hljs-string">&quot;textMode&quot;</span>: <span class="hljs-string">&quot;single-line&quot;</span><br>                              &#125;<br>                            ],<br>                            <span class="hljs-string">&quot;flexContainerInfo&quot;</span>: &#123;<br>                              <span class="hljs-string">&quot;flexDirection&quot;</span>: <span class="hljs-string">&quot;column&quot;</span>,<br>                              <span class="hljs-string">&quot;mainSizing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span>,<br>                              <span class="hljs-string">&quot;crossSizing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span><br>                            &#125;<br>                          &#125;<br>                        ],<br>                        <span class="hljs-string">&quot;flexContainerInfo&quot;</span>: &#123;<br>                          <span class="hljs-string">&quot;flexDirection&quot;</span>: <span class="hljs-string">&quot;row&quot;</span>,<br>                          <span class="hljs-string">&quot;alignItems&quot;</span>: <span class="hljs-string">&quot;center&quot;</span>,<br>                          <span class="hljs-string">&quot;mainSizing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span>,<br>                          <span class="hljs-string">&quot;crossSizing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span>,<br>                          <span class="hljs-string">&quot;gap&quot;</span>: <span class="hljs-string">&quot;10px&quot;</span><br>                        &#125;<br>                      &#125;<br>                    ]<br>                  &#125;,<br>                  &#123;<br>                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;FRAME&quot;</span>,<br>                    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0232&quot;</span>,<br>                    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;bi:arrow-right-short&quot;</span>,<br>                    <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">40</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">40</span>, <span class="hljs-string">&quot;relativeX&quot;</span>: <span class="hljs-number">420</span> &#125;,<br>                    <span class="hljs-string">&quot;fill&quot;</span>: <span class="hljs-string">&quot;paint_1:0383&quot;</span>,<br>                    <span class="hljs-string">&quot;children&quot;</span>: [<br>                      &#123;<br>                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;GROUP&quot;</span>,<br>                        <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0233&quot;</span>,<br>                        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Group&quot;</span>,<br>                        <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123;<br>                          <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">20.002233505249023</span>,<br>                          <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">17.50320053100586</span>,<br>                          <span class="hljs-string">&quot;relativeX&quot;</span>: <span class="hljs-number">10</span>,<br>                          <span class="hljs-string">&quot;relativeY&quot;</span>: <span class="hljs-number">11.248419761657715</span><br>                        &#125;,<br>                        <span class="hljs-string">&quot;children&quot;</span>: [<br>                          &#123;<br>                            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;PATH&quot;</span>,<br>                            <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;158:0234&quot;</span>,<br>                            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Vector&quot;</span>,<br>                            <span class="hljs-string">&quot;layoutStyle&quot;</span>: &#123; <span class="hljs-string">&quot;width&quot;</span>: <span class="hljs-number">20.002233505249023</span>, <span class="hljs-string">&quot;height&quot;</span>: <span class="hljs-number">17.50320053100586</span> &#125;,<br>                            <span class="hljs-string">&quot;path&quot;</span>: [<br>                              &#123;<br>                                <span class="hljs-string">&quot;fill&quot;</span>: <span class="hljs-string">&quot;paint_1:0387&quot;</span>,<br>                                <span class="hljs-string">&quot;data&quot;</span>: <span class="hljs-string">&quot;M6.96159e-30 8.75158C-1.11022e-15 8.42006 0.131696 8.10212 0.366117 7.8677C0.600537 7.63328 0.918479 7.50158 1.25 7.50158C1.25 7.50158 15.7325 7.50158 15.7325 7.50158C15.7325 7.50158 10.365 2.13658 10.365 2.13658C10.1303 1.90186 9.99842 1.58352 9.99842 1.25158C9.99842 0.91964 10.1303 0.601296 10.365 0.366579C10.5997 0.131863 10.9181 0 11.25 0C11.5819 0 11.9003 0.131863 12.135 0.366579C12.135 0.366579 19.635 7.86658 19.635 7.86658C19.7514 7.98269 19.8438 8.12063 19.9068 8.2725C19.9698 8.42436 20.0022 8.58716 20.0022 8.75158C20.0022 8.916 19.9698 9.0788 19.9068 9.23066C19.8438 9.38253 19.7514 9.52047 19.635 9.63658C19.635 9.63658 12.135 17.1366 12.135 17.1366C11.9003 17.3713 11.5819 17.5032 11.25 17.5032C10.9181 17.5032 10.5997 17.3713 10.365 17.1366C10.1303 16.9019 9.99842 16.5835 9.99842 16.2516C9.99842 15.9196 10.1303 15.6013 10.365 15.3666C10.365 15.3666 15.7325 10.0016 15.7325 10.0016C15.7325 10.0016 1.25 10.0016 1.25 10.0016C0.918479 10.0016 0.600537 9.86988 0.366117 9.63546C0.131696 9.40104 -1.11022e-15 9.0831 6.96159e-30 8.75158C6.96159e-30 8.75158 6.96159e-30 8.75158 6.96159e-30 8.75158Z&quot;</span><br>                              &#125;<br>                            ]<br>                          &#125;<br>                        ]<br>                      &#125;<br>                    ]<br>                  &#125;<br>                ],<br>                <span class="hljs-string">&quot;flexContainerInfo&quot;</span>: &#123;<br>                  <span class="hljs-string">&quot;flexDirection&quot;</span>: <span class="hljs-string">&quot;row&quot;</span>,<br>                  <span class="hljs-string">&quot;justifyContent&quot;</span>: <span class="hljs-string">&quot;space-between&quot;</span>,<br>                  <span class="hljs-string">&quot;mainSizing&quot;</span>: <span class="hljs-string">&quot;fixed&quot;</span>,<br>                  <span class="hljs-string">&quot;crossSizing&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span>,<br>                  <span class="hljs-string">&quot;gap&quot;</span>: <span class="hljs-string">&quot;135px&quot;</span><br>                &#125;,<br>                <span class="hljs-string">&quot;borderRadius&quot;</span>: <span class="hljs-string">&quot;10px&quot;</span><br>              &#125;<br>            ],<br>            <span class="hljs-string">&quot;flexContainerInfo&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;flexDirection&quot;</span>: <span class="hljs-string">&quot;column&quot;</span>,<br>              <span class="hljs-string">&quot;justifyContent&quot;</span>: <span class="hljs-string">&quot;space-between&quot;</span>,<br>              <span class="hljs-string">&quot;mainSizing&quot;</span>: <span class="hljs-string">&quot;fixed&quot;</span>,<br>              <span class="hljs-string">&quot;crossSizing&quot;</span>: <span class="hljs-string">&quot;fixed&quot;</span>,<br>              <span class="hljs-string">&quot;padding&quot;</span>: <span class="hljs-string">&quot;40px 20px 20px&quot;</span><br>            &#125;<br>          &#125;<br>        ],<br>        <span class="hljs-string">&quot;effect&quot;</span>: <span class="hljs-string">&quot;effect_1:0365&quot;</span>,<br>        <span class="hljs-string">&quot;flexContainerInfo&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;flexDirection&quot;</span>: <span class="hljs-string">&quot;column&quot;</span>,<br>          <span class="hljs-string">&quot;justifyContent&quot;</span>: <span class="hljs-string">&quot;center&quot;</span>,<br>          <span class="hljs-string">&quot;alignItems&quot;</span>: <span class="hljs-string">&quot;center&quot;</span>,<br>          <span class="hljs-string">&quot;mainSizing&quot;</span>: <span class="hljs-string">&quot;fixed&quot;</span>,<br>          <span class="hljs-string">&quot;crossSizing&quot;</span>: <span class="hljs-string">&quot;fixed&quot;</span>,<br>          <span class="hljs-string">&quot;padding&quot;</span>: <span class="hljs-string">&quot;20px&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;borderRadius&quot;</span>: <span class="hljs-string">&quot;10px&quot;</span><br>      &#125;<br>    ],<br>    <span class="hljs-string">&quot;components&quot;</span>: []<br>  &#125;,<br>  <span class="hljs-string">&quot;componentDocumentLinks&quot;</span>: [],<br>  <span class="hljs-string">&quot;rules&quot;</span>: [<br>    <span class="hljs-string">&quot;token filed must be generated as a variable (colors, shadows, fonts, etc.) and the token field must be displayed in the comment&quot;</span>,<br>    <span class="hljs-string">&quot;\n            componentDocumentLinks is a list of frontend component documentation links used in the DSL layer, designed to help you understand how to use the components.\n            When it exists and is not empty, you need to use mcp__getComponentLink in a for loop to get the URL content of all components in the list, understand how to use the components, and generate code using the components.\n            For example: \n              ```js  \n                const componentDocumentLinks = [\n                  &#x27;https://example.com/ant/button.mdx&#x27;,\n                  &#x27;https://example.com/ant/button.mdx&#x27;\n                ]\n                for (const url of componentDocumentLinks) &#123;\n                  const componentLink = await mcp__getComponentLink(url);\n                  console.log(componentLink);\n                &#125;\n              ```\n          &quot;</span><br>  ]<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="/img2/masterGo_MCP_9.jpg" alt="image"></p></li></ul><h3 id="æ€»ç»“">æ€»ç»“</h3><p>ç›®å‰ masterGo MCP ç”Ÿæˆä»£ç çš„åŸææ–™æ˜¯è®¾è®¡æ–‡ä»¶çš„ DSL ç®€å•å¤„ç†è¿‡ä¸€å±‚ä¹‹åçš„ DSL Objectï¼ŒAI å¹¶ä¸èƒ½æ ¹æ®åŸå§‹å›¾å±‚æ¥è¿›è¡Œç²¾ç¡®çš„å¸ƒå±€ï¼Œä¹Ÿä¸èƒ½ç”Ÿäº§åŠ¨æ€å†…å®¹çš„å¸ƒå±€(åŒ…æ‹¬æ–‡å­—ä¸ªæ•°åŠ¨æ€å˜åŒ–ï¼Œä»¥åŠå…¶ä»–å…ƒç´ åŠ¨æ€ä¸ªæ•°)ï¼Œä¸€æ–¹é¢ MCP æä¾›çš„ DSL Object æ˜¯åŸºäºå›¾å±‚ä¿¡æ¯çš„ï¼Œéå¸¸æ‚ä¹±ï¼Œä¸€æ–¹é¢ç›®å‰çš„ AI å¤„ç†å¤§é‡æ•°æ®æ˜¯æœ‰ç¼ºé™·çš„ã€‚</p><h3 id="å®æ“å‚è€ƒï¼š">å®æ“å‚è€ƒï¼š</h3><p><a href="https://mastergo.com/file/155675508499265?fileOpenFrom=home&amp;page_id=1%3A0">https://mastergo.com/file/155675508499265?fileOpenFrom=home&amp;page_id=1%3A0</a></p>]]></content>
    
    
    <categories>
      
      <category>MasterGo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MasterGo</tag>
      
      <tag>MCP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ECharts çº¿æ¡ç²¾ç¡®äº¤äº’æ¼”ç¤º (PC/ç§»åŠ¨ç«¯)</title>
    <link href="/2025/03/15/ECharts%E7%BA%BF%E6%9D%A1%E7%B2%BE%E7%A1%AE%E4%BA%A4%E4%BA%92%E6%BC%94%E7%A4%BA/"/>
    <url>/2025/03/15/ECharts%E7%BA%BF%E6%9D%A1%E7%B2%BE%E7%A1%AE%E4%BA%A4%E4%BA%92%E6%BC%94%E7%A4%BA/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ¼”ç¤ºäº†å¦‚ä½•åœ¨ ECharts ä¸­å®ç°ç²¾ç¡®çš„çº¿æ¡äº¤äº’æ•ˆæœï¼Œè§£å†³äº†åå­—çº¿ç»è¿‡æ•°æ®ç‚¹æ—¶æ„å¤–è§¦å‘çº¿æ¡é«˜äº®çš„é—®é¢˜ï¼ŒåŒæ—¶æ”¯æŒ PC ç«¯å’Œç§»åŠ¨ç«¯çš„ä¸åŒäº¤äº’æ–¹å¼ã€‚</p><span id="more"></span><h2 id="ğŸ¯-æ¼”ç¤ºæ•ˆæœ">ğŸ¯ æ¼”ç¤ºæ•ˆæœ</h2><div class="demo-container">  <div class="demo-info">    <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜ï¼š</h3>    <ul>      <li><strong>è“è‰²çº¿æ¡</strong>ï¼šåŸå§‹çº¿æ¡ï¼Œå®½åº¦2pxï¼Œæ­£å¸¸æ˜¾ç¤º</li>      <li><strong>çº¢è‰²çº¿æ¡</strong>ï¼šåŸå§‹çº¿æ¡ï¼Œå®½åº¦2pxï¼Œæ­£å¸¸æ˜¾ç¤º</li>      <li><strong>é€æ˜è¾…åŠ©åŒºåŸŸ</strong>ï¼šå®½åº¦12pxï¼Œå®Œå…¨é€æ˜ï¼Œç”¨äºæ‰©å¤§äº¤äº’æ£€æµ‹</li>      <li><strong>PCç«¯æµ‹è¯•é‡ç‚¹</strong>ï¼šåªæœ‰é¼ æ ‡æ¥è¿‘çº¿æ¡æ—¶æ‰é«˜äº®ï¼Œç§»åŠ¨åå­—çº¿ç»è¿‡æ•°æ®ç‚¹ä¸ä¼šé«˜äº®</li>      <li><strong>ç§»åŠ¨ç«¯æµ‹è¯•é‡ç‚¹</strong>ï¼šç‚¹å‡»çº¿æ¡é™„è¿‘å¯é«˜äº®åˆ‡æ¢ï¼Œæ”¯æŒå–æ¶ˆå’Œåˆ‡æ¢(F12åˆ‡æ¢æ‰‹æœºæ¨¡å¼ï¼Œç„¶ååˆ·æ–°)</li>    </ul>  </div>  <div class="demo-highlight">    ğŸ’¡ <strong>PCç«¯æµ‹è¯•</strong>ï¼šâ‘ é¼ æ ‡hoverçº¿æ¡é™„è¿‘â†’çº¿æ¡é«˜äº® â‘¡åå­—çº¿ç»è¿‡â†’ä¸é«˜äº®ï¼<br />    ğŸ“± <strong>ç§»åŠ¨ç«¯æµ‹è¯•</strong>ï¼šâ‘ ç‚¹å‡»çº¿æ¡é™„è¿‘â†’é«˜äº®åˆ‡æ¢ â‘¡å†æ¬¡ç‚¹å‡»â†’å–æ¶ˆé«˜äº®ï¼  </div>  <div id="chart" class="chart-container"></div></div><h2 id="ğŸ”§-å®ç°åŸç†">ğŸ”§ å®ç°åŸç†</h2><h3 id="åŸç†-1ï¼šç¦ç”¨-axisPointer-è§¦å‘ç³»åˆ—å¼ºè°ƒæ•ˆæœ">åŸç† 1ï¼šç¦ç”¨ axisPointer è§¦å‘ç³»åˆ—å¼ºè°ƒæ•ˆæœ</h3><p>å…¨å±€ç¦ç”¨<code>axisPointer</code>è§¦å‘ç³»åˆ—å¼ºè°ƒæ•ˆæœï¼Œç¡®ä¿åå­—çº¿ç»è¿‡æ•°æ®ç‚¹æ—¶ä¸ä¼šè§¦å‘çº¿æ¡é«˜äº®ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// å…¨å±€ç¦ç”¨axisPointerè§¦å‘ç³»åˆ—å¼ºè°ƒæ•ˆæœ</span><br><span class="hljs-attr">axisPointer</span>: &#123;<br>  <span class="hljs-attr">triggerEmphasis</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å…³é”®ï¼šå…¨å±€ç¦ç”¨axisPointerè§¦å‘ç³»åˆ—å¼ºè°ƒæ•ˆæœ</span><br>&#125;<br><br><span class="hljs-comment">// æ¯ä¸ªçº¿æ¡é‡Œçš„triggerEmphasis: falseä¹Ÿéœ€è¦è®¾ç½®</span><br><span class="hljs-attr">series</span>: [<br>  &#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-attr">triggerEmphasis</span>: <span class="hljs-literal">false</span>,<br>  &#125;<br>]<br></code></pre></td></tr></table></figure><h3 id="åŸç†-2ï¼šé€æ˜è¾…åŠ©çº¿æ‰©å¤§äº¤äº’åŒºåŸŸ">åŸç† 2ï¼šé€æ˜è¾…åŠ©çº¿æ‰©å¤§äº¤äº’åŒºåŸŸ</h3><p>ä¸ºæ¯æ¡çº¿åˆ›å»ºåŒåçš„é€æ˜è¾…åŠ©ç²—çº¿ï¼ˆå®½ 12pxï¼‰ï¼Œæ¯”åŸå§‹çº¿æ¡å®½ 6 å€ï¼Œç”¨æˆ·çœ‹ä¸è§ä½†èƒ½å“åº”äº¤äº’äº‹ä»¶ï¼š</p><ul><li><strong>PC ç«¯</strong>ï¼šhover è¾…åŠ©çº¿ â†’ é«˜äº®åŸå§‹çº¿ï¼Œmouseoutâ†’ æ¢å¤æ­£å¸¸</li><li><strong>ç§»åŠ¨ç«¯</strong>ï¼šç‚¹å‡»è¾…åŠ©çº¿/åŸå§‹çº¿ â†’ åˆ‡æ¢é«˜äº®çŠ¶æ€ï¼Œæ”¯æŒå–æ¶ˆå’Œåˆ‡æ¢</li><li><strong>å°æŠ€å·§</strong>ï¼šè¾…åŠ©çº¿ç½®äºåº•å±‚ï¼ˆz: -1ï¼‰ï¼Œç”¨æˆ·çœ‹ä¸è§ä½†èƒ½å“åº”äº¤äº’</li><li><strong>å°æŠ€å·§</strong>ï¼šé€šè¿‡ dispatchAction é«˜äº®åŒåçš„åŸå§‹çº¿æ¡</li></ul><h2 id="ğŸ’»-å®Œæ•´ä»£ç å®ç°">ğŸ’» å®Œæ•´ä»£ç å®ç°</h2><style>.demo-container {  margin: 20px 0;}.demo-info {  background: #e3f2fd;  border-left: 4px solid #2196f3;  padding: 15px;  margin: 20px 0;  border-radius: 0 4px 4px 0;}.demo-info h3 {  margin: 0 0 10px 0;  color: #1976d2;}.demo-info ul {  margin: 0;  padding-left: 20px;}.demo-info li {  margin: 5px 0;  color: #555;}.demo-highlight {  background: #fff3cd;  border: 1px solid #ffeaa7;  padding: 10px;  border-radius: 4px;  margin: 10px 0;  text-align: center;  color: #856404;  font-weight: bold;}.chart-container {  width: 100%;  height: 500px;  margin: 20px 0;  border: 1px solid #e0e0e0;  border-radius: 4px;}@media (max-width: 768px) {  .chart-container {    height: 400px;  }}</style><script src="https://cdn.jsdelivr.net/npm/echarts@6.0.0/dist/echarts.min.js"></script><script>// ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆdocument.addEventListener('DOMContentLoaded', function() {  // æ£€æŸ¥EChartsæ˜¯å¦å·²åŠ è½½  if (typeof echarts === 'undefined') {    console.error('EChartsæœªæ­£ç¡®åŠ è½½');    return;  }  // åˆå§‹åŒ–EChartså®ä¾‹  const chartDom = document.getElementById('chart');  if (!chartDom) {    console.error('æ‰¾ä¸åˆ°chartå®¹å™¨å…ƒç´ ');    return;  }  const myChart = echarts.init(chartDom);  // ç”Ÿæˆç¤ºä¾‹æ•°æ®  const generateData = (base, variance) => {    const data = [];    for (let i = 0; i < 50; i++) {      data.push([        i,        base + Math.sin(i * 0.2) * variance + Math.random() * 20 - 10,      ]);    }    return data;  };  const data1 = generateData(100, 30); // è“è‰²çº¿æ•°æ®  const data2 = generateData(150, 40); // çº¢è‰²çº¿æ•°æ®  const option = {    title: {      text: 'çº¿æ¡ç²¾ç¡®äº¤äº’æµ‹è¯• (PCç«¯Hover / ç§»åŠ¨ç«¯ç‚¹å‡»)',      left: 'center',      textStyle: {        fontSize: 16,      },    },    // ğŸ¯ å…¨å±€axisPointeré…ç½® - ç¦ç”¨è‡ªåŠ¨å¼ºè°ƒ    axisPointer: {      triggerEmphasis: false, // å…³é”®ï¼šå…¨å±€ç¦ç”¨axisPointerè§¦å‘ç³»åˆ—å¼ºè°ƒæ•ˆæœ    },    tooltip: {      trigger: 'axis',      axisPointer: {        type: 'cross',        crossStyle: {          color: '#999',        },        triggerEmphasis: false, // ğŸ¯ å…³é”®ï¼šç¦ç”¨axisPointerè§¦å‘ç³»åˆ—å¼ºè°ƒæ•ˆæœ      },    },    legend: {      data: ['è¶‹åŠ¿çº¿A', 'è¶‹åŠ¿çº¿B'],      top: 40,    },    grid: {      left: '3%',      right: '4%',      bottom: '3%',      top: '15%',      containLabel: true,    },    xAxis: {      type: 'value',      name: 'æ—¶é—´ç‚¹',    },    yAxis: {      type: 'value',      name: 'æ•°å€¼',    },    series: [      // === åŸå§‹çº¿æ¡A ===      {        name: 'è¶‹åŠ¿çº¿A',        type: 'line',        data: data1,        smooth: true,        lineStyle: {          width: 2,          color: '#1890ff',        },        itemStyle: {          color: '#1890ff',        },        emphasis: {          scale: false,          lineStyle: {            width: 4,            shadowColor: 'rgba(24, 144, 255, 0.8)',            shadowBlur: 8,            shadowOffsetY: 2,          },        },        showSymbol: false,        hoverAnimation: true,        triggerLineEvent: true,        triggerEmphasis: false, // ğŸ¯ å…³é”®ï¼šç¦ç”¨è¢«axisPointerè‡ªåŠ¨å¼ºè°ƒ      },      // === é€æ˜è¾…åŠ©çº¿A ===      {        name: 'è¶‹åŠ¿çº¿A', // ğŸ¯ å…³é”®ï¼šåŒåï¼        type: 'line',        data: data1, // ğŸ¯ å…³é”®ï¼šåŒæ•°æ®ï¼        smooth: true,        lineStyle: {          width: 12, // ğŸš€ 6å€å®½åº¦ç”¨äºhoveræ£€æµ‹          color: 'transparent', // ğŸ‘» å®Œå…¨é€æ˜          opacity: 0,        },        itemStyle: {          color: 'transparent',          opacity: 0,        },        showInLegend: false, // ğŸš« ä¸æ˜¾ç¤ºåœ¨å›¾ä¾‹ä¸­        showSymbol: false,        hoverAnimation: false,        triggerLineEvent: true,        triggerEmphasis: false, // ğŸ¯ å…³é”®ï¼šç¦ç”¨è¢«axisPointerè‡ªåŠ¨å¼ºè°ƒ        z: -1, // ğŸ¯ åº•å±‚ï¼Œä¸é®æŒ¡å…¶ä»–å…ƒç´       },      // === åŸå§‹çº¿æ¡B ===      {        name: 'è¶‹åŠ¿çº¿B',        type: 'line',        data: data2,        smooth: true,        lineStyle: {          width: 2,          color: '#ff4d4f',        },        itemStyle: {          color: '#ff4d4f',        },        emphasis: {          scale: false,          lineStyle: {            width: 4,            shadowColor: 'rgba(255, 77, 79, 0.8)',            shadowBlur: 8,            shadowOffsetY: 2,          },        },        showSymbol: false,        hoverAnimation: true,        triggerLineEvent: true,        triggerEmphasis: false, // ğŸ¯ å…³é”®ï¼šç¦ç”¨è¢«axisPointerè‡ªåŠ¨å¼ºè°ƒ      },      // === é€æ˜è¾…åŠ©çº¿B ===      {        name: 'è¶‹åŠ¿çº¿B', // ğŸ¯ å…³é”®ï¼šåŒåï¼        type: 'line',        data: data2, // ğŸ¯ å…³é”®ï¼šåŒæ•°æ®ï¼        smooth: true,        lineStyle: {          width: 12, // ğŸš€ 6å€å®½åº¦ç”¨äºhoveræ£€æµ‹          color: 'transparent', // ğŸ‘» å®Œå…¨é€æ˜          opacity: 0,        },        itemStyle: {          color: 'transparent',          opacity: 0,        },        showInLegend: false, // ğŸš« ä¸æ˜¾ç¤ºåœ¨å›¾ä¾‹ä¸­        showSymbol: false,        hoverAnimation: false,        triggerLineEvent: true,        triggerEmphasis: false, // ğŸ¯ å…³é”®ï¼šç¦ç”¨è¢«axisPointerè‡ªåŠ¨å¼ºè°ƒ        z: -1, // ğŸ¯ åº•å±‚ï¼Œä¸é®æŒ¡å…¶ä»–å…ƒç´       },    ],  };  // è®¾ç½®å›¾è¡¨é…ç½®  myChart.setOption(option);  // ğŸ¯ æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡  const isMobile =    /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(      navigator.userAgent    ) || window.innerWidth <= 768;  let currentHighlighted = null; // è®°å½•å½“å‰é«˜äº®çš„ç³»åˆ—  // ğŸ¯ å…³é”®äº‹ä»¶å¤„ç†ï¼šå®ç°ç²¾ç¡®çš„hoverè”åŠ¨  myChart.on('mouseover', function (params) {    if (isMobile) return; // ç§»åŠ¨ç«¯è·³è¿‡hoveräº‹ä»¶    console.log('ğŸ¯ Hoveräº‹ä»¶è§¦å‘:', params.seriesName);    if (params.seriesName) {      // é«˜äº®æ‰€æœ‰åŒåç³»åˆ—ï¼ˆåŸå§‹çº¿æ¡ä¼šè¢«é«˜äº®ï¼‰      myChart.dispatchAction({        type: 'highlight',        seriesName: params.seriesName,      });      // åŒæ—¶é«˜äº®å›¾ä¾‹      myChart.dispatchAction({        type: 'legendHighlight',        name: params.seriesName,      });      // åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºæç¤º      showHoverInfo(params.seriesName, isMobile ? 'ç‚¹å‡»é«˜äº®' : 'é«˜äº®');    }  });  myChart.on('mouseout', function (params) {    if (isMobile) return; // ç§»åŠ¨ç«¯è·³è¿‡hoveräº‹ä»¶    console.log('ğŸ”„ Mouseç¦»å¼€:', params.seriesName);    if (params.seriesName) {      // å–æ¶ˆé«˜äº®      myChart.dispatchAction({        type: 'downplay',        seriesName: params.seriesName,      });      myChart.dispatchAction({        type: 'legendDownplay',        name: params.seriesName,      });      // æ¸…é™¤æç¤º      showHoverInfo(params.seriesName, 'æ¢å¤');    }  });  // ğŸ¯ ç‚¹å‡»äº‹ä»¶å¤„ç†ï¼ˆPCç«¯å’Œç§»åŠ¨ç«¯ï¼‰  myChart.on('click', function (params) {    console.log('ğŸ“± ç‚¹å‡»äº‹ä»¶è§¦å‘:', params.seriesName, 'ç§»åŠ¨ç«¯:', isMobile);    if (params.seriesName) {      // ç‚¹å‡»åˆ°äº†çº¿æ¡      if (isMobile) {        // ç§»åŠ¨ç«¯ï¼šç‚¹å‡»åˆ‡æ¢é«˜äº®çŠ¶æ€        if (currentHighlighted === params.seriesName) {          // å½“å‰ç³»åˆ—å·²é«˜äº®ï¼Œå–æ¶ˆé«˜äº®          myChart.dispatchAction({            type: 'downplay',            seriesName: params.seriesName,          });          myChart.dispatchAction({            type: 'legendDownplay',            name: params.seriesName,          });          currentHighlighted = null;          showMobileInfo(params.seriesName, 'å–æ¶ˆé«˜äº®');        } else {          // å…ˆæ¸…é™¤ä¹‹å‰çš„é«˜äº®          if (currentHighlighted) {            myChart.dispatchAction({              type: 'downplay',              seriesName: currentHighlighted,            });            myChart.dispatchAction({              type: 'legendDownplay',              name: currentHighlighted,            });          }          // é«˜äº®æ–°çš„ç³»åˆ—          myChart.dispatchAction({            type: 'highlight',            seriesName: params.seriesName,          });          myChart.dispatchAction({            type: 'legendHighlight',            name: params.seriesName,          });          currentHighlighted = params.seriesName;          showMobileInfo(params.seriesName, 'ç‚¹å‡»é«˜äº®');        }      } else {        // PCç«¯ï¼šç‚¹å‡»é€‰ä¸­å›¾ä¾‹        myChart.dispatchAction({          type: 'legendToggleSelect',          name: params.seriesName,        });        showHoverInfo(params.seriesName, 'å›¾ä¾‹åˆ‡æ¢');      }    } else if (isMobile && currentHighlighted) {      // ç§»åŠ¨ç«¯ï¼šç‚¹å‡»ç©ºç™½åŒºåŸŸï¼Œå–æ¶ˆå½“å‰é«˜äº®      myChart.dispatchAction({        type: 'downplay',        seriesName: currentHighlighted,      });      myChart.dispatchAction({        type: 'legendDownplay',        name: currentHighlighted,      });      showMobileInfo(currentHighlighted, 'å–æ¶ˆé«˜äº®');      currentHighlighted = null;    }  });  // æ˜¾ç¤ºhoverçŠ¶æ€ä¿¡æ¯ï¼ˆPCç«¯ï¼‰  function showHoverInfo(seriesName, action) {    const info = document.querySelector('.demo-highlight');    if (!info) return;        if (action === 'é«˜äº®' || action === 'ç‚¹å‡»é«˜äº®') {      info.innerHTML = `âœ¨ <strong>${seriesName}</strong> æ­£åœ¨é«˜äº®æ˜¾ç¤ºï¼`;      info.style.background = '#d4edda';      info.style.borderColor = '#c3e6cb';      info.style.color = '#155724';    } else if (action === 'å›¾ä¾‹åˆ‡æ¢') {      info.innerHTML = `ğŸ”„ <strong>${seriesName}</strong> å›¾ä¾‹çŠ¶æ€å·²åˆ‡æ¢ï¼`;      info.style.background = '#e3f2fd';      info.style.borderColor = '#bbdefb';      info.style.color = '#1565c0';    } else {      info.innerHTML = isMobile        ? 'ğŸ“± <strong>ç§»åŠ¨ç«¯</strong>ï¼šç‚¹å‡»çº¿æ¡é™„è¿‘â†’é«˜äº®åˆ‡æ¢ï¼å†æ¬¡ç‚¹å‡»â†’å–æ¶ˆé«˜äº®ï¼ç‚¹å‡»ç©ºç™½â†’å–æ¶ˆ'        : 'ğŸ’¡ <strong>PCç«¯</strong>ï¼šé¼ æ ‡hoverçº¿æ¡é™„è¿‘â†’é«˜äº® / åå­—çº¿ç»è¿‡â†’ä¸é«˜äº®ï¼';      info.style.background = '#fff3cd';      info.style.borderColor = '#ffeaa7';      info.style.color = '#856404';    }  }  // æ˜¾ç¤ºç§»åŠ¨ç«¯çŠ¶æ€ä¿¡æ¯  function showMobileInfo(seriesName, action) {    const info = document.querySelector('.demo-highlight');    if (!info) return;        if (action === 'ç‚¹å‡»é«˜äº®') {      info.innerHTML = `ğŸ“± <strong>${seriesName}</strong> å·²é«˜äº®ï¼å†æ¬¡ç‚¹å‡»å¯å–æ¶ˆ`;      info.style.background = '#d4edda';      info.style.borderColor = '#c3e6cb';      info.style.color = '#155724';    } else if (action === 'å–æ¶ˆé«˜äº®') {      info.innerHTML = `ğŸ“± <strong>${seriesName}</strong> é«˜äº®å·²å–æ¶ˆï¼ç‚¹å‡»å…¶ä»–çº¿æ¡å¯é«˜äº®`;      info.style.background = '#f8d7da';      info.style.borderColor = '#f5c6cb';      info.style.color = '#721c24';    }  }  // å“åº”å¼å¤„ç†  window.addEventListener('resize', function () {    if (myChart && !myChart.isDisposed()) {      myChart.resize();    }  });  // æ·»åŠ è¯´æ˜æ–‡å­—  console.log('ğŸ“Š DemoåŠ è½½å®Œæˆï¼');  console.log('ğŸ¯ æµ‹è¯•è¦ç‚¹ï¼š');  if (isMobile) {    console.log('ğŸ“± ç§»åŠ¨ç«¯æ¨¡å¼ï¼š');    console.log('1. ç‚¹å‡»çº¿æ¡é™„è¿‘ â†’ é«˜äº®åˆ‡æ¢');    console.log('2. å†æ¬¡ç‚¹å‡»åŒä¸€çº¿æ¡ â†’ å–æ¶ˆé«˜äº®');    console.log('3. ç‚¹å‡»å…¶ä»–çº¿æ¡ â†’ åˆ‡æ¢åˆ°æ–°çº¿æ¡é«˜äº®');    console.log('4. ç‚¹å‡»ç©ºç™½åŒºåŸŸ â†’ å–æ¶ˆå½“å‰é«˜äº®');  } else {    console.log('ğŸ’» PCç«¯æ¨¡å¼ï¼š');    console.log('1. é¼ æ ‡hoverçº¿æ¡é™„è¿‘ â†’ çº¿æ¡é«˜äº®');    console.log('2. åå­—çº¿ç»è¿‡æ•°æ®ç‚¹ â†’ çº¿æ¡ä¸é«˜äº®');    console.log('3. é¼ æ ‡ç¦»å¼€ â†’ æ¢å¤æ­£å¸¸');  }  console.log('5. é€æ˜è¾…åŠ©çº¿æ‰©å¤§äº†äº¤äº’æ£€æµ‹èŒƒå›´ï¼ˆ12pxï¼‰');  // ğŸ¯ åˆå§‹åŒ–æç¤ºä¿¡æ¯  showHoverInfo('', 'åˆå§‹åŒ–');});</script><h2 id="ğŸ“-æŠ€æœ¯è¦ç‚¹æ€»ç»“">ğŸ“ æŠ€æœ¯è¦ç‚¹æ€»ç»“</h2><ol><li><strong>å…¨å±€é…ç½®</strong>ï¼šé€šè¿‡ <code>axisPointer.triggerEmphasis: false</code> ç¦ç”¨åå­—çº¿è§¦å‘é«˜äº®</li><li><strong>é€æ˜è¾…åŠ©çº¿</strong>ï¼šåˆ›å»ºåŒåé€æ˜çº¿æ¡ï¼Œå®½åº¦ 6 å€ï¼Œç”¨äºæ‰©å¤§äº¤äº’åŒºåŸŸ</li><li><strong>è®¾å¤‡é€‚é…</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ç§»åŠ¨è®¾å¤‡ï¼Œé‡‡ç”¨ä¸åŒçš„äº¤äº’æ–¹å¼</li><li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šè·Ÿè¸ªå½“å‰é«˜äº®çŠ¶æ€ï¼Œæ”¯æŒåˆ‡æ¢å’Œå–æ¶ˆ</li><li><strong>å“åº”å¼è®¾è®¡</strong>ï¼šå›¾è¡¨è‡ªåŠ¨é€‚åº”å®¹å™¨å¤§å°å˜åŒ–</li></ol><p>è¿™ç§æ–¹æ¡ˆå®Œç¾è§£å†³äº† ECharts çº¿æ¡äº¤äº’çš„ç²¾ç¡®æ€§é—®é¢˜ï¼Œæ— è®ºåœ¨ PC ç«¯è¿˜æ˜¯ç§»åŠ¨ç«¯éƒ½èƒ½æä¾›ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒï¼</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>å‰ç«¯å¼€å‘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ECharts</tag>
      
      <tag>JavaScript</tag>
      
      <tag>æ•°æ®å¯è§†åŒ–</tag>
      
      <tag>äº¤äº’è®¾è®¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MasterGo DSL Transform å±æ€§è½¬æ¢ï¼ˆFigma ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰</title>
    <link href="/2024/11/03/masterGo_Transform/"/>
    <url>/2024/11/03/masterGo_Transform/</url>
    
    <content type="html"><![CDATA[<h3 id="DSL-ä¸­-relativeTransform-å¯¹è±¡">DSL ä¸­ relativeTransform å¯¹è±¡</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JAVASCRIPT">[<br>  [<span class="hljs-number">0.7071067690849304</span>, <span class="hljs-number">0.7071067690849304</span>, <span class="hljs-number">64.82373046875</span>],<br>  [-<span class="hljs-number">0.7071067690849304</span>, <span class="hljs-number">0.7071067690849304</span>, <span class="hljs-number">46.4097900390625</span>]<br>]<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * [</span><br><span class="hljs-comment"> *   [a, c, tx],</span><br><span class="hljs-comment"> *   [b, d, ty]</span><br><span class="hljs-comment"> * ]</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ 2Ã—3 ä»¿å°„å˜æ¢çŸ©é˜µï¼ˆAffine Transformï¼‰ï¼Œä¸ CSS ä¸­çš„ transform å‡ ä¹ä¸€æ ·ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-comment">/* transform: matrix(a, b, c, d, tx, ty); */</span><br><span class="hljs-attribute">transform</span>: <span class="hljs-built_in">matrix</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p><small>MasterGo å’Œ Figma çš„ relativeTransform ä¸ CSS ä¸­çš„ <code>transform: matrix()</code> ä¸€æ ·ï¼ŒY è½´çš„æ­£æ–¹å‘æ˜¯å‘ä¸‹ï¼›è€Œ CSS ä¸­çš„ <code>transform: rotate(45deg)</code> çš„ Y è½´æ­£æ–¹å‘æ˜¯å‘ä¸Šï¼Œä¸¤è€…ä¸åŒã€‚</small></p><table><thead><tr><th>å«ä¹‰</th><th>CSS <code>matrix(a,b,c,d,tx,ty)</code></th><th>Figma <code>relativeTransform</code></th></tr></thead><tbody><tr><td>ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—</td><td>a</td><td>matrix[0][0]</td></tr><tr><td>ç¬¬äºŒè¡Œç¬¬ä¸€åˆ—</td><td>b</td><td>matrix[1][0]</td></tr><tr><td>ç¬¬ä¸€è¡Œç¬¬äºŒåˆ—</td><td>c</td><td>matrix[0][1]</td></tr><tr><td>ç¬¬äºŒè¡Œç¬¬äºŒåˆ—</td><td>d</td><td>matrix[1][1]</td></tr><tr><td>ç¬¬ä¸€è¡Œç¬¬ä¸‰åˆ—</td><td>tx</td><td>matrix[0][2]</td></tr><tr><td>ç¬¬äºŒè¡Œç¬¬ä¸‰åˆ—</td><td>ty</td><td>matrix[1][2]</td></tr></tbody></table><p>æ›´æ¸…æ™°çš„å¯¹ç…§ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-comment">// CSS â†’ Figma</span><br>[<br>  [a, c, tx],<br>  [b, <span class="hljs-keyword">d</span>, <span class="hljs-keyword">ty</span>]<br>]<br><br><span class="hljs-comment">// Figma â†’ CSS</span><br><span class="hljs-built_in">matrix</span>(a, b, c, <span class="hljs-keyword">d</span>, tx, <span class="hljs-keyword">ty</span>)<br><br></code></pre></td></tr></table></figure><h3 id="DSL-ä¸­-relativeTransformã€CSS-ä¸­-matrix-å’Œå•ä¸€å±æ€§è½¬æ¢">DSL ä¸­ relativeTransformã€CSS ä¸­ matrix å’Œå•ä¸€å±æ€§è½¬æ¢</h3><ul><li>relativeTransform2SingleAttribute</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">relativeTransform2SingleAttribute</span>(<span class="hljs-params">matrix</span>) &#123;<br>  <span class="hljs-keyword">const</span> [[a, c, tx], [b, d, ty]] = matrix;<br><br>  <span class="hljs-keyword">const</span> translation = &#123; <span class="hljs-attr">x</span>: tx, <span class="hljs-attr">y</span>: ty &#125;;<br><br>  <span class="hljs-keyword">const</span> scaleX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(a * a + b * b);<br>  <span class="hljs-keyword">const</span> scaleY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(c * c + d * d);<br><br>  <span class="hljs-comment">// CSS è®¾ç½®å•ä¸€å±æ€§æ—¶ï¼Œrotate çš„ Y è½´æ­£å‘ç›¸å</span><br>  <span class="hljs-keyword">const</span> rotation = -<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(b / scaleX, a / scaleX) * (<span class="hljs-number">180</span> / <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>);<br><br>  <span class="hljs-comment">// ä¿®æ­£æµ®ç‚¹è¯¯å·®</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">fix</span> = (<span class="hljs-params">n</span>) =&gt; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(n - <span class="hljs-number">1</span>) &lt; <span class="hljs-number">1e-6</span> ? <span class="hljs-number">1</span> : n;<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    rotation,<br>    <span class="hljs-attr">scale</span>: &#123; <span class="hljs-attr">x</span>: <span class="hljs-title function_">fix</span>(scaleX), <span class="hljs-attr">y</span>: <span class="hljs-title function_">fix</span>(scaleY) &#125;,<br>    translation,<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åœ¨ MasterGo ä¸­ï¼Œç›®å‰å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼šå˜æ¢åï¼ŒDSL å¯¼å‡ºçš„å®½é«˜ä»æ˜¯åŸå§‹å…ƒç´ çš„å®½é«˜ï¼Œå¹¶éå¤–æ¥çŸ©å½¢çš„å®½é«˜ï¼›ä½†ä¸‹è½½å‡ºæ¥çš„å…ƒç´ å´æ˜¯å¤–æ¥çŸ©å½¢çš„å›¾ç‰‡ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨è®¡ç®—å¤–æ¥çŸ©å½¢å®½é«˜ã€‚</li></ul><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs gml"><span class="hljs-comment">// ä¼ å…¥ MasterGo DSL çš„çŸ©é˜µ</span><br><span class="hljs-comment">// è¾“å‡ºç»“æœä»ç„¶è¦å‘ä¸Šå–æ•´ï¼Œå› ä¸ºä¸‹è½½çš„å›¾ç‰‡å®½é«˜æ²¡æœ‰å°æ•°ç‚¹ï¼Œå‡å‘ä¸Šå–æ•´ã€‚</span><br><span class="hljs-keyword">function</span> getBoundingBoxAfterTransform(matrix, width, height) &#123;<br>  const [[a, c, tx], [b, d, ty]] = matrix;<br><br>  <span class="hljs-comment">// åŸå§‹çŸ©å½¢çš„å››ä¸ªé¡¶ç‚¹</span><br>  const points = [<br>    &#123; <span class="hljs-variable language_">x</span>: <span class="hljs-number">0</span>, <span class="hljs-variable language_">y</span>: <span class="hljs-number">0</span> &#125;,<br>    &#123; <span class="hljs-variable language_">x</span>: width, <span class="hljs-variable language_">y</span>: <span class="hljs-number">0</span> &#125;,<br>    &#123; <span class="hljs-variable language_">x</span>: <span class="hljs-number">0</span>, <span class="hljs-variable language_">y</span>: height &#125;,<br>    &#123; <span class="hljs-variable language_">x</span>: width, <span class="hljs-variable language_">y</span>: height &#125;,<br>  ];<br><br>  <span class="hljs-comment">// ç»è¿‡å˜æ¢åçš„ç‚¹</span><br>  const transformed = points.map(p =&gt; (&#123;<br>    <span class="hljs-variable language_">x</span>: a * p.<span class="hljs-variable language_">x</span> + c * p.<span class="hljs-variable language_">y</span> + tx,<br>    <span class="hljs-variable language_">y</span>: b * p.<span class="hljs-variable language_">x</span> + d * p.<span class="hljs-variable language_">y</span> + ty<br>  &#125;));<br><br>  <span class="hljs-comment">// æ±‚ min / max</span><br>  const xs = transformed.map(p =&gt; p.<span class="hljs-variable language_">x</span>);<br>  const ys = transformed.map(p =&gt; p.<span class="hljs-variable language_">y</span>);<br><br>  const minX = Math.<span class="hljs-built_in">min</span>(...xs);<br>  const maxX = Math.<span class="hljs-built_in">max</span>(...xs);<br>  const minY = Math.<span class="hljs-built_in">min</span>(...ys);<br>  const maxY = Math.<span class="hljs-built_in">max</span>(...ys);<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    width: maxX - minX,<br>    height: maxY - minY,<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æŠŠ rotation + scale + translation é‡æ–°ç»„åˆæˆ MasterGo çš„ relativeTransform</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">composeRelativeTransform</span>(<span class="hljs-params">&#123; rotation, scale, translation &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> rad = -rotation * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>; <span class="hljs-comment">// å–åï¼Œå› ä¸º CSS å•ç‹¬è®¾ç½® rotate æ—¶çš„ Y è½´æ–¹å‘ä¸æ­¤ç›¸åã€‚</span><br><br>  <span class="hljs-keyword">const</span> a = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(rad) * scale.<span class="hljs-property">x</span>;<br>  <span class="hljs-keyword">const</span> b = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(rad) * scale.<span class="hljs-property">x</span>;<br>  <span class="hljs-keyword">const</span> c = -<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(rad) * scale.<span class="hljs-property">y</span>;<br>  <span class="hljs-keyword">const</span> d = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(rad) * scale.<span class="hljs-property">y</span>;<br><br>  <span class="hljs-keyword">const</span> tx = translation.<span class="hljs-property">x</span>;<br>  <span class="hljs-keyword">const</span> ty = translation.<span class="hljs-property">y</span>;<br><br>  <span class="hljs-keyword">return</span> [<br>    [a, c, tx],<br>    [b, d, ty],<br>  ];<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MasterGo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MasterGo</tag>
      
      <tag>CSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ReactåŸç†</title>
    <link href="/2024/11/03/React%E5%8E%9F%E7%90%86/"/>
    <url>/2024/11/03/React%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h3 id="React-Fiber">React Fiber</h3><p>React 15 ä¹‹å‰æ˜¯ stack Reconcilerï¼Œä¹Ÿå°±æ˜¯ä»è™šæ‹Ÿ DOM çš„æ ¹èŠ‚ç‚¹é€’å½’éå†æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œè·Ÿæ—§çš„èŠ‚ç‚¹å¯¹æ¯”ï¼Œè®°å½•æ‰€æœ‰å·®å¼‚ï¼Œè¿›è¡Œæ›´æ–°ï¼Œç„¶åç«‹å³æ‰§è¡Œæ›´æ”¹ï¼Œç›´åˆ°æ›´æ–°å®Œæˆã€‚ä½†æ˜¯åœ¨å¤§ç»„ä»¶æ ‘æ›´æ–°çš„æ—¶å€™ï¼Œå°±æœ‰é•¿æœŸå æ®ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´é¡µé¢å“åº”ä¸äº†ï¼Œå¹¶ä¸”æœ‰æ‰å¸§ã€‚<br>React 16 å¼€å‘å¼•å…¥äº† Fiber æ¶æ„ï¼ŒæŠŠæ¯”è¾ƒè™šæ‹Ÿ DOM å¹¶è®°å½•å˜æ›´é˜¶æ®µçš„ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡ï¼Œç„¶åæ ¹æ®ä¼˜å…ˆçº§ï¼Œæ¯æ‰§è¡Œä¸€å°æ®µæ—¶é—´(5ms)ï¼Œå°±æäº¤è¿™äº›æ›´æ–°ï¼Œäº¤ç»™æµè§ˆå™¨å…ˆå»ç»˜åˆ¶ DOMã€å“åº”ç”¨æˆ·è¾“å…¥ã€‚</p><h4 id="è¾¨æ">è¾¨æ</h4><ol><li>React å¹¶æ²¡æœ‰æé«˜æ¸²æŸ“æ€§èƒ½ï¼Œåè€Œé™ä½çš„æ¸²æŸ“æ€§èƒ½ï¼Œå› ä¸ºä¸­é—´è¿˜è¦å¯¹æ¯”è™šæ‹Ÿ DOMã€‚åªæ˜¯è®©è§†å›¾æ›´æ–°æ›´é«˜æ•ˆã€æ›´å¯ç»´æŠ¤ã€‚é«˜æ•ˆæ˜¯å£°æ˜å¼ UI çš„é«˜æ•ˆï¼Œæ˜¯å¼€å‘é˜¶æ®µçš„é«˜æ•ˆï¼Œä¸æ˜¯æ¸²æŸ“é˜¶æ®µçš„é«˜æ•ˆã€‚</li><li>å¦‚æœæ‰§è¡Œ DOM æ“ä½œï¼Œå¢åˆ æ”¹äº§å’Œæ ·å¼ä¿®æ”¹ï¼Œæ˜¯ä¸ä¼šç«‹åˆ»ç»˜åˆ¶çš„ï¼Œå…ˆæ”¾åœ¨æ¸²æŸ“é˜Ÿåˆ—ï¼Œç­‰å¾…å±å¹•åˆ·æ–°èŠ‚ç‚¹åˆ°æ¥ï¼Œå†é›†ä¸­ä¸€æ¬¡æ€§æ¸²æŸ“æ›´æ–°ã€‚å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š<a href="/2023/12/26/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6/" title="æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶">æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶</a>ã€‚æ‰€ä»¥ React çš„ Fiber æ¶æ„ï¼Œå°±æ˜¯è§£å†³ä¸€å¤§å †ä»»åŠ¡é›†ä¸­æ¸²æŸ“å¸¦æ¥çš„æ‰å¸§é—®é¢˜å’Œä¸»çº¿ç¨‹æ— æ³•å“åº”é—®é¢˜ï¼Œå°†ä»»åŠ¡ç”¨ Fiber å¯¹è±¡åˆ†æˆä¸€ä¸ªä¸ªå°ä»»åŠ¡ï¼Œç„¶ååˆ†æ‰¹æ“ä½œ DOMï¼Œåˆ†æ‰¹æ¥è®©æµè§ˆå™¨æ¸²æŸ“ã€‚</li></ol><h4 id="Fiber-å¯¹è±¡ç»“æ„">Fiber å¯¹è±¡ç»“æ„</h4><p>key: string; React Element å”¯ä¸€æ ‡è¯†ã€‚æ¸²æŸ“åˆ—è¡¨æ—¶ï¼Œè®¾ç½®çš„ key å°±æ˜¯å®ƒã€‚<br>type: :ç»„ä»¶æ„é€ å™¨,ä¾‹å¦‚&quot;div&quot;<br>tag: WorkTag; // React Element ç±»å‹ï¼Œæ¯”å¦‚ ClassComponentã€FunctionComponentã€SuspenseComponentã€HostText(æ–‡æœ¬èŠ‚ç‚¹) ç­‰ã€‚<br>props: ; ç»„ä»¶å‚æ•°<br>memoizedState: any; // å­˜æ”¾ Hooks é“¾è¡¨çš„åœ°æ–¹ï¼ŒuseState/useEffect éƒ½æ”¾åœ¨è¿™é‡Œï¼Œåªä¸è¿‡å­˜æ”¾çš„å†…å®¹ä¸åŒï¼Œåˆ†åˆ«æ˜¯ Hook å¯¹è±¡ã€Effect å¯¹è±¡ã€‚<br>dependencies: Dependencies; //å­˜æ”¾ä¾èµ–çš„ Context çš„é“¾è¡¨ã€‚</p><h3 id="React-Concurrent">React Concurrent</h3><p>Fiber æ¶æ„æä¾›ä¸­æ–­çš„èƒ½åŠ›ï¼ŒReact v18 å¢åŠ  Concurrent Featureï¼Œæ¯”å¦‚ useTransitionã€useDeferredValueã€Suspenseã€‚ä½¿ç”¨<code>createRoot</code>åˆ›å»ºæ ¹èŠ‚ç‚¹ï¼Œè‡ªåŠ¨å¼€å¯ Concurrent Modeï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¹æ‰€æœ‰æ›´æ–°è‡ªåŠ¨è¿›è¡Œæ‰¹å¤„ç†ã€‚è¿™äº›éƒ½æ˜¯ React v18 è¿™ä¸ªç‰ˆæœ¬æ–°ç‰¹æ€§ï¼ŒReact 18 ä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼Œæˆ–è€…å«æ——èˆ°ç‰ˆæœ¬ã€‚</p><h3 id="useState-setState-ç­‰çŠ¶æ€æ›´æ–°æ˜¯å¼‚æ­¥çš„è¿˜æ˜¯åŒæ­¥çš„ã€‚">useState/setState ç­‰çŠ¶æ€æ›´æ–°æ˜¯å¼‚æ­¥çš„è¿˜æ˜¯åŒæ­¥çš„ã€‚</h3><p>åŒæ­¥å’Œå¼‚æ­¥æ˜¯æŒ‡ä½¿ç”¨<code>useState</code>/<code>setState</code>æ›´æ–° state å€¼ï¼Œä¼šä¸ä¼šç«‹åˆ»åæ˜ åˆ° state ä¸Šã€‚</p><ul><li>React 18 ä¹‹å‰ï¼ŒuseState çš„æ›´æ–°è¡Œä¸ºå’Œ setState ä¸€è‡´ï¼šåœ¨ React äº‹ä»¶ä¸­æ˜¯æ‰¹é‡å¼‚æ­¥çš„ï¼Œåœ¨åŸç”Ÿäº‹ä»¶(onClickã€setTimeout)ä¸­æ˜¯åŒæ­¥çš„ã€‚</li><li>React 18 ä¹‹åï¼Œå¼•å…¥äº†è‡ªåŠ¨æ‰¹å¤„ç†ï¼Œæ— è®ºåœ¨ä»»ä½•åœºæ™¯éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè¦æƒ³è®¿é—®åŒæ­¥çš„ state å€¼ï¼Œéœ€è¦ä½¿ç”¨å›è°ƒå‡½æ•°çš„å½¢å¼ï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure></li></ul><h3 id="useState-useEffect-éƒ½æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ”¾è¿›æ¡ä»¶åˆ¤æ–­é‡Œ">useState/useEffect éƒ½æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ”¾è¿›æ¡ä»¶åˆ¤æ–­é‡Œ</h3><p>é¦–æ¬¡æ¸²æŸ“ useState ä¼šå†…éƒ¨è°ƒç”¨çš„ mountStateï¼Œä¼šåˆ›å»ºä¸€ä¸ª Hook å¯¹è±¡æ”¾åœ¨ Fiber çš„ memoizedState é“¾ä¸Šï¼ŒmemoizedState æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ‰€æœ‰çš„ Hooks åˆå§‹åˆ›å»ºçš„æ—¶å€™ï¼Œéƒ½ä¼šè¿½åŠ åœ¨é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ next ä¸Šã€‚<br>æ›´æ–°æ¸²æŸ“æ—¶ï¼ŒuseState å†…éƒ¨è°ƒç”¨çš„ UpdateStateï¼Œä¼šä» memoizedState ä¸Šç¬¬ä¸€ä¸ªèŠ‚ç‚¹å»å–æ›´æ–°å€¼ï¼Œä¸‹ä¸€ä¸ª useSateï¼Œå°±é€šè¿‡å½“å‰ hook.next è·å–ä¸‹ä¸€ä¸ªçš„ Hook æ¥æ›´æ–°ã€‚æ‰€ä»¥ useState è¿™ç§ hooks å‡½æ•°ä¸èƒ½å°‘ï¼Œå› ä¸ºä»–ä»¬æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚</p><blockquote><p>å»¶ä¼¸ 1ï¼šé¦–æ¬¡æ¸²æŸ“ã€æ›´æ–°æ¸²æŸ“ã€render(ç±»æ¯” classComponent çš„ render æ–¹æ³•é‡Œè®¾ç½® setState)æœŸé—´,ä½¿ç”¨çš„æ˜¯ä¸åŒ hooks APIï¼Œåˆ†åˆ«æ˜¯ HooksDispatcherOnMountã€HooksDispatcherOnUpdateã€HooksDispatcherOnRerenderã€‚</p></blockquote><blockquote><p>å»¶ä¼¸ 2ï¼šupdateState æœ€ç»ˆè°ƒç”¨ updateWorkInProgressHook å‡½æ•°æ¥å–ä¸‹ä¸€ä¸ª Hook èŠ‚ç‚¹ï¼Œå†…éƒ¨ä»£ç å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">if</span> (currentHook === <span class="hljs-literal">null</span>) &#123;<br>  <span class="hljs-keyword">const</span> current = currentlyRenderingFiber.<span class="hljs-property">alternate</span>;<br>  <span class="hljs-keyword">if</span> (current !== <span class="hljs-literal">null</span>) &#123;<br>    nextCurrentHook = current.<span class="hljs-property">memoizedState</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    nextCurrentHook = <span class="hljs-literal">null</span>;<br>  &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  nextCurrentHook = currentHook.<span class="hljs-property">next</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="React-åˆæˆäº‹ä»¶">React åˆæˆäº‹ä»¶</h3><p>åˆæˆäº‹ä»¶æ˜¯æŒ‡ï¼ŒåŸºäºåŸç”Ÿäº‹ä»¶ï¼Œå¯¹ä¸åŒæµè§ˆå™¨ï¼Œè¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œåœ¨è¿›è¡ŒåŠŸèƒ½å¼ºåŒ–ã€‚äº‹ä»¶å§”æ‰˜åœ¨ Root ä¸Šï¼Œä¹Ÿå°±æ˜¯åœ¨ Root ä¸Šç›‘å¬æ‰€æœ‰äº‹ä»¶ï¼Œç„¶åå†å» Fiber æ ‘ä¸­æ‰¾åˆ°ç›‘å¬å¯¹åº”äº‹ä»¶çš„å›è°ƒå‡½æ•°ï¼Œå†æ‰§è¡Œã€‚æ‰€æœ‰äº‹ä»¶æ³¨å†Œåœ¨ Root æ—¶ï¼Œå°±å¸¦æœ‰ä¼˜å…ˆçº§ï¼Œåˆ†ä¸ºç¦»æ•£äº‹ä»¶(DiscreteEventPriority)ï¼Œæ¯”å¦‚ clickã€input äº‹ä»¶éƒ½æ˜¯ç«‹å³æ‰§è¡Œçš„ã€è¿ç»­äº‹ä»¶(ContinuousEventPriority)ï¼Œæ¯”å¦‚ scrollã€mousemoveã€drag ç­‰éƒ½æ˜¯å¯å»¶è¿Ÿçš„ã€‚</p><blockquote><p>ä¼˜åŠ¿ï¼šè§£å†³æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ï¼›äº‹ä»¶å§”æ‰˜ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ï¼›ç»Ÿä¸€ç®¡ç†äº‹ä»¶ï¼Œæ–¹ä¾¿æ ¹æ®ä¼˜å…ˆçº§è¿›è°ƒåº¦<br>æ‰§è¡Œé¡ºåºï¼šdocumentã€Root æ•è·äº‹ä»¶ã€ç„¶åæ˜¯ ReactElement çš„æ•è·äº‹ä»¶ã€ç„¶åæ˜¯ ReactElement çš„å†’æ³¡äº‹ä»¶ã€æœ€åæ˜¯ Rootã€document çš„å†’æ³¡äº‹ä»¶ã€‚è¿™é‡Œå¹¶æ²¡æœ‰é˜»æ­¢ DOM çš„åŸç”Ÿäº‹ä»¶ï¼Œæ³¨å†Œ DOM çš„åŸç”Ÿäº‹ä»¶è¿˜æ˜¯ä¼šæ‰§è¡Œï¼Œæ•è·äº‹ä»¶ä¼šåœ¨ ReactElement äº‹ä»¶ä¹‹åæ‰§è¡Œï¼Œå†’æ³¡äº‹ä»¶ä¼šåœ¨ ReactElement ä¹‹å‰æ‰§è¡Œã€‚</p></blockquote><h3 id="ç»„ä»¶é€šä¿¡">ç»„ä»¶é€šä¿¡</h3><p>React æ˜¯å•å‘æ•°æ®æµï¼Œçˆ¶ç»„ä»¶çš„æ•°æ®å’Œè¡Œæ•°å¯ä»¥é€šè¿‡ props è½¬ç»™å­ç»„ä»¶ã€‚çˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡ forwardRef+useImperativeHandle æ–¹æ³•æ¥æŸ¥é˜…å­ç»„ä»¶æ•°æ®å’Œè°ƒç”¨å­ç»„ä»¶å‡½æ•°ã€‚æ­¤å¤–è¿˜å¯ä»¥é€šè¿‡ context API è·¨å±‚çº§é€šä¿¡ï¼Œè¿˜æœ‰ zustand ç­‰å¤–éƒ¨åº“ï¼Œé€šè¿‡å‘å¸ƒè®¢é˜…å½¢å¼+useSyncExternalStore æ¥è¿›è¡Œé€šä¿¡ã€‚</p><h4 id="context-å®ç°æœºåˆ¶">context å®ç°æœºåˆ¶</h4><ol><li><p>ä½¿ç”¨ createContext æ¥åˆ›å»º Context å¯¹è±¡ï¼Œå€¼å°±æ˜¯æ”¾åœ¨ context.currentValue çš„ä¸­ï¼ŒProvider æ˜¯æä¾›è€…ï¼ŒCustomer æ˜¯æ¶ˆè´¹è€…ï¼Œç°åœ¨å¸¸ç”¨ useContext æ¥æ¶ˆè´¹ã€‚</p></li><li><p>æ‰€æœ‰åµŒå¥—çš„ Context éƒ½æ”¾åœ¨ä¸€ä¸ªæ ˆç»“æ„ä¸­ï¼Œç”¨æ•°ç»„è¡¨ç¤ºçš„æ ˆï¼Œå…¨å±€å…¬ç”¨è¿™ä¸ªæ ˆã€‚é‡åˆ° Provider å°±å‹å…¥æ ˆï¼Œç¦»å¼€ Provider å°±æ¨å‡ºæ ˆã€‚</p><blockquote><p>åŒä¸€ä¸ª Provider è¿›è¡ŒåµŒå¥—,ç›¸åŒçš„ context åœ¨ä¸åŒä½œç”¨é‡Œå¯ä»¥è®¾ç½®ä¸åŒå€¼ã€‚ç¦»å¼€ Provider çš„æ—¶å€™ä¼šæ¢å¤ä¸Šä¸€ä¸ªå€¼ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// é—®é¢˜ï¼šåµŒå¥—Providerå¦‚ä½•æ­£ç¡®æ¢å¤å€¼ï¼Ÿ</span><br>&lt;<span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span> value=<span class="hljs-string">&quot;dark&quot;</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child1</span> /&gt;</span></span>  &#123;<span class="hljs-comment">/* åº”è¯¥è¯»åˆ° &quot;dark&quot; */</span>&#125;<br><br>  &lt;<span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span> value=<span class="hljs-string">&quot;light&quot;</span>&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child2</span> /&gt;</span></span>  &#123;<span class="hljs-comment">/* åº”è¯¥è¯»åˆ° &quot;light&quot; */</span>&#125;<br>  &lt;/<span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span>&gt;<br><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child3</span> /&gt;</span></span>  &#123;<span class="hljs-comment">/* åº”è¯¥è¯»åˆ° &quot;dark&quot;ï¼ˆæ¢å¤äº†ï¼ï¼‰ */</span>&#125;<br>&lt;/<span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span>&gt;<br><br><span class="hljs-comment">// æ ˆæ“ä½œå›¾è§£</span><br><br><span class="hljs-comment">// åˆå§‹çŠ¶æ€ï¼š</span><br><span class="hljs-comment">// index = -1</span><br><span class="hljs-comment">// valueCursor.current = null</span><br><span class="hljs-comment">// valueStack = []</span><br><br><span class="hljs-comment">// 1.push: index = 0ã€valueCursor.current = &quot;dark&quot;ã€valueStack = [null]ã€context._currentValue = &quot;dark&quot;</span><br><span class="hljs-comment">// 2.push: index = 1ã€valueCursor.current = &quot;light&quot;ã€valueStack = [null, &quot;dark&quot;]  // ä¿å­˜äº†å†å²å€¼ã€context._currentValue = &quot;light&quot;</span><br><span class="hljs-comment">// 3.pop: index =0 ã€valueCursor.current = dark // ä»valueStackæ¢å¤&quot;dark&quot;ã€valueStack = [null]ã€context._currentValue = &quot;dark&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨ useContext æ—¶ï¼Œä¼šåœ¨ Fiber çš„ dependencies ä¸Šè®°å½•ä»¥æ¥çš„ contextï¼ŒProvider çš„å€¼æ›´æ–°çš„æ—¶å€™ï¼Œä¼šéå†æ‰€æœ‰å­æ ‘çš„ dependenciesï¼Œå¦‚æœå­˜åœ¨å°±è§¦å‘æ›´æ–°ã€‚</p><blockquote><p>æ€§èƒ½ä¼˜åŒ–ï¼š1. ä½¿ç”¨ useMemo å¯¹å€¼è¿›è¡Œç¼“å­˜ï¼›2. æ‹†åˆ†å•ç‹¬çš„ contextã€‚</p></blockquote></li></ol><h3 id="diff-ç®—æ³•">diff ç®—æ³•</h3><p>æŒ‰ç…§æ–°èŠ‚ç‚¹æ˜¯å•èŠ‚ç‚¹æˆ–å¤šèŠ‚ç‚¹ä¸¤ç§æƒ…å†µ diffã€‚å•èŠ‚ç‚¹ Diff,éå†æ—§èŠ‚ç‚¹é“¾è¡¨ï¼Œæ‰¾åˆ° key ç›¸åŒå¹¶ä¸” type ä¹Ÿç›¸åŒæˆ–è€… ElementType ç›¸åŒçš„èŠ‚ç‚¹ï¼Œå¦‚æœæ‰¾åˆ°å°±å¤ç”¨ï¼Œå¹¶ä¸”åˆ é™¤å…¶ä»–å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ é™¤æ—§çš„ï¼Œåˆ›å»ºæ–°çš„ã€‚å¤šèŠ‚ç‚¹ diffï¼ŒåŒæ—¶éå†æ–°æ—§ä¸¤ä¸ªé“¾è¡¨ï¼Œindex=0 å¼€å§‹ï¼Œæ‰¾åˆ° index ç›¸ç­‰ï¼Œkey ä¹Ÿç›¸ç­‰çš„ Fiber å°±å¤ç”¨,é‡åˆ°ä¸ç›¸ç­‰çš„å°±è·³å‡ºç¬¬ä¸€è½®å¾ªç¯ï¼›ç„¶åçœ‹çœ‹æ–°é“¾è¡¨æ˜¯å¦è¿˜æœ‰å‰©ä½™ï¼Œæ²¡å‰©ä½™ï¼Œå°±åˆ é™¤æ—§é“¾è¡¨ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ï¼Œæœ‰å‰©ä½™çš„è¯ï¼Œçœ‹å°±æ—§é“¾è¡¨æ˜¯å¦è¿˜æœ‰å‰©ä½™ï¼Œæ²¡æœ‰å‰©ä½™ï¼Œå°±ç›´æ¥åˆ›å»ºæ–°çš„å‰©ä½™èŠ‚ç‚¹ï¼›å¦‚æœæ—§é“¾æ¥ä¹Ÿæœ‰å‰©ä½™èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæŠŠæ—§é“¾è¡¨ä¸Šçš„å‰©ä½™èŠ‚ç‚¹æ•´ç†æ•´ Map å¯¹è±¡ï¼Œéå†æ–°é“¾è¡¨ä» Map ä¸­çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°å¯å¤ç”¨çš„ï¼Œæ‰¾åˆ°å°±å¤ç”¨ï¼Œæ‰¾ä¸åˆ°çš„å°±åˆ›å»ºæ–°çš„ã€‚å¤šèŠ‚ç‚¹æ—¶ï¼Œä¸å†™ keyï¼Œä¼šå¢åŠ æ¯”è¾ƒæ¬¡æ•°ï¼Œå½±å“æ€§èƒ½ã€‚</p><h3 id="å¹¶å‘æ¨¡å¼ä¸‹-UI-ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰-å¦‚ä½•ä¿è¯-åŒç¼“å†²æœºåˆ¶">å¹¶å‘æ¨¡å¼ä¸‹ UI ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ å¦‚ä½•ä¿è¯(åŒç¼“å†²æœºåˆ¶)</h3>]]></content>
    
    
    <categories>
      
      <category>React</category>
      
    </categories>
    
    
    <tags>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginx åŸºç¡€é…ç½®</title>
    <link href="/2024/10/05/nginx%E9%85%8D%E7%BD%AE/"/>
    <url>/2024/10/05/nginx%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="ğŸŒ-nginx-é…ç½®">ğŸŒ nginx é…ç½®</h2><h3 id="ğŸ“-é™æ€èµ„æºæ–‡ä»¶é…ç½®-é€‚ç”¨-SPA-é¡¹ç›®">ğŸ“ é™æ€èµ„æºæ–‡ä»¶é…ç½®(é€‚ç”¨ SPA é¡¹ç›®)</h3><p>ä½¿ç”¨ location è¿›è¡Œ url æ˜ å°„æœ¬æœºèµ„æºï¼Œ^~æ˜¯å‰ç¼€åŒ¹é…ï¼Œå¹¶ä¸”å‘½ä¸­äº†ï¼Œå°±ä¸ä¼šå»åé¢ç»§ç»­åŒ¹é…è§„åˆ™äº†ã€‚ç”±äºæˆ‘ä»¬å¯èƒ½æœ‰å¾ˆå¤šçš„é™æ€èµ„æºé¡¹ç›®ï¼Œæ‰€ä»¥åªåœ¨å½“å‰çš„ location é‡Œï¼ŒæŠŠåŒ¹é…åˆ° url çš„éƒ¨åˆ†è·¯å¾„æ›¿æ¢/www/wwwroot/chat/chat_web/ã€‚æ¯”å¦‚è®¿é—®<code>https://qunyangbang.cn/chat_web/new-chat</code>ï¼Œåœ¨ nginx è¿™å±‚å°±ä¼šå˜æˆè®¿é—®<code>/www/wwwroot/chat/chat_web/new-chat</code>ã€‚<code>autoindex</code> æ˜¯å½“è·¯å¾„è®¿é—®çš„èµ„æºæ²¡æœ‰æ—¶ï¼Œä¼šå°è¯•æŸä¸ªè·¯å¾„ä¸‹çš„ <code>index.html</code>ã€‚<code>try_files</code> æ˜¯æŒ‰ç…§åˆ¶å®šé¡ºåºæŸ¥çœ‹æ–‡ä»¶ï¼Œ<code>try_files $uri $uri/ /chat_web/index.html;</code>è¿™é‡Œå°±æ˜¯å…ˆæ˜¯åŸè·¯å¾„($uri)ï¼Œå†å°è¯•è·¯å¾„ä¸‹çš„ index.html($uri/,å› ä¸ºå¼€å¯äº† autoindex,å°±æ˜¯ç»™è¿™é‡Œç”¨çš„)ï¼Œæœ€åå°è¯•è®¿é—®ç»å¯¹è·¯å¾„(/chat_web/index.htmlï¼Œè®¿é—®è¿™ä¸ªè·¯å¾„ï¼Œnginx ä¼šæŠŠä»–ä»¿ä½œæ–°çš„å†…éƒ¨è¯·æ±‚ï¼Œé‡æ–°è¿›è¡Œ location åŒ¹é…ï¼Œç„¶åå°±èƒ½æ‰¾åˆ°èµ„æºäº†)ã€‚</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">server &#123;<br>  <span class="hljs-string">...</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-string">...</span><br><br>  location ^~<span class="hljs-string">/chat_web/</span> &#123;<br>    <span class="hljs-keyword">alias</span> <span class="hljs-string">/www/wwwroot/chat/chat_web/</span>;<br>    autoindex on;<br>    <span class="hljs-keyword">try</span>_files $uri $uri/ <span class="hljs-string">/chat_web/index.html</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="âš¡-é™æ€èµ„æºæ€§èƒ½ä¼˜åŒ–">âš¡ é™æ€èµ„æºæ€§èƒ½ä¼˜åŒ–</h3><ol><li><p>ğŸ—œï¸ å¼€å¯ Gzipï¼Œå‹ç¼©èµ„æºæ–‡ä»¶ï¼Œæé«˜ä¼ è¾“æ•ˆç‡</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">http&#123;<br>    gzip <span class="hljs-literal">on</span>; <span class="hljs-comment"># å¼€å§‹gzip</span><br>    gzip_min_length  <span class="hljs-number">1</span>k; <span class="hljs-comment"># åªæœ‰å½“æ–‡ä»¶å¤§å° â‰¥ 1KB æ—¶æ‰è¿›è¡Œgzipå‹ç¼©</span><br>    gzip_buffers     <span class="hljs-number">4</span> <span class="hljs-number">16</span>k; <span class="hljs-comment"># è®¾ç½®gzipå‹ç¼©çš„ç¼“å†²åŒºï¼Œä½¿ç”¨ 4 ä¸ª 16KB çš„ç¼“å†²åŒºæ¥å­˜å‚¨å‹ç¼©æ•°æ®</span><br>    gzip_http_version <span class="hljs-number">1.1</span>; <span class="hljs-comment"># æŒ‡å®šå¯ç”¨gzipå‹ç¼©çš„HTTPåè®®ç‰ˆæœ¬ï¼ŒHTTP/2ï¼šä¹Ÿä¼šè¿›è¡Œgzipå‹ç¼©</span><br>    gzip_comp_level <span class="hljs-number">2</span>; <span class="hljs-comment"># è®¾ç½®gzipå‹ç¼©çº§åˆ«ï¼Œ1-9ï¼ˆ1æœ€å¿«ä½†å‹ç¼©ç‡æœ€ä½ï¼Œ9æœ€æ…¢ä½†å‹ç¼©ç‡æœ€é«˜ï¼‰</span><br>    gzip_types     <span class="hljs-comment"># text/plain application/javascript application/x-javascript text/javascript text/css application/xml; # æŒ‡å®šéœ€è¦å‹ç¼©çš„MIMEç±»å‹</span><br>    gzip_vary <span class="hljs-literal">on</span>; <span class="hljs-comment"># æ·»åŠ Vary: Accept-Encodingå“åº”å¤´ï¼Œå‘Šè¯‰ç¼“å­˜æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒå‹ç¼©æ¥ç¼“å­˜ä¸åŒç‰ˆæœ¬</span><br>    gzip_proxied   expired <span class="hljs-literal">no</span>-cache <span class="hljs-literal">no</span>-store private auth; <span class="hljs-comment"># åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯¹ä»£ç†è¯·æ±‚è¿›è¡Œå‹ç¼©(å“åº”å¤´åŒ…å«è¿‡æœŸæ—¶é—´çš„è¯·æ±‚ã€å“åº”å¤´åŒ…å«Cache-Control: no-cacheçš„è¯·æ±‚ï¼Œç­‰)</span><br>    gzip_disable   <span class="hljs-string">&quot;MSIE [1-6]\.&quot;</span>; <span class="hljs-comment"># ç¦ç”¨ç‰¹å®šæµè§ˆå™¨çš„gzipå‹ç¼©ï¼Œå¯¹IE 1-6ç‰ˆæœ¬çš„æµè§ˆå™¨ç¦ç”¨gzip</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ğŸ’¾ å›¾ç‰‡/CSS/JS ç¼“å­˜</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><br>   <span class="hljs-comment"># JS/CSS æ–‡ä»¶çš„ä¸“é—¨ location</span><br>     <span class="hljs-section">location</span> ~_<span class="hljs-regexp"> ^/chat_web/._\.(js|css)$</span> &#123;<br>     <span class="hljs-attribute">alias</span> /www/wwwroot/chat/chat_web/;<br>     <span class="hljs-attribute">expires</span> <span class="hljs-number">1y</span>;<br>     <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&quot;public, max-age=31536000, immutable&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-comment"># å›¾ç‰‡æ–‡ä»¶çš„ä¸“é—¨ location</span><br>   <span class="hljs-section">location</span> ~_<span class="hljs-regexp"> ^/chat_web/._\.(jpg|jpeg|png|gif|ico|svg)$</span> &#123;<br>     <span class="hljs-attribute">alias</span> /www/wwwroot/chat/chat_web/;<br>     <span class="hljs-attribute">expires</span> <span class="hljs-number">3M</span>;<br>     <span class="hljs-attribute">add_header</span> Cache-Control <span class="hljs-string">&quot;public, max-age=7776000&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-comment"># è·¯ç”±ä¸“ç”¨ location</span><br>   <span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /chat_web/ &#123;<br>     <span class="hljs-attribute">alias</span> /www/wwwroot/chat/chat_web/;<br>     <span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>;<br>     <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /chat_web/index.html;<br>   &#125;<br><br> &#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="ğŸ”—-åç«¯æ¥å£æœåŠ¡">ğŸ”— åç«¯æ¥å£æœåŠ¡</h3><p>ç›´æ¥ä½¿ç”¨ proxy_pass ä»£ç†åˆ°æœ¬æœºçš„æŸä¸ªç«¯å£å°±è¡Œäº†ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># chaté¡¹ç›®çš„åç«¯</span><br><span class="hljs-section">location</span><span class="hljs-regexp"> ^~</span> /chat_server/ &#123;<br>  <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:4001/;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="ğŸ”’-SSL-è¯ä¹¦é…ç½®">ğŸ”’ SSL è¯ä¹¦é…ç½®</h3><blockquote><p>SSL è¯ä¹¦è¿˜æ˜¯æŒºè´µçš„ï¼Œå¯ä»¥ä½¿ç”¨ Letâ€™s Encrypt çš„è¯ä¹¦è¯ä¹¦ï¼Œå‚è€ƒé“¾æ¥ï¼š<a href="https://diamondfsd.com/lets-encrytp-hand-https/#google_vignette">https://diamondfsd.com/lets-encrytp-hand-https/#google_vignette</a></p></blockquote><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ 307,å› ä¸º 307 çš„è½¬å‘å¯ä»¥ä¿ç•™æ‰€æœ‰çš„å‚æ•°ï¼Œæ¯”å¦‚ method ä¸º POSTï¼Œ301 ä¼šå˜æˆ GET è¯·æ±‚ï¼Œ307 ä¼šç»§ç»­ä¿æŒ POSTã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs awk">http &#123;<br><br>    ...<br>    ...<br><br>    server &#123;<br>      listen <span class="hljs-number">80</span>;<br>      server_name qunyangbang.cn www.qunyangbang.cn m.qunyangbang.cn;<br>      root <span class="hljs-regexp">/www/</span>wwwroot;<br>      <span class="hljs-comment"># é‡å®šå‘æ‰€æœ‰ HTTP è¯·æ±‚åˆ° HTTPS</span><br>        return <span class="hljs-number">307</span> https:<span class="hljs-regexp">//</span><span class="hljs-variable">$server_name</span><span class="hljs-variable">$request_uri</span>;<br>    &#125;<br><br>    server &#123;<br>        <span class="hljs-comment">#SSL é»˜è®¤è®¿é—®ç«¯å£å·ä¸º 443</span><br>        listen <span class="hljs-number">443</span> ssl;<br>        <span class="hljs-comment">#è¯·å¡«å†™ç»‘å®šè¯ä¹¦çš„åŸŸå,è¿™ä¸ªè¯ä¹¦æ˜¯å•åŸŸåçš„</span><br>        server_name qunyangbang.cn www.qunyangbang.cn;<br>        <span class="hljs-comment">#è¯·å¡«å†™è¯ä¹¦æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„</span><br>        ssl_certificate <span class="hljs-regexp">/www/</span>server<span class="hljs-regexp">/panel/</span>vhost<span class="hljs-regexp">/cert/</span>qunyangbang.cn_bundle.crt;<br>        <span class="hljs-comment">#è¯·å¡«å†™ç§é’¥æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„</span><br>        ssl_certificate_key <span class="hljs-regexp">/www/</span>server<span class="hljs-regexp">/panel/</span>vhost<span class="hljs-regexp">/cert/</span>qunyangbang.cn.key;<br>        ssl_session_timeout <span class="hljs-number">5</span>m;<br>        <span class="hljs-comment">#è¯·æŒ‰ç…§ä»¥ä¸‹åè®®é…ç½®</span><br>        ssl_protocols TLSv1.<span class="hljs-number">2</span> TLSv1.<span class="hljs-number">3</span>;<br>        <span class="hljs-comment">#è¯·æŒ‰ç…§ä»¥ä¸‹å¥—ä»¶é…ç½®ï¼Œé…ç½®åŠ å¯†å¥—ä»¶ï¼Œå†™æ³•éµå¾ª openssl æ ‡å‡†ã€‚</span><br>        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;<br>        ssl_prefer_server_ciphers on;<br>        location / &#123;<br>            return <span class="hljs-number">301</span> https:<span class="hljs-regexp">//</span>www.qunyangbang.cn;<br>            root <span class="hljs-regexp">/www/</span>wwwroot;<br>            index  index.html index.htm;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>nodejs</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>JWTç™»å½•ç³»ç»Ÿ</title>
    <link href="/2024/06/06/JWT%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F/"/>
    <url>/2024/06/06/JWT%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h2 id="ğŸŒ-JWT-ç™»å½•ç³»ç»Ÿ">ğŸŒ JWT ç™»å½•ç³»ç»Ÿ</h2><h3 id="ğŸ“-ç™»å½•è®¤è¯ä¸»è¦ä¸‰ä¸ªæ–¹å¼">ğŸ“ ç™»å½•è®¤è¯ä¸»è¦ä¸‰ä¸ªæ–¹å¼</h3><ol><li>Cookie-Session æ–¹å¼ï¼šç”¨æˆ·å‡­å€Ÿç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼ŒæœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ª session æ¥è®°å½•ç”¨æˆ·çŠ¶æ€ï¼Œå¹¶å­˜åœ¨æ•°æ®åº“ï¼Œç„¶åç”Ÿæˆä¸€ä¸ª session idï¼ŒæœåŠ¡å™¨å°†è¿™ä¸ª session id é€šè¿‡ cookie è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨åç»­è¯·æ±‚éƒ½å¸¦ä¸Š cookieï¼ŒæœåŠ¡ç«¯æå– cookie é‡Œçš„ session idï¼Œæ ¹æ® session id å»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯ã€‚</li><li><a href="https://www.rfcreader.com/#rfc7519">JWT è®¤è¯</a>ï¼šç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡ç«¯ç”Ÿæˆ JWT(Json Web Token)ï¼Œé‡Œé¢åŒ…å«ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¦¥å–„ä¿å­˜ï¼Œæ¯æ¬¡è¯·æ±‚çš„æ—¶å€™å¸¦ä¸Š JWTï¼ŒæœåŠ¡å™¨è¯»å– JWT è¿›è¡Œè§£ç ç›´æ¥è·å–ç”¨æˆ·ä¿¡æ¯ã€‚</li><li><a href="https://www.rfcreader.com/#rfc6749">OAuth è®¤è¯</a>ï¼š ä¸»è¦ç”¨æˆ·ç¬¬ä¸‰æ–¹åº”ç”¨è®¤è¯ï¼Œæ¯”å¦‚ç°åœ¨å„ä¸ªç½‘ç«™éƒ½æä¾›çš„å¾®ä¿¡è¿ç™»ï¼Œå°±æ˜¯å…¸å‹çš„ â€‹â€‹OAuth 2.0 æˆæƒåè®® â€‹â€‹ã€‚</li></ol><h3 id="ä¼˜ç¼ºç‚¹æ¯”è¾ƒ">ä¼˜ç¼ºç‚¹æ¯”è¾ƒ</h3><table><thead><tr><th>é¡¹ç›®</th><th>Cookie-Session</th><th>JWT</th><th>OAuth 2.0</th></tr></thead><tbody><tr><td>ä¸»è¦ç”¨é€”</td><td>è®¤è¯</td><td>è®¤è¯</td><td>ç¬¬ä¸‰æ–¹å¹³å°æˆæƒï¼ˆå¦‚å¾®ä¿¡/Google ç™»å½•ï¼‰</td></tr><tr><td>çŠ¶æ€ç®¡ç† â€‹â€‹</td><td>â€‹â€‹ æœ‰çŠ¶æ€ â€‹â€‹ã€‚æœåŠ¡å™¨ç«¯éœ€è¦å­˜å‚¨ Sessionã€‚</td><td>â€‹â€‹ æ— çŠ¶æ€ â€‹â€‹ã€‚æ‰€æœ‰çŠ¶æ€éƒ½å­˜å‚¨åœ¨ä»¤ç‰Œæœ¬èº«ã€‚</td><td>â€‹â€‹ æ¡†æ¶/åè®® â€‹â€‹ï¼Œå®šä¹‰æˆæƒæµç¨‹ã€‚å…¶é¢å‘çš„ä»¤ç‰Œå¯ä»¥æ˜¯ JWT æ ¼å¼ã€‚ï¼‰</td></tr><tr><td>é€šä¿¡æ–¹å¼</td><td><code>Set-Cookie</code> + <code>Cookie</code></td><td><code>Authorization: Bearer &lt;jwt&gt;</code></td><td><code>Authorization Code</code> / <code>Bearer Token</code></td></tr><tr><td>å­˜å‚¨ä½ç½®</td><td>å®¢æˆ·ç«¯ â€‹â€‹ï¼šCookieã€‚æœåŠ¡ç«¯ â€‹â€‹ï¼šSessionï¼ˆå†…å­˜ã€æ•°æ®åº“ã€Redisï¼‰ã€‚</td><td>â€‹â€‹ å®¢æˆ·ç«¯ â€‹â€‹ã€‚Token é€šå¸¸å­˜å‚¨åœ¨ localStorage æˆ–å†…å­˜ä¸­ã€‚</td><td>å®¢æˆ·ç«¯ â€‹â€‹ã€‚è·å–åˆ°çš„ Access Token ç”±å®¢æˆ·ç«¯å­˜å‚¨ã€‚</td></tr><tr><td>æ‰©å±•æ€§</td><td>è¾ƒå·® â€‹â€‹ã€‚åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹éœ€è¦åš Session å…±äº«/ç²˜æ»ã€‚</td><td>â€‹â€‹ æä½³ â€‹â€‹ã€‚å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼ï¼Œä»»ä½•æœåŠ¡èŠ‚ç‚¹åªéœ€å¯†é’¥å³å¯éªŒè¯ä»¤ç‰Œã€‚</td><td>æä½³ â€‹â€‹ã€‚ä¸ºåˆ†å¸ƒå¼å’Œç¬¬ä¸‰æ–¹åº”ç”¨æˆæƒè®¾è®¡ã€‚</td></tr><tr><td>å®‰å…¨æ€§</td><td>æ˜“å— â€‹â€‹CSRFâ€‹â€‹ æ”»å‡»ï¼Œéœ€é¢å¤–é˜²æŠ¤ã€‚Session ID æ³„éœ²æœ‰é£é™©ã€‚</td><td>Token æ³„éœ²å³æ‹¥æœ‰æƒé™ï¼Œéœ€å¦¥å–„å­˜å‚¨ã€‚æœ‰æ•ˆæœŸç®¡ç†æ˜¯å…³é”®ã€‚</td><td>æµç¨‹å¤æ‚ï¼Œå®ç°ä¸å½“æ˜“å¼•å…¥æ¼æ´ã€‚Refresh Token æœºåˆ¶æå‡äº†å®‰å…¨æ€§</td></tr><tr><td>RFC ä¾æ®</td><td>RFC 6265</td><td>RFC 7519</td><td>RFC 6749 / 6750</td></tr></tbody></table><p>ç°åœ¨ä¼ä¸šä¸€èˆ¬éƒ½ä½¿ç”¨ JWTï¼Œå› ä¸ºå…¼å®¹å¤šç«¯ï¼Œå‡è½»æœåŠ¡å™¨å‹åŠ›ã€‚æ¯”å¦‚æœ€è¿‘å¤§ç«çš„ Open AI çš„ API å°±æ˜¯ä½¿ç”¨ JWTï¼Œä»–çš„ä¼ é€æ–¹å¼æ˜¯<code>Authorization: Bearer &lt;token&gt;</code>ï¼Œå®ƒçš„ token æ˜¯ä»¥ sk-å¼€å¤´çš„ tokenï¼Œæ˜¯ç”± JWT åˆåšäº†ä¸€å±‚å®‰å…¨ç¼–ç ã€‚</p><h3 id="JWT-è¯¦è§£">JWT è¯¦è§£</h3><p>JWT æ˜¯ç”±ä¸‰ä¸ª Base64Url ç¼–ç éƒ¨åˆ†ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œä»¥ç‚¹å·åˆ†éš”ï¼š<br><code>Header.Payload.Signature</code><br>ç¤ºä¾‹ï¼š<br><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IjEzNTgzMTA2NzcxQDE2My5jb20iLCJuYW1lIjp7ImZpcnN0TmFtZSI6IuWImCIsImxhc3ROYW1lIjoi5b-X5rSLIn0sInV1aWQiOiJiMWZlZTI5Ny0yMGEwLTQ4MzEtODhlYy0wY2FkM2M2ODYyN2UiLCJpZCI6IjY1NDBiOGY0ZDQ4OGNmZGQ5NWZhNGJkOSIsImlhdCI6MTcwMDQ1MDM3MywiZXhwIjoxNzAwNDUzOTczfQ.nUwSUzSEFUmaCuc9o2BsGbs6ldgFCplIM8RMUf0u1ys</code>ã€‚</p><p>Header å’Œ Payload éƒ½æ˜¯ base64 åçš„ç»“æœï¼ŒSignature æ˜¯ Header + Payload çš„ç­¾åã€‚ç­¾åçš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ token è¢«ç¯¡æ”¹ï¼Œç­¾åçš„ç®—æ³•æ˜¯ Header é‡Œçš„ alg å­—æ®µæŒ‡å®šçš„ç®—æ³•ï¼Œä¸€èˆ¬æ˜¯ HMAC SHA256 æˆ–è€… RSAï¼Œè¿™é‡Œç”¨çš„æ˜¯ HMAC SHA256ï¼Œç­¾åçš„æ—¶å€™éœ€è¦ä¸€ä¸ªå¯†é’¥ï¼Œè¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡ç«¯çŸ¥é“ã€‚ æœåŠ¡ç«¯æ¥æ”¶çš„ JWTï¼Œç„¶åæ ¹æ®å¯†åŒ™å’Œ Header å’Œ Payload æ•°æ®ç”Ÿæˆç­¾åï¼Œå¦‚æœä¸€è‡´å°±è¯´æ˜æ•°æ®æ²¡æœ‰è¢«ä¿®æ”¹ã€‚</p><p>Header ç¤ºä¾‹ï¼š</p><pre><code class="hljs"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;alg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HS256&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;typ&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JWT&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></code></pre><p>Payload ç¤ºä¾‹ï¼š</p><pre><code class="hljs"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;sub&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1234567890&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;John Doe&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;admin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;iat&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1516239022</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></code></pre><p>Signature ç¤ºä¾‹ï¼š<code>6a5f6ac179d9ba9ccb2f1291f6285bba2913a842b2d212abcc5a8c0bfccb</code>ä»»æ„å­—ç¬¦ä¸²ã€‚</p><p>JWT å­—ç¬¦ä¸²çš„ Header å’Œ Payload éƒ¨åˆ†å°±æ˜¯ç®€å•çš„ base64 ç¼–ç ï¼Œç›´æ¥ base64 è§£ç ï¼Œå°±èƒ½è·å–åŸå§‹ä¿¡æ¯ã€‚æ‰€ä»¥ JWT è¿˜è¦åšä¸€å±‚é˜²æŠ¤æ€§çš„ç¼–ç ï¼Œå¹¶ä¸”ç”Ÿæˆ JWT ä¹‹å‰ Payload éƒ¨åˆ†ä¹Ÿåšä¸€å±‚é˜²æŠ¤æ€§ç¼–ç .</p><h3 id="ç™»å½•è®¾è®¡">ç™»å½•è®¾è®¡</h3><p>ä¸€èˆ¬ä½¿ç”¨åŒä»¤ç‰Œè®¤è¯ï¼Œå› ä¸ºå®‰å…¨æ€§æ¯”è¾ƒé«˜ã€‚ä¸€ä¸ªå«è®¿é—®ä»¤ç‰Œ(Access Token)ï¼Œä¸€ä¸ªå«åˆ·æ–°ä»¤ç‰Œ(Refresh Token)ã€‚Access Token è¿‡æœŸåï¼Œå¯ä½¿ç”¨ Refresh Token é™é»˜è·å–æ–° Tokenï¼Œæ— éœ€é¢‘ç¹ç™»å½•ã€‚</p><p>ä¸»è¦æµç¨‹ï¼šç™»å½• â†’ è·å– Access Token å’Œ Refresh Token â†’ è¯·æ±‚ APIï¼ˆAccess Token è¿‡æœŸ â†’ ç”¨ Refresh Token åˆ·æ–° â†’ è·å–æ–° Access Tokenï¼›å¦‚æœ Refresh Token è¿‡æœŸå°±é‡æ–°ç™»å½•ï¼‰ã€‚ä¸€èˆ¬ Refresh Token æœ‰æ•ˆæœŸæ˜¯ 30 å¤©ï¼Œä¹Ÿå¯ä»¥æ›´ä¹…ï¼Œä½†æ˜¯ä¸å»ºè®®æ°¸ä¹…ï¼ŒAccess Token æœ‰æ•ˆæœŸä¸€èˆ¬å‡ å°æ—¶ï¼Œé«˜å®‰å…¨æ€§è¦æ±‚çš„åº”ç”¨ï¼ˆå¦‚é“¶è¡Œã€æ”¯ä»˜ç³»ç»Ÿï¼‰â€‹ï¼Œä¸€èˆ¬ 5 åˆ†é’Ÿã€‚<br><img src="/img2/jwt_1.png" alt="image"></p><h3 id="JWT-ç ”ç©¶èµ„æ–™">JWT ç ”ç©¶èµ„æ–™</h3><ul><li><a href="https://jwt.io/">jwt åœ¨çº¿ç¼–è§£ç ç½‘ç«™</a></li><li><a href="https://jwt.io/introduction">jwt ä»‹ç»</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>nodejs</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>mongodbåœ¨è…¾è®¯äº‘éƒ¨ç½²å’Œä½¿ç”¨</title>
    <link href="/2024/05/14/mongodb%E9%83%A8%E7%BD%B2/"/>
    <url>/2024/05/14/mongodb%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…">å®‰è£…</h2><ol><li>openCloudOS 9, å®‰è£…æ—¶é€‰æ‹© redHat,é€‰æ‹©åä¼šè‡ªåŠ¨æ˜¾ç¤º<code>redHat/centos x64</code></li><li>è§£å‹åï¼Œbin æ–‡ä»¶å¤¹ä¸‹ä¹‹å‰æœ‰<code>mongo.conf</code>ï¼Œ<code>mongodb 8.09</code>ç‰ˆæœ¬æ²¡æœ‰ï¼Œå¯ä»¥è‡ªå·±åœ¨ bin æ–‡ä»¶å¤¹ä¸‹åˆ›å»º<code>mongo.conf</code>,å¯åŠ¨æ—¶<code>./mongod --config mongodb.conf</code></li><li><code>/www/server/mongodb/bin/mongod: error while loading shared libraries: libcrypto.so.1.1: cannot open shared object file: No such file or directory</code><ol><li>sudo dnf install -y compat-openssl11</li><li>find / -name &quot;libcrypto.so.1.1&quot; 2&gt;/dev/null<ol><li>è‹¥è¾“å‡ºç±»ä¼¼ /usr/lib64/libcrypto.so.1.1ï¼Œåˆ™æˆåŠŸ</li></ol></li></ol></li></ol><h2 id="å¯åŠ¨-mongodb">å¯åŠ¨ mongodb</h2><ol><li><p>å®‰è£…å¥½ mongodb</p></li><li><p>åˆ›å»º db ç›®å½•å’Œ log ç›®å½•ï¼Œlog ç›®å½•é‡Œé¢æœ‰ mongo.logï¼Œæ˜¯ logpath</p></li><li><p>ä½¿ç”¨<code>mongo.conf</code>æ–‡ä»¶è¿›è¡Œé…ç½®å‚æ•°</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-comment"># è®¾ç½®æ•°æ®æ–‡ä»¶çš„å­˜æ”¾ç›®å½•</span><br><span class="hljs-params">storage:</span><br>  <span class="hljs-params">dbPath:</span> <span class="hljs-symbol">../data</span><br><br><span class="hljs-comment"># è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜æ”¾ç›®å½•åŠå…¶æ—¥å¿—æ–‡ä»¶å</span><br><span class="hljs-params">systemLog:</span><br>  <span class="hljs-params">destination:</span> file<br>  <span class="hljs-params">path:</span> <span class="hljs-symbol">../logs/mongodb.log</span><br>  <span class="hljs-params">logRotate:</span> reopen<br>  <span class="hljs-params">logAppend:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-params">verbosity:</span> <span class="hljs-number">0</span><br><br><span class="hljs-comment"># è®¾ç½®ç«¯å£å·ï¼ˆé»˜è®¤çš„ç«¯å£å·æ˜¯ 27017ï¼‰</span><br><span class="hljs-params">net:</span><br>  <span class="hljs-params">port:</span> <span class="hljs-number">27099</span><br>  <span class="hljs-params">bindIp:</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br><br><span class="hljs-comment"># è®¾ç½®ä¸ºä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå³åœ¨åå°è¿è¡Œ</span><br><span class="hljs-comment"># fork: true</span><br><br><span class="hljs-comment"># é˜²æ­¢é€šè¿‡HTTPè¿›è¡Œè®¿é—®ï¼Œ3ç‰ˆæœ¬ä»¥åå°±æ²¡æœ‰è¿™ä¸ªå‚æ•°äº†</span><br><span class="hljs-comment"># nohttpinterface: true</span><br><br><span class="hljs-comment"># å¯ç”¨èº«ä»½éªŒè¯,åœ¨æœªåˆ›å»ºæ ¡éªŒç”¨æˆ·ä¹‹å‰ï¼Œéœ€è¦å…³é—­</span><br><span class="hljs-params">security:</span><br>  <span class="hljs-params">authorization:</span> enabled<br><br><span class="hljs-params">setParameter:</span><br>  <span class="hljs-params">enableLocalhostAuthBypass:</span> <span class="hljs-number">0</span><br><br><span class="hljs-comment">#è®¾ç½®ä¸ºä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œ</span><br><span class="hljs-params">processManagement:</span><br>  <span class="hljs-params">fork:</span> <span class="hljs-literal">true</span><br><br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºèº«ä»½è´¦æˆ·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">use</span>(&#x27;<span class="hljs-title">admin</span>&#x27;);<br><br>db.<span class="hljs-title function_ invoke__">createUser</span>(&#123;<br>  <span class="hljs-attr">user</span>: <span class="hljs-string">&quot;xxx&quot;</span>,<br>  <span class="hljs-attr">pwd</span>: <span class="hljs-string">&quot;xxx&quot;</span>,<br>  <span class="hljs-attr">roles</span>: [<br>    &#123; <span class="hljs-attr">role</span>: <span class="hljs-string">&quot;userAdminAnyDatabase&quot;</span>, <span class="hljs-attr">db</span>: <span class="hljs-string">&quot;admin&quot;</span> &#125;,<br>    &#123; <span class="hljs-attr">role</span>: <span class="hljs-string">&quot;readWriteAnyDatabase&quot;</span>, <span class="hljs-attr">db</span>: <span class="hljs-string">&quot;admin&quot;</span> &#125;<br>  ]<br>&#125;)<br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ mongodb: <code>cd /www/server/mongodb/bin &amp;&amp; ./mongod --config mongodb.conf</code></p></li><li><p>æŸ¥çœ‹åå°è¿›ç¨‹å’Œå…³é—­ï¼š</p><ul><li>ps aux | grep mongod å’Œ kill pid</li><li>sudo systemctl stop mongod(ä½¿ç”¨ systemctlï¼ˆä»…é™äºä½¿ç”¨ systemd çš„ Linux å‘è¡Œç‰ˆ)</li><li>sudo service mongod stop(ä½¿ç”¨ service å‘½ä»¤ï¼ˆä»…é™äºä½¿ç”¨ init çš„ Linux å‘è¡Œç‰ˆ)<br>sudo service /www/server/mongodb/bin/mongod stop</li></ul></li></ol><h2 id="mongoDB-å®‰å…¨">mongoDB å®‰å…¨</h2><p>MongoDB åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Šå¯èƒ½å­˜åœ¨å®‰å…¨é£é™©çš„åŸå› å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><p>é»˜è®¤é…ç½®ï¼šMongoDB åœ¨é»˜è®¤æƒ…å†µä¸‹å¯èƒ½ä»¥ä¸å®‰å…¨çš„æ–¹å¼è¿›è¡Œé…ç½®ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒMongoDB å…è®¸åŒ¿åè®¿é—®æ•°æ®åº“ï¼Œæ²¡æœ‰å¯ç”¨èº«ä»½éªŒè¯ï¼Œæˆ–è€…ä½¿ç”¨å¼±å¯†ç è¿›è¡Œè®¿é—®ã€‚è¿™å¯èƒ½ä½¿å¾—æ”»å‡»è€…å¯ä»¥è½»æ˜“åœ°è®¿é—®å’Œç¯¡æ”¹æ‚¨çš„æ•°æ®åº“ã€‚</p><p>ä¸å®‰å…¨çš„ç½‘ç»œè¿æ¥ï¼šå¦‚æœæ‚¨çš„ MongoDB å®ä¾‹é€šè¿‡ä¸å®‰å…¨çš„ç½‘ç»œè¿æ¥ï¼ˆå¦‚æœªåŠ å¯†çš„ç½‘ç»œä¼ è¾“ï¼‰è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®å¯èƒ½ä¼šè¢«çªƒå¬æˆ–ç¯¡æ”¹ã€‚å»ºè®®ä½¿ç”¨ TLS/SSL ç­‰å®‰å…¨åè®®å¯¹ MongoDB çš„ç½‘ç»œè¿æ¥è¿›è¡ŒåŠ å¯†ï¼Œä»¥ä¿æŠ¤æ•°æ®çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚</p><p>ç¼ºä¹è®¿é—®æ§åˆ¶ï¼šMongoDB ä¸­çš„è®¿é—®æ§åˆ¶æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå¯ä»¥é™åˆ¶å“ªäº›ç”¨æˆ·æˆ– IP åœ°å€å¯ä»¥è®¿é—®æ•°æ®åº“ï¼Œå¹¶å®šä¹‰ä¸åŒç”¨æˆ·çš„æƒé™çº§åˆ«ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®é…ç½®è®¿é—®æ§åˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœªç»æˆæƒçš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®å’Œä¿®æ”¹æ•°æ®åº“ã€‚</p><p>æ›´æ–°å’Œè¡¥ä¸ç®¡ç†ï¼šæœªåŠæ—¶å®‰è£… MongoDB çš„æ›´æ–°å’Œè¡¥ä¸å¯èƒ½å¯¼è‡´å·²çŸ¥çš„å®‰å…¨æ¼æ´å­˜åœ¨äºç³»ç»Ÿä¸­ï¼Œä½¿å¾—æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ¼æ´è¿›è¡Œå…¥ä¾µã€‚</p><p>å¼±å¯†ç ï¼šä½¿ç”¨å¼±å¯†ç æ˜¯ä¸€ç§å¸¸è§çš„å®‰å…¨é£é™©ã€‚å¦‚æœæ‚¨çš„ MongoDB å®ä¾‹ä½¿ç”¨å¼±å¯†ç ï¼ˆå¦‚çŸ­å¯†ç ã€å¸¸è§å¯†ç æˆ–å®¹æ˜“çŒœæµ‹çš„å¯†ç ï¼‰ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥é€šè¿‡å¯†ç çŒœæµ‹æˆ–æš´åŠ›ç ´è§£çš„æ–¹å¼å…¥ä¾µæ•°æ®åº“ã€‚</p><p>ä¸ºäº†æé«˜ MongoDB çš„å®‰å…¨æ€§ï¼Œå»ºè®®é‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><p>ä½¿ç”¨å¼ºå¯†ç ï¼šç¡®ä¿ä¸º MongoDB è®¾ç½®å¼ºå¯†ç ï¼ŒåŒ…æ‹¬è¶³å¤Ÿçš„é•¿åº¦ã€å¤æ‚æ€§å’Œéšæœºæ€§ï¼Œä»¥æŠµå¾¡å¯†ç çŒœæµ‹å’Œæš´åŠ›ç ´è§£æ”»å‡»ã€‚<br>å¯ç”¨èº«ä»½éªŒè¯ï¼šåœ¨ MongoDB ä¸­å¯ç”¨èº«ä»½éªŒè¯ï¼Œè¦æ±‚ç”¨æˆ·æä¾›æœ‰æ•ˆçš„å‡­æ®æ‰èƒ½è®¿é—®æ•°æ®åº“ã€‚<br>é…ç½®è®¿é—®æ§åˆ¶ï¼šé™åˆ¶æ•°æ®åº“çš„è®¿é—®æƒé™ï¼Œåªå…è®¸æˆæƒçš„ç”¨æˆ·å’Œ IP åœ°å€è®¿é—®ï¼Œå¹¶æ ¹æ®éœ€è¦å®šä¹‰é€‚å½“çš„æƒé™çº§åˆ«ã€‚<br>åŠ å¯†ç½‘ç»œè¿æ¥ï¼šä½¿ç”¨ TLS/SSL ç­‰å®‰å…¨åè®®å¯¹ MongoDB çš„ç½‘ç»œè¿æ¥è¿›è¡ŒåŠ å¯†ï¼Œä»¥é˜²æ­¢æ•°æ®è¢«çªƒå¬æˆ–ç¯¡æ”¹ã€‚<br>åŠæ—¶æ›´æ–°å’Œè¡¥ä¸ï¼šå®šæœŸæ£€æŸ¥ MongoDB çš„æ›´æ–°å’Œè¡¥ä¸ï¼Œå¹¶åŠæ—¶å®‰è£…ä»¥ä¿®å¤å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚<br>ç›‘æ§å’Œæ—¥å¿—è®°å½•ï¼šè®¾ç½®é€‚å½“çš„ç›‘æ§å’Œæ—¥å¿—è®°å½•æœºåˆ¶ï¼ŒåŠæ—¶æ£€æµ‹æ½œåœ¨çš„å®‰å…¨äº‹ä»¶æˆ–å¼‚å¸¸æ´»åŠ¨ã€‚<br>é€šè¿‡é‡‡å–è¿™äº›å®‰å…¨æªæ–½ï¼Œæ‚¨å¯ä»¥å¢å¼º MongoDB åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Šçš„å®‰å…¨æ€§ï¼Œå¹¶é™ä½æ½œåœ¨çš„å®‰å…¨é£é™©ã€‚åŒæ—¶ï¼Œå®šæœŸå®¡æŸ¥å’Œè¯„ä¼°å®‰å…¨æ€§ï¼Œå¹¶éµå¾ªæœ€ä½³å®è·µï¼Œæ˜¯ä¿æŒ MongoDB ç¯å¢ƒå®‰å…¨çš„é‡è¦ä¸€ç¯ã€‚</p><h2 id="å‚è€ƒ">å‚è€ƒ</h2><blockquote><p>mac: <a href="https://juejin.cn/post/7052585815037673479">https://juejin.cn/post/7052585815037673479</a></p></blockquote><blockquote><p>centos: <a href="https://juejin.cn/post/7163071747414032391">https://juejin.cn/post/7163071747414032391</a></p></blockquote><blockquote><p>è¿œç¨‹è¿æ¥+èº«ä»½è®¤è¯ï¼š<a href="https://blog.csdn.net/jianleking/article/details/79715097">https://blog.csdn.net/jianleking/article/details/79715097</a></p></blockquote><blockquote><p>å†…ç½®è§’è‰²ï¼š<a href="https://www.mongodb.com/docs/manual/reference/built-in-roles/">https://www.mongodb.com/docs/manual/reference/built-in-roles/</a></p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>other</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>React renderé˜¶æ®µ</title>
    <link href="/2024/02/27/React%20render%E9%98%B6%E6%AE%B5/"/>
    <url>/2024/02/27/React%20render%E9%98%B6%E6%AE%B5/</url>
    
    <content type="html"><![CDATA[<h3 id="å›é¡¾">å›é¡¾</h3><p>å‰é¢ç»è¿‡ä¸€ä¸ªå¾®ä»»åŠ¡ä¹‹åï¼Œè¿›è¡Œæ‰¹é‡æ›´æ–°æ”¶é›†ï¼Œç„¶åå†ç»è¿‡ä¸€ä¸ªå®ä»»åŠ¡è°ƒåº¦å™¨è¿›è¡Œè°ƒåº¦ã€‚å†å¾€ä¸‹å°±æ˜¯ render é˜¶æ®µï¼Œç”Ÿæˆæ–°çš„ Fiber æ ‘ã€‚ scheduler è°ƒåº¦çš„å‡½æ•°æ˜¯ Task.callback ä¹Ÿå°±æ˜¯ performWorkOnRootViaSchedulerTask å‡½æ•°ï¼Œåœ¨ Root ä¸Šæ‰§è¡Œä»»åŠ¡ã€‚ç„¶åå°±ä¼šèµ°åˆ° performWorkOnRoot æ‰§è¡Œ render é˜¶æ®µï¼Œç„¶åå†æ¬¡è°ƒç”¨ scheduleTaskForRootDuringMicrotask æ‰§è¡Œè°ƒåº¦ã€‚</p><h3 id="æ¸²æŸ“é˜¶æ®µ">æ¸²æŸ“é˜¶æ®µ</h3><p>æ¸²æŸ“é˜¶æ®µå°±æ˜¯åˆ›å»ºæ–°çš„ Fiber æ ‘ï¼Œdiff å°±æ˜¯æ¯”è¾ƒæ–°æ—§ä¸¤ä¸ª Fiber èŠ‚ç‚¹ï¼Œæ¥åˆ›æ–°æ–°çš„ Fiber æ ‘çš„ã€‚å½“å‰é¡µé¢çš„æ˜¯ current æ ‘ï¼Œæ­£åœ¨æ›´æ–°çš„æ˜¯ workInProcess æ ‘ï¼Œä¸¤è€…é€šè¿‡ alternate æ¥æŒ‡å‘å¯¹æ–¹ã€‚å¦‚æœé‡åˆ°æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œè¿›è¡Œä¸­æ–­çš„è¯ï¼Œå°±ä¼šæ¸…é™¤ workInProcess,ç„¶åå»æ„å»ºé«˜ä¼˜å…ˆçº§ä»»åŠ¡çš„ Fiber æ ‘ï¼›å¦‚æœåªæ˜¯å¸¸è§„ 5ms æ£€æŸ¥ï¼Œä½†æ˜¯æ²¡æœ‰è¢«é«˜ä¼˜å…ˆçº§ä»»åŠ¡æ‰“æ–­ï¼Œå¹¶ä¸ä¼šæ¸…é™¤ workInProcess æ ‘ï¼Œè€Œæ˜¯ä¿ç•™å½“å‰è¦æ‰§è¡Œçš„ Fiberã€‚</p><h3 id="å®é™…åœºæ™¯">å®é™…åœºæ™¯</h3><ol><li>å¤šæ¬¡è¾“å…¥ï¼Œæ¯æ¬¡ä¸­æ–­ startTransitionï¼Œä¸­æ–­åˆ—è¡¨æ›´æ–°</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useState, useTransition &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> bigList = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(&#123; <span class="hljs-attr">length</span>: <span class="hljs-number">50000</span> &#125;, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> <span class="hljs-string">`Item <span class="hljs-subst">$&#123;i&#125;</span><span class="hljs-subst">$&#123;i % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">&#x27;e&#x27;</span> : <span class="hljs-string">&#x27;o&#x27;</span>&#125;</span>`</span>);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App1</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [filtered, setFiltered] = <span class="hljs-title function_">useState</span>(bigList);<br>  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-keyword">const</span> value = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>    <span class="hljs-title function_">setQuery</span>(value);<br><br>    <span class="hljs-comment">// è¿™æ˜¯ä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œä¼šè¢«ä¸­æ–­</span><br>    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> result = bigList.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-title function_">includes</span>(value));<br>      <span class="hljs-title function_">setFiltered</span>(result);<br>      <span class="hljs-comment">// setQuery(1); // è¿™é‡Œæ˜¯åæ‰§è¡Œï¼Œè¾“å…¥æ¡†å°±ä¼šå˜æˆ1</span><br>      <span class="hljs-comment">// setQuery((prev) =&gt; prev + 1); // è¿™é‡Œæ˜¯åæ‰§è¡Œï¼Œè¾“å…¥æ¡†å°±ä¼šå˜æˆquery + 1</span><br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;query&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span> /&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">      &#123;isPending &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è®¡ç®—ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>&#125;</span><br><span class="language-xml"></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;filtered.map((item) =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item&#125;</span>&gt;</span>&#123;item&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>React</category>
      
    </categories>
    
    
    <tags>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>React Scheduler</title>
    <link href="/2024/01/10/React%20Scheduler/"/>
    <url>/2024/01/10/React%20Scheduler/</url>
    
    <content type="html"><![CDATA[<h3 id="useState-åçš„é“¾è·¯">useState åçš„é“¾è·¯</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">dispatchSetState</span><br><span class="hljs-keyword"></span><br><span class="hljs-keyword">dispatchSetStateInternal </span>åˆ›å»ºæ›´æ–°å¯¹è±¡ Update ,è¿˜ä¼šåˆ¤æ–­æœ€åä¸€æ¬¡å€¼å’Œå½“å‰å€¼æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œè·³è¿‡æ¸²æŸ“ï¼Œä¸ä¸€è‡´çš„è¯<br><br>enqueueConcurrentHookUpdate å¢åŠ åˆ°ä¸´æ—¶é˜Ÿåˆ—ï¼Œåç»­ä¼šå¢åŠ åˆ° Fiber.queue.pending ä¸Šï¼Œ<br><br><span class="hljs-keyword">scheduleUpdateOnFiber</span><br><span class="hljs-keyword"></span>  æ ‡è®° Root æœ‰æ›´æ–°<br>  å¤„ç† Suspenseï¼šå¦‚æœæ­£åœ¨ç­‰å¾…æ•°æ®ï¼Œä¸­æ–­å½“å‰æ¸²æŸ“<br>  å¤„ç†æ¸²æŸ“é˜¶æ®µæ›´æ–°ï¼šå¦‚æœåœ¨ render ä¸­è§¦å‘æ›´æ–°ï¼ˆä¸æ¨èï¼‰ï¼Œç‰¹æ®Šå¤„ç†<br>  <span class="hljs-keyword">scheduleImmediateRootScheduleTask </span>å¾®ä»»åŠ¡å›è°ƒï¼Œå»æ‰§è¡ŒprocessRootScheduleInMicrotask<br><br>  processRootScheduleInMicrotask(ä¸€æ¬¡clickäº‹ä»¶ä¸­å¯èƒ½è°ƒç”¨å¤šæ¬¡setStateï¼Œä½†æ˜¯åªä¼šæ‰§è¡Œä¸€æ¬¡å¾®ä»»åŠ¡å›è°ƒï¼Œä¹Ÿå°±æ˜¯processRootScheduleInMicrotaskï¼Œä»è€Œå®ç°äº†æ‰¹å¤„ç†)<br>      ä¸ºæ¯ä¸ªRootæ‰§è¡Œ<span class="hljs-keyword">schedulerè°ƒåº¦(scheduleTaskForRootDuringMicrotask),ä¹Ÿå°±æ˜¯åˆ›å»ºScheduler </span>Taskå¯¹è±¡æ”¾è¿›timerQueueæˆ–è€…taskQueueå»æ‰§è¡Œã€‚<br><br><br>      è®¾ç½®å®Œè°ƒåº¦åï¼Œæ‰§è¡ŒåŒæ­¥æ›´æ–°(flushSyncWorkAcrossRoots_impl),æ­¤æ—¶<span class="hljs-keyword">schedulerå¹¶æ²¡æœ‰è°ƒåº¦å®Œæˆï¼Œåªæ˜¯è®¾ç½®è°ƒåº¦ã€‚è¦ç­‰ä¸€ä¸ªå®ä»»åŠ¡å›è°ƒæ‰§è¡Œã€‚</span><br><span class="hljs-keyword"></span><br>entangleTransitionUpdate(root, queue, lane);<br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs markdown">processRootScheduleInMicrotask<br><br>  å¤„ç†é¥¥é¥¿çš„ä»»åŠ¡ï¼Œç­‰å¤ªä¹…çš„ä»»åŠ¡ï¼Œè¶…æ—¶äº†ï¼Œå°±æ ‡è®°ä¸ºé¥¥é¥¿ä»»åŠ¡ï¼Œä»è€Œåœ¨ä¸‹ä¸€æ¬¡è°ƒåº¦ä¸­æå‡ä¼˜å…ˆçº§ markStarvedLanesAsExpired(root, currentTime);<br><br>  è®¡ç®—è¿™ä¸€æ‰¹è¦å¤„ç†çš„lanes getNextLanes<br><br><span class="hljs-code">      åŒæ­¥ä»»åŠ¡ï¼Œä¸æ–°å¢schedulerä»»åŠ¡ï¼Œç”±å¾®ä»»åŠ¡æœ€åçš„flushSyncWorkAcrossRoots_implå‡½æ•°æ‰§è¡Œã€‚</span><br><span class="hljs-code"></span><br><span class="hljs-code">      éåŒæ­¥ä»»åŠ¡ï¼š</span><br><span class="hljs-code">          å–æœ€é«˜ä¼˜å…ˆçº§çš„laneä½œä¸ºcallbackçš„ä¼˜å…ˆçº§ï¼Œ</span><br><span class="hljs-code">          å–æ¶ˆæ—§ callbackï¼Œ</span><br><span class="hljs-code">          å°†lane ä¼˜å…ˆçº§æ˜ å°„æˆ scheduler ä¼˜å…ˆçº§(userBlocking/normal/idle),</span><br><span class="hljs-code">          é€šè¿‡scheduleCallbackæ³¨å†Œscheduler taskï¼Œ</span><br><span class="hljs-code">          callbackä¸ºperformWorkOnRootViaSchedulerTask</span><br><span class="hljs-code"></span><br><span class="hljs-code">      è¿”å›æœ¬æ¬¡ä»»åŠ¡çš„æœ€é«˜ä¼˜å…ˆçº§çš„laneã€‚</span><br><span class="hljs-code"></span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢å¼‚æ­¥ä»»åŠ¡(éåŒæ­¥ä»»åŠ¡)è°ƒç”¨</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">const newCallbackNode = <span class="hljs-keyword">scheduleCallback(</span><br><span class="hljs-keyword"></span>  <span class="hljs-keyword">schedulerPriorityLevel,</span><br><span class="hljs-keyword"></span>  performWorkOnRootViaSchedulerTask.<span class="hljs-keyword">bind(null, </span>root),<br>);<br></code></pre></td></tr></table></figure><p>scheduleCallback å°±æ˜¯ unstable_scheduleCallback å‡½æ•°</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">æŒ‡å®šè¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡æ‰§è¡Œ <span class="hljs-built_in">requestHostTimeout</span>(handleTimeout, startTime - currentTime); ä¸€å®šæ—¶é—´è¿‡å»åï¼Œè¿˜æ˜¯è°ƒç”¨<span class="hljs-built_in">requestHostCallback</span>();<br><br>å¦åˆ™æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡å›è°ƒ <span class="hljs-built_in">requestHostCallback</span>();<br></code></pre></td></tr></table></figure><h3 id="Scheduler-è°ƒåº¦å™¨">Scheduler è°ƒåº¦å™¨</h3><blockquote><p>React Fiber å°†ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡ï¼ŒScheduler å°±æ˜¯è°ƒåº¦è¿™äº›å•å…ƒä»»åŠ¡çš„è°ƒåº¦å™¨ã€‚</p></blockquote><h3 id="æ ¸å¿ƒèŒè´£">æ ¸å¿ƒèŒè´£</h3><ol><li>ğŸ¯ ä»»åŠ¡è°ƒåº¦ï¼šç®¡ç†è‹¥å¹²ä¸ªä¸åŒä¼˜å…ˆçº§çš„ä»»åŠ¡</li><li>â±ï¸ æ—¶é—´åˆ‡ç‰‡ï¼šæ‰§è¡Œ 5ms æ—¶é—´çš„è‹¥å¹²ä¸ªå•å…ƒä»»åŠ¡ï¼Œè¶…è¿‡æ—¶é—´ï¼Œå°±äº¤ç»™ commit é˜¶æ®µï¼Œä»¥åŠæµè§ˆå™¨äº‹ä»¶ã€‚</li><li>ğŸ“Š ä¼˜å…ˆçº§ç®¡ç†ï¼šé«˜ä¼˜å…ˆçº§çš„å…ˆæ‰§è¡Œï¼Œæ¯ä¸ªå•å…ƒä»»åŠ¡éƒ½æœ‰ä¼˜å…ˆçº§ï¼Œé€šå¸¸å¯¹åº”ç€ä¸åŒçš„è¶…æ—¶æ—¶é—´ï¼Œä¼˜å…ˆæ—¶é—´ç´§æ€¥çš„ä»»åŠ¡ï¼Œå³ä½¿ä¸€å¼€å§‹æ—¶é—´ä¸ç´§æ€¥çš„ä»»åŠ¡ï¼Œä½†æ˜¯è¢«å¤šä¸ªæ—¶é—´ç´§æ€¥è€½è¯¯äº†ä¹‹åï¼Œè‡ªèº«çš„è¶…çº§æ—¶é—´ä¹Ÿåœ¨å‡å°‘ï¼Œè€Œå˜å¾—ç´§æ€¥ï¼Œå‡å°‘çš„å°±æ˜¯ç­‰å¾…çš„æ—¶é—´ã€‚</li><li>ğŸ”„ å¯ä¸­æ–­æ¢å¤ï¼šæ‰§è¡Œ 5ms åäº¤ç»™ç»™æµè§ˆå™¨ï¼Œç­‰å¾…ä¸‹ä¸€å¸§ï¼Œç»§ç»­æ‰§è¡Œè‹¥å¹²ä¸ªä»»åŠ¡ã€‚</li></ol><h3 id="ä¼˜å…ˆçº§">ä¼˜å…ˆçº§</h3><table><thead><tr><th>scheduler ä¼˜å…ˆçº§åç§°</th><th>scheduler ä¼˜å…ˆçº§æ•°å­—</th><th>è¶…æ—¶æ—¶é—´</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>immediatePriority</td><td>1</td><td>-1</td><td>ImmediatePriority åŸºæœ¬åªç”¨äºå†…éƒ¨å…¼å®¹æ—§ç¯å¢ƒï¼ˆsetImmediateã€MessageChannel ç¼ºå¤±æ—¶ï¼‰ã€‚ä¾‹å¦‚ flushSyncã€useSyncExternalStoreã€å†…éƒ¨äº‹ä»¶(é”™è¯¯è¾¹ç•Œæ•è·/å¸è½½ç»„ä»¶)å¹¶æ²¡æœ‰èµ° scheduler è€Œæ˜¯åœ¨ å¾®ä»»åŠ¡é˜¶æ®µå°±ç«‹å³æ‰§è¡Œäº†</td></tr><tr><td>userBlockingPriority</td><td>2</td><td>250ms</td><td>ç”¨æˆ·äº¤äº’(ç‚¹å‡»ã€è¾“å…¥ã€æ»šåŠ¨)</td></tr><tr><td>normalPriority</td><td>3</td><td>5s</td><td>ä¸€èˆ¬æ›´æ–°(ç½‘ç»œè¯·æ±‚åçŠ¶æ€æ›´æ–°)</td></tr><tr><td>lowPriority</td><td>4</td><td>10s</td><td>startTransitionã€Suspenseã€(useDeferredValue ä¸æ˜¯ Scheduler è°ƒåº¦çš„ä»»åŠ¡ï¼Œæ‰€ä»¥ä¸åœ¨è¿™é‡Œ)</td></tr><tr><td>IdlePriority</td><td>5</td><td>æ°¸ä¸</td><td>å†…éƒ¨ä½¿ç”¨(æ¯”å¦‚ React DevToolã€Profilerã€é¢„åŠ è½½ä¸‹ä¸€å±æ•°æ®ã€Fiber GC)</td></tr></tbody></table><h3 id="æ ¸å¿ƒå‡½æ•°">æ ¸å¿ƒå‡½æ•°</h3><p><code>workLoop</code>:å¾ªç¯æ‰§è¡Œä»»åŠ¡<br><code>flushWork</code>:<br><code>performWorkUntilDeadline</code><br><code>schedulePerformWorkUntilDeadline</code></p><h3 id="è°ƒåº¦è¿‡ç¨‹">è°ƒåº¦è¿‡ç¨‹</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs 1c">            ä»å»¶è¿Ÿä»»åŠ¡é˜Ÿåˆ—<span class="hljs-punctuation">(</span>timerQueue<span class="hljs-punctuation">)</span>ä¸­æå–è¿‡æœŸä»»åŠ¡æ”¾è¿›taskQueue<br><br>                      <span class="hljs-string">|</span><br>                      <span class="hljs-string">|</span><br>            ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­<span class="hljs-punctuation">(</span>taskQueueä¸­<span class="hljs-punctuation">)</span>ä¸­è·å–ç¬¬ä¸€ä¸ªä»»åŠ¡<span class="hljs-punctuation">(</span>Taskå¯¹è±¡<span class="hljs-punctuation">)</span><br><br>                      <span class="hljs-string">|</span><br>                      <span class="hljs-string">|</span><br>            åˆ¤æ–­æ˜¯å¦ç»§ç»­æ‰§è¡Œä»»åŠ¡<span class="hljs-punctuation">(</span>æ˜¯å¦ç»ˆç«¯<span class="hljs-punctuation">)</span><br><br>                      <span class="hljs-string">|       (1.å½“å‰ä»»åŠ¡æ²¡è¿‡æœŸï¼Œè¿‡æœŸçš„è¯ï¼Œç»§ç»­æ‰§è¡Œ)</span><br>                      <span class="hljs-string">|       (2. è¶…è¿‡æ—¶é—´åˆ‡ç‰‡(5ms)`shouldYieldToHost()`)</span><br>                      <span class="hljs-string">|       (ä¹Ÿå°±æ˜¯è¯´å½“ç„¶ä»»åŠ¡è¿‡æœŸæˆ–è€…æ²¡è¶…è¿‡5ms,éƒ½ä¼šç»§ç»­æ‰§è¡Œ)</span><br>            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>            â”‚                          â”‚<br>            â”‚                          â”‚<br>            ä¸­æ–­                      ç»§ç»­æ‰§è¡Œ<br>            â”‚                          â”‚<br>            â”‚                          â”‚<br>äº¤ç»™æµè§ˆå™¨å»å“åº”æ—¶é—´æˆ–è€…ç»˜åˆ¶é¡µé¢       ä»»åŠ¡.callbackä¸º<span class="hljs-literal">null</span>æ˜¯è¢«å–æ¶ˆäº†ï¼Œç›´æ¥ä»æœ€å°å †é¡¶æ¨å‡º<br>                                  ä¸ä¸º<span class="hljs-literal">null</span>ï¼Œå°±æ‰§è¡Œcallbackï¼Œå¹¶ä¸”ä¼ å…¥æ˜¯å¦è¿‡æœŸçš„æ ‡è¯†<br><br></code></pre></td></tr></table></figure><h3 id="callback-ä¸º-performWorkOnRootViaSchedulerTask">callback ä¸º performWorkOnRootViaSchedulerTask</h3><p>æ­¤æ—¶è¿›æ¥çš„ä»»åŠ¡éƒ½æ˜¯è¦ç«‹å³æ¸²æŸ“çš„ï¼Œè¿›è¡Œ Fiber æ¸²æŸ“(performWorkOnRoot),ç”šè‡³ commit.<br>æ¸²æŸ“å®Œä¹‹åï¼Œå†æ¬¡æ‰§è¡Œå½“å‰ Root çš„è°ƒåº¦(scheduleTaskForRootDuringMicrotask)</p><h3 id="æ¸²æŸ“é˜¶æ®µ">æ¸²æŸ“é˜¶æ®µ</h3><p>ä» performWorkOnRoot(root, lanes, forceSync);è¿™é‡Œå¼€å§‹</p>]]></content>
    
    
    <categories>
      
      <category>React</category>
      
    </categories>
    
    
    <tags>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶</title>
    <link href="/2023/12/26/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6/"/>
    <url>/2023/12/26/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h3 id="æœºåˆ¶">æœºåˆ¶</h3><p>æµè§ˆå™¨æŒ‰å¸§(Frame)é©±åŠ¨çš„æ¸²æŸ“æœºåˆ¶ï¼Œä¸€å¸§æ—¶é—´å¤§æ¦‚ 16.6msï¼Œæ¯éš” 16.6ms å±å¹•åˆ·æ–°ä¸€æ¬¡ï¼Œå¦‚æœæœ‰å¤§é‡è®¡ç®—æˆ–è€…å¤§é‡èŠ‚ç‚¹ç»˜åˆ¶ï¼Œè¶…è¿‡ 16.6ms æ—¶é—´ï¼Œå°±ä¼šäº§ç”Ÿæ‰å¸§æƒ…å†µã€‚å¦‚æœåªæ’å…¥ä¸€ä¸ªç®€å•çš„ spanï¼Œè‚¯å®šä¸éœ€è¦ 16.6ms å°±æ‰§è¡Œèƒ½æ‰§è¡Œå®Œï¼Œä½†æ˜¯ä¹Ÿè¦ç­‰åˆ°ä¸‹ä¸€å¸§æ¸²æŸ“ï¼Œæ­¤æ—¶ä¹Ÿæ²¡æœ‰è®¡ç®—å¸ƒå±€(Layout é˜¶æ®µ )ï¼Œä¹Ÿæ²¡æœ‰ç»˜åˆ¶(Paint é˜¶æ®µ)ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„å¸§ï¼ˆFrameï¼‰å¤§è‡´åŒ…æ‹¬ä»¥ä¸‹é˜¶æ®µï¼š</p><table><thead><tr><th>é˜¶æ®µ</th><th>åç§°</th><th>æ˜¯å¦å ç”¨ä¸»çº¿ç¨‹</th></tr></thead><tbody><tr><td>1ï¸âƒ£ JS æ‰§è¡Œé˜¶æ®µ</td><td>è¿è¡Œè„šæœ¬ï¼Œæ“ä½œ DOMã€ä¿®æ”¹æ ·å¼</td><td>âœ… å ç”¨</td></tr><tr><td>2ï¸âƒ£ Style é˜¶æ®µ</td><td>é‡æ–°è®¡ç®— CSS æ ·å¼ï¼ˆRecalculate Styleï¼‰</td><td>âœ… å ç”¨</td></tr><tr><td>3ï¸âƒ£ Layout é˜¶æ®µ</td><td>é‡æ–°è®¡ç®—å…ƒç´ å‡ ä½•ä½ç½®ï¼ˆReflow / Layoutï¼‰</td><td>âœ… å ç”¨</td></tr><tr><td>4ï¸âƒ£ Paint é˜¶æ®µ</td><td>ç»˜åˆ¶åƒç´ ä¿¡æ¯åˆ°å›¾å±‚</td><td>âœ… å ç”¨</td></tr><tr><td>5ï¸âƒ£ Composite é˜¶æ®µ</td><td>GPU åˆæˆå„å›¾å±‚æ˜¾ç¤º</td><td>âœ… éƒ¨åˆ†å¹¶è¡Œï¼Œå¯å¼‚æ­¥</td></tr></tbody></table><p>å½“è®¾ç½® DOM å±æ€§æ—¶ï¼Œæµè§ˆå™¨å¹¶ä¸ä¼šç«‹å³å»åˆ·æ–°åˆ°å±å¹•ä¸Šï¼Œè€Œæ˜¯æ”¾åœ¨æ¸²æŸ“é˜Ÿåˆ—ã€‚ç­‰å¾…å¾®ä»»åŠ¡éƒ½ç»“æŸäº†ï¼Œç„¶åè°ƒç”¨ requestAnimationFrame çš„å›è°ƒï¼Œå†å»æ¸²æŸ“ã€‚æ‰€ä»¥ JS çš„åŒæ­¥æ‰§è¡Œæ—¶é—´ä¸èƒ½å¤ªé•¿ï¼Œå¦åˆ™ä¼šæ‰å¸§ã€‚è¿™ä¹Ÿæ˜¯ React å‘ Fiber æ¶æ„æ¼”è¿›çš„ä¸»è¦åŸå› ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­çš„æ‰“å°é¡ºåºå¯ä»¥éªŒè¯è¿™ä¸€ç‚¹ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 100px; height: 100px; background: lightcoral&quot;</span>&gt;</span>box<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;btn&quot;</span>&gt;</span>Click<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> box = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;box&quot;</span>);</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;btn&quot;</span>);</span><br><span class="language-javascript">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">msg</span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;performance.now().toFixed(<span class="hljs-number">1</span>)&#125;</span>ms: <span class="hljs-subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript">  btn.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">    <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;1. click handler start&quot;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// åŒæ­¥ DOM ä¿®æ”¹ï¼ˆä¸ä¼šç«‹å³ paintï¼ŒçœŸæ­£ç»˜åˆ¶æ˜¯åœ¨ç¬¬ 5 æ­¥ requestAnimationFrame å›è°ƒä¹‹åï¼‰</span></span><br><span class="language-javascript">    box.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&quot;300px&quot;</span>;</span><br><span class="language-javascript">    <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;2. DOM modifiedï¼Œbut not paint&quot;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// ä¸€ä¸ªå¾®ä»»åŠ¡</span></span><br><span class="language-javascript">    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;4. microtask (Promise.then)&quot;</span>);</span><br><span class="language-javascript">    &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// requestAnimationFrame å›è°ƒ</span></span><br><span class="language-javascript">    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;5. rAF callback (before paint)&quot;</span>);</span><br><span class="language-javascript">    &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆsetTimeoutï¼‰å°†æ’åˆ°ä¸‹ä¸€è½®ï¼Œä¼šåœ¨æµè§ˆå™¨å¯èƒ½å·²æ¸²æŸ“åæ‰§è¡Œ</span></span><br><span class="language-javascript">    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;6. setTimeout callback (next macrotask)&quot;</span>);</span><br><span class="language-javascript">    &#125;, <span class="hljs-number">0</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;3. click handler end&quot;</span>);</span><br><span class="language-javascript">  &#125;;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœæ˜¯ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">808</span>.<span class="hljs-number">2</span>ms: <span class="hljs-number">1</span>. click handler start<br><span class="hljs-attribute">808</span>.<span class="hljs-number">3</span>ms: <span class="hljs-number">2</span>. DOM modifiedï¼Œbut not paint<br><span class="hljs-attribute">808</span>.<span class="hljs-number">5</span>ms: <span class="hljs-number">3</span>. click handler end<br><span class="hljs-attribute">808</span>.<span class="hljs-number">5</span>ms: <span class="hljs-number">4</span>. microtask (Promise.then)<br><span class="hljs-attribute">809</span>.<span class="hljs-number">0</span>ms: <span class="hljs-number">5</span>. rAF callback (before paint)<br><span class="hljs-attribute">809</span>.<span class="hljs-number">3</span>ms: <span class="hljs-number">6</span>. setTimeout callback (next macrotask)<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è®¿é—® DOM çš„å¸ƒå±€å±æ€§ä¼šå¼ºåˆ¶æµè§ˆå™¨å›æµï¼ˆé‡æ’ï¼‰ï¼ŒåŒæ­¥è®¡ç®—æ•°å€¼è¿”å›ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šè§¦å‘é‡ç»˜ï¼Œä¹Ÿå°±æ˜¯åªè®¡ç®—äº†ä½ç½®ï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œä½†æ˜¯æ•´ä½“å¸ƒå±€éƒ½è¦è®¡ç®—ä¸€éï¼Œæ‰èƒ½å¾—åˆ°å½“å‰ DOM çš„å¸ƒå±€å±æ€§ï¼Œæ‰€ä»¥éå¸¸è€—æ—¶ã€‚ç»˜åˆ¶è¿˜æ˜¯åœ¨åŒæ­¥ä»»åŠ¡å’Œå¾®ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œå†ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­å¯ä»¥éªŒè¯ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 100px; height: 100px; background: lightblue&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;test()&quot;</span>&gt;</span>ç‚¹å‡»å¼€å§‹æµ‹è¯•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> box = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;box&quot;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">msg</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;performance.now().toFixed(<span class="hljs-number">1</span>)&#125;</span>ms: <span class="hljs-subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ç‚¹å‡»å¼€å§‹æµ‹è¯•&quot;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// æ”¹å˜æ ·å¼ï¼Œä½†è¿˜æœªæ¸²æŸ“</span></span><br><span class="language-javascript">      box.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">&quot;300px&quot;</span>;</span><br><span class="language-javascript">      <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;å·²ä¿®æ”¹æ ·å¼ width=300px (å°šæœªæ¸²æŸ“)&quot;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// å¼ºåˆ¶è§¦å‘ä¸€æ¬¡é‡æ’ï¼Œä½†æ˜¯æ²¡æœ‰ç»˜åˆ¶æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘ requestAnimationFrame å›è°ƒ</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> width = box.<span class="hljs-property">offsetWidth</span>;</span><br><span class="language-javascript">      <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;è¯»å– offsetWidth=&quot;</span> + width + <span class="hljs-string">&quot;ï¼ˆè§¦å‘åŒæ­¥å¸ƒå±€è®¡ç®—ï¼Œä½†ä¹Ÿæ²¡æœ‰ç»˜åˆ¶ï¼‰&quot;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      box.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">&quot;200px&quot;</span>;</span><br><span class="language-javascript">      <span class="hljs-comment">// å¼ºåˆ¶è§¦å‘ä¸€æ¬¡é‡æ’ï¼Œä½†æ˜¯æ²¡æœ‰ç»˜åˆ¶æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘ requestAnimationFrame å›è°ƒ</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> height = box.<span class="hljs-property">offsetHeight</span>;</span><br><span class="language-javascript">      <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;è¯»å– offsetHeight=&quot;</span> + height + <span class="hljs-string">&quot;ï¼ˆè§¦å‘åŒæ­¥å¸ƒå±€è®¡ç®—ï¼Œä½†ä¹Ÿæ²¡æœ‰ç»˜åˆ¶ï¼‰&quot;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// å¾®ä»»åŠ¡æµ‹è¯•</span></span><br><span class="language-javascript">      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Promise.thenï¼ˆå¾®ä»»åŠ¡ï¼‰æ‰§è¡Œ&quot;</span>);</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// å®ä»»åŠ¡æµ‹è¯•</span></span><br><span class="language-javascript">      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;setTimeoutï¼ˆä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼‰æ‰§è¡Œ&quot;</span>);</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// åœ¨ rAF ä¸­è§‚å¯Ÿä½•æ—¶è¢«è°ƒç”¨</span></span><br><span class="language-javascript">      <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;requestAnimationFrame æ‰§è¡Œï¼ˆæ¸²æŸ“å‰ï¼‰&quot;</span>);</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// æ¨¡æ‹Ÿä¸»çº¿ç¨‹å¡é¡¿</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();</span><br><span class="language-javascript">      <span class="hljs-keyword">while</span> (performance.<span class="hljs-title function_">now</span>() - start &lt; <span class="hljs-number">50</span>) &#123;&#125; <span class="hljs-comment">// å ç”¨ 50ms</span></span><br><span class="language-javascript">      <span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;é•¿ä»»åŠ¡ç»“æŸï¼ˆä¸»çº¿ç¨‹åˆšç©ºé—²ï¼‰&quot;</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs paint">1062.0ms: ç‚¹å‡»å¼€å§‹æµ‹è¯•<br>1062.2ms: å·²ä¿®æ”¹æ ·å¼ width=300px (å°šæœªæ¸²æŸ“)<br>1062.3ms: è¯»å– offsetWidth=300ï¼ˆè§¦å‘åŒæ­¥å¸ƒå±€è®¡ç®—,ä½†ä¹Ÿæ²¡æœ‰ç»˜åˆ¶ï¼‰<br>1062.5ms: è¯»å– offsetHeight=200ï¼ˆè§¦å‘åŒæ­¥å¸ƒå±€è®¡ç®—ï¼Œä½†ä¹Ÿæ²¡æœ‰ç»˜åˆ¶ï¼‰<br>1112.6ms: é•¿ä»»åŠ¡ç»“æŸï¼ˆä¸»çº¿ç¨‹åˆšç©ºé—²ï¼‰<br>1112.7ms: Promise.thenï¼ˆå¾®ä»»åŠ¡ï¼‰æ‰§è¡Œ<br>1113.1ms: requestAnimationFrame æ‰§è¡Œï¼ˆæ¸²æŸ“å‰ï¼‰<br>1113.5ms: setTimeoutï¼ˆä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼‰æ‰§è¡Œ<br></code></pre></td></tr></table></figure><h3 id="åŠ å…¥-event-loop-ä¸€èµ·çœ‹">åŠ å…¥ event loop ä¸€èµ·çœ‹</h3><p>JavaScript æ˜¯å•çº¿ç¨‹ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼ŒåŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯â€œè°ƒç”¨æ ˆâ€æ¥è¿½è¸ªå‡½æ•°æ‰§è¡Œçš„é¡ºåºã€‚</p><ul><li>è°ƒç”¨æ ˆæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œä½¿ç”¨åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰åŸç†ä¸´æ—¶å­˜å‚¨å’Œç®¡ç†å‡½æ•°è°ƒç”¨</li><li>è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šå°†å®ƒæ”¾åˆ°æ ˆé¡¶ã€‚ä»å‡½æ•°è¿”å›æ—¶ï¼Œå†æŠŠå®ƒä»æ ˆé¡¶å¼¹å‡ºã€‚<br>æ¯”å¦‚ A å‡½æ•°è°ƒç”¨ B å‡½æ•°ï¼ŒB å‡½æ•°è°ƒç”¨äº† C å‡½æ•°ï¼Œå°±æ˜¯ä¸‹é¢çš„è°ƒç”¨æ ˆï¼Œå…ˆæ‰§è¡Œ Cï¼Œå†æ‰§è¡Œ Bï¼Œæœ€åæ‰§è¡Œ Aã€‚å¦‚æœæœ‰å¼‚æ­¥ä»»åŠ¡ï¼Œå°±å…ˆç­‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œï¼Œç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼Œæ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œå†æ”¾è¿›è°ƒç”¨æ ˆé‡Œæ‰§è¡Œã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs paint">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   C()     â”‚  â† æ­£åœ¨æ‰§è¡Œ<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚   B()     â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚   A()     â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>event loop æ˜¯æµè§ˆå™¨çš„ event loopï¼Œæ‰€ä»¥ä» script æ ‡ç­¾å¼€å§‹ï¼Œscript æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs paint">å®ä»»åŠ¡ --&gt; å¾®ä»»åŠ¡ --&gt; æ¸²æŸ“(é‡æ’é‡ç»˜) --&gt; å†æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡<br></code></pre></td></tr></table></figure><p>ğŸ”¹ å®ä»»åŠ¡ï¼ˆMacroTaskï¼‰<br>æ¯ä¸ªå®ä»»åŠ¡éƒ½æ˜¯ä¸€æ¬¡ç‹¬ç«‹çš„æ‰§è¡Œç‰‡æ®µï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>scriptï¼ˆæ•´ä½“ä»£ç ï¼‰</li><li>setTimeout</li><li>setInterval</li><li>setImmediateï¼ˆNodeï¼‰</li><li>I/Oï¼ˆç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶é€‰æ‹©ä¸Šä¼ ï¼š<input type="file">ã€æ–‡ä»¶è¯»å–ï¼šFileReader API è¯»å–æœ¬åœ°æ–‡ä»¶å†…å®¹ã€æ–‡ä»¶ä¿å­˜ï¼šè§¦å‘ä¸‹è½½æˆ–ä½¿ç”¨â€œæ–‡ä»¶è®¿é—® APIâ€ã€æœ¬åœ°å­˜å‚¨ï¼šlocalStorage/sessionStorage/indexedDBã€Cache APIï¼šç¼“å­˜ç½‘ç»œè¯·æ±‚å“åº”ï¼‰</li></ul><p>ğŸ”¹ å¾®ä»»åŠ¡ï¼ˆMicroTaskï¼‰</p><p>æ¯æ¬¡å®ä»»åŠ¡æ‰§è¡Œå®Œåç«‹å³æ¸…ç©ºï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>Promise.then / catch / finally</li><li>queueMicrotask</li><li>MutationObserver</li><li>process.nextTickï¼ˆNode ç‹¬æœ‰ï¼‰</li></ul><p><strong>å®Œæ•´äº‹ä»¶ï¼š</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-number">1</span>. å–å‡ºä¸‹ä¸€ä¸ªå®ä»»åŠ¡ (task)  â”‚<br>â”‚ <span class="hljs-number">2</span>. æ‰§è¡Œæ‰€æœ‰åŒæ­¥ä»£ç           â”‚<br>â”‚ <span class="hljs-number">3</span>. æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ (Promiseç­‰) â”‚<br>â”‚ <span class="hljs-number">4</span>. åˆ¤æ–­æ˜¯å¦éœ€è¦æ¸²æŸ“ï¼š         â”‚<br>â”‚    - è¿™ä¸€å¸§æ˜¯å¦åˆ°äº† (<span class="hljs-number">16.6ms</span>) â”‚<br>â”‚    - é¡µé¢æœ‰æ”¹åŠ¨å—ï¼Ÿ          â”‚<br>â”‚    - ä¸»çº¿ç¨‹ç©ºé—²å—ï¼Ÿ          â”‚<br>â”‚ <span class="hljs-number">5</span>. å¦‚æœæ»¡è¶³ï¼Œå°±æ‰§è¡Œä¸€å¸§æ¸²æŸ“    â”‚<br>â”‚ <span class="hljs-number">6</span>. ç„¶åè¿›å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡å¾ªç¯   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æµè§ˆå™¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æµè§ˆå™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>React Scheduleæºç é˜…è¯»</title>
    <link href="/2023/11/20/React-Schedule/"/>
    <url>/2023/11/20/React-Schedule/</url>
    
    <content type="html"><![CDATA[<h3 id="å…¥å£-unstable-scheduleCallback-è°ƒåº¦-callback">å…¥å£ unstable_scheduleCallback è°ƒåº¦ callback</h3><ol><li><p>å¼€å§‹æ—¶é—´(startTime = å½“å‰æ—¶é—´ + ä¼ å…¥çš„ delay) + ä¼˜å…ˆçº§æ—¶é—´ï¼Œè®¡ç®—å¤±æ•ˆæ—¶é—´(expirationTime)</p></li><li><p>åˆ›å»º newTask(æ¥è‡ª unstable_scheduleCallback)</p><ul><li>id:</li><li>callback // ä¼ è¿›æ¥çš„ callback</li><li>priorityLevel // ä¼ è¿›æ¥çš„ä¼˜å…ˆçº§ priorityLevel</li><li>startTime // ä¸Šé¢è®¡ç®—çš„æ—¶é—´</li><li>expirationTime // ä¸Šé¢è®¡ç®—çš„å¤±æ•ˆæ—¶é—´</li><li>sortIndex: -1 // ??? éƒ½æ˜¯è¢«å¤åˆ¶ä¸º expirationTime</li></ul></li><li><p>å¦‚æœæ˜¯<code>å®šæ—¶ä»»åŠ¡(å½“å‰æ—¶é—´åçš„ä¸€å®šæ—¶é—´æ‰æ‰§è¡Œï¼Œç°åœ¨è¿˜æ²¡æœ‰è¿›å…¥è°ƒåº¦çš„èµ„æ ¼ï¼Œæ”¾åœ¨timerQueueä¸­)</code>ï¼Œä¹Ÿå°±æ˜¯æœªæ¥æ—¶é—´æ‰§è¡Œçš„ä»»åŠ¡(startTime &gt; currentTime)</p><ul><li>å°† startTime èµ‹å€¼ç»™ sortIndex(newTask.sortIndex = startTime)</li><li>å°† newTask åŠ å…¥<code>å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—ä¸­(timerQueue)</code></li><li>å¦‚æœåªæœ‰<code>å®šæ—¶ä»»åŠ¡(timeQueue)</code>,ç­‰å¾…å»¶è¿Ÿæ‰§è¡Œæ—¶é—´åï¼Œè§¦å‘<code>å¤„ç†è¶…æ—¶å‡½æ•°(handleTimeout)</code>,</li><li><code>å¤„ç†è¶…æ—¶å‡½æ•°(handleTimeout)</code>ï¼š<ul><li><code>æå–å®šæ—¶é˜Ÿåˆ—ä¸­åˆ°æ—¶é—´çš„çš„ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—taskQueue(advanceTimers)</code>ï¼šä¸»è¦æ˜¯ä»å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—(timeQueue)å°†åˆ°æ—¶é—´çš„ä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­(taskQueue)ï¼›æ²¡æœ‰ callback çš„é‡Šæ”¾æ‰ï¼›æ²¡æœ‰åˆ°æ‰§è¡Œæ—¶é—´çš„ä»»åŠ¡ï¼Œå†ç­‰ç­‰ï¼›</li><li>ç”±äºå®šæ—¶ä»»åŠ¡å·²ç»åˆ°æ‰§è¡Œæ—¶é—´ï¼Œå°±æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œç„¶åæŸ¥çœ‹æ˜¯å¦æœ‰ä»»åŠ¡æ‰§è¡Œï¼Œæ²¡æœ‰ä»»åŠ¡å°±æ‰§è¡Œè¯¥ä»»åŠ¡(å”¯ä¸€æ‰§è¡Œæœºåˆ¶ï¼šç”¨<code>isHostCallbackScheduled</code>æ ‡è¯†æ¥æ ‡è¯†ä¹‹å‰æ˜¯å¦æœ‰<code>ä¸‹ä¸€æ¬¡äº‹ä»¶å¾ªç¯ç»“æŸç«‹å³æ‰§è¡Œä»»åŠ¡</code>)ï¼Œæœ‰å°±é‡Šæ”¾æ‰ã€‚</li><li><code>è¯·æ±‚ä¸»æŒå›è°ƒä»»åŠ¡(requestHostCallback)</code>ï¼šå¯åŠ¨ä¸€ä¸ª<code>è°ƒåº¦ æ‰§è¡Œç­‰åˆ°æœ€åæœŸé™ä»»åŠ¡(schedulePerformWorkUntilDeadline)</code>æ¥æ‰§è¡Œ<code>åˆ·æ–°å·¥ä½œ(flushWork)</code>ï¼Œå¹¶ä¸”ç”¨<code>isMessageLoopRunning</code>æ¥é”å®šåªæœ‰ä¸€æ¬¡ä»»åŠ¡åœ¨ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯åç«‹å³æ‰§è¡Œã€‚<code>åˆ·æ–°å·¥ä½œ(flushWork)</code>æ˜¯æŒ‚åœ¨<code>å…¨å±€å˜é‡scheduledHostCallback</code>ä¸Šï¼Œä¹‹ååœ¨<code>ç­‰åˆ°æœ€åæœŸé™æ—¶æ‰§è¡Œä»»åŠ¡(performWorkUntilDeadline)</code>è°ƒç”¨ï¼Œä¹‹æ‰€ä»¥æ”¾åœ¨<code>å…¨å±€å˜é‡scheduledHostCallback</code>ä¸Šï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿æ‰©å±•ï¼Œæ‰§è¡Œå…¶ä»–å‡½æ•°ã€‚</li><li><code>isHostCallbackScheduled</code>å’Œ<code>isMessageLoopRunning</code>ä½œç”¨ä¸€æ ·ï¼Œ ä¿è¯ä¸€æ¬¡ event loop ååªæœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ,å¹¶ä¸”æ˜¯ä¸²è¡Œçš„(ä¿è¯äº†æ‰€æœ‰çš„äº‹ä»¶å ç”¨æ—¶é—´æ˜¯ç¡®å®šçš„ï¼Œç©ºé—²ä¹Ÿæ˜¯ç¡®å®šçš„)ï¼ŒåŒé‡ä¿é™©ã€‚</li></ul></li></ul></li><li><p>ä¸æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œå°†è¯¥ä»»åŠ¡æ”¾å…¥<code>ä»»åŠ¡é˜Ÿåˆ—(taskQueue)</code>ä¸­åï¼Œ<code>è¯·æ±‚ä¸»æŒå›è°ƒä»»åŠ¡(requestHostCallback)</code>ï¼Œæœ€ç»ˆä¼šç»Ÿä¸€åœ¨<code>ç­‰åˆ°æœ€åæœŸé™æ—¶æ‰§è¡Œä»»åŠ¡(performWorkUntilDeadline)</code>ä¸­æ‰§è¡Œã€‚</p></li><li><p><code>ç­‰åˆ°æœ€åæœŸé™æ—¶æ‰§è¡Œä»»åŠ¡(performWorkUntilDeadline)</code></p><ul><li>å†…éƒ¨è°ƒç”¨<code>å…¨å±€å˜é‡scheduledHostCallback</code>å³æ˜¯<code>flushWork(true,currentTime)</code>, å¹¶ä¸”åœ¨å‡½æ•°å¼€å§‹æ—¶ï¼Œè®°å½•ä¸‹å½“å‰æ—¶é—´ä¸º<code>å¼€å§‹æ—¶é—´(startTime)</code>,æ–¹ä¾¿åé¢åˆ¤æ–­æ˜¯å¦åœ¨ä¸€å¸§ä¹‹å†…è¿˜æœ‰æ—¶é—´ï¼Œä½œä¸ºæ˜¯å¦è¿˜ç»§ç»­æ‰§è¡Œä»»åŠ¡çš„ä¾æ®ã€‚</li><li>å¾—åˆ°<code>flushWork</code>è¿”å›çš„ç»“æœ<code>æ˜¯å¦æœ‰æ›´å¤šçš„å·¥ä½œ(hasMoreWork)</code>ï¼Œå¦‚æœæœ‰æ›´å¤šçš„å·¥ä½œï¼Œæœ‰å¯èƒ½æ˜¯ä¼˜å…ˆçº§ä»»åŠ¡å¸¦æ¥çš„å»¶è¿Ÿæ—¶é—´å¯¼è‡´ä»»åŠ¡æ²¡æœ‰åˆ°è¿‡æœŸæ—¶é—´(???)ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ‰§è¡Œçš„ä»»åŠ¡ä¸æ˜¯ taskQueue çš„ç¬¬ä¸€ä¸ªå¯¼è‡´æ²¡åˆ é™¤ä¹Ÿæ²¡å¤„ç†å°±è‡ªåŠ¨ä»æ–°å¼€å§‹ï¼Œå°±ç»§ç»­<code>è°ƒåº¦æœ€åæœŸé™ä»»åŠ¡(schedulePerformWorkUntilDeadline)</code>çš„<code>åˆ·æ–°ä»»åŠ¡(flushWork)</code>ï¼Œ</li></ul></li><li><p><code>åˆ·æ–°å·¥ä½œ(flushWork)</code></p><ul><li>æµ‹è¯•ç¯å¢ƒæ—¶ enableProfiling ä¸º trueï¼Œä¼šåŠ  try{}catch åŒ…è£¹<code>wookLoop</code>,æŠŠæŠ¥é”™æ˜¾ç¤ºåœ¨å±å¹•,ç”Ÿäº§ç¯å¢ƒæ—¶,ç›´æ¥æ‰§è¡Œ<code>wookLoop</code></li><li><code>å·¥ä½œå¾ªç¯(wookLoop)</code>:<ul><li><code>æå–å®šæ—¶é˜Ÿåˆ—ä¸­åˆ°æ—¶é—´çš„çš„ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—taskQueue(advanceTimers)</code></li><li>æ‹¿å‡ºæœ€æ—©çš„ä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡å­˜åœ¨ï¼Œå¹¶ä¸”ä¸æ˜¯è°ƒåº¦ debug æ¨¡å¼ï¼Œé‚£ä¹ˆå°±æ˜¯æ­£å¸¸æµç¨‹<ul><li>åˆ¤æ–­æ˜¯å¦ä¸­æ–­æ‰§è¡Œï¼š<code>è¿‡æœŸæ—¶é—´(expirationgTime)</code> å¤§äº <code>å½“å‰æ—¶é—´(currentTime)</code> ,æˆ–è€…<code>åˆ·æ–°å·¥ä½œ</code>çš„å¼€å§‹æ—¶é—´åˆ°ç°åœ¨æ—¶é—´ å¤§äº ä¸€å¸§æ—¶é—´ï¼Œå°±ä¸­æ–­ã€‚(hasTimeRemaining è¿™ä¸ªå­—æ®µæš‚æ—¶æ²¡ç”¨)ã€‚è¿™é‡Œæ‰ç”¨åˆ°ä¼˜å…ˆçº§äº§ç”Ÿçš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰åˆ°æœŸï¼Œå°±ä¸æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°è¿”å› true ç»™çˆ¶çº§å‡½æ•°ï¼Œç„¶åç»§ç»­<code>è°ƒåº¦æœ€åæœŸé™ä»»åŠ¡(schedulePerformWorkUntilDeadline)</code></li><li>æ²¡æœ‰ä¸­æ–­æ‰§è¡Œçš„è¯ï¼Œå°±æ£€æŸ¥ task.callback æ˜¯å¦æ˜¯ä¸ªå‡½æ•°ï¼Œå¦‚æœä¸æ˜¯ç›´æ¥é‡Šæ”¾æ‰ taskï¼›</li><li>å¦‚æœ task.callback æ˜¯å‡½æ•°ï¼Œå°† task.callback çš„åœ°å€å¤åˆ¶ç»™å½“å‰å±€éƒ¨å˜é‡ callbackï¼Œç„¶åå°† task.callback ç½®ä¸º null,å°†<code>ä»»åŠ¡çš„ä¼˜å…ˆçº§(task.priorityLevel)</code>è®¾ç½®ä¸º<code>å½“å‰ä¼˜å…ˆçº§(currentPriorityLevel)</code>,ç„¶åæ‰§è¡Œ callback,å¹¶ä¼ å…¥å‚æ•°è¿‡æœŸæ ‡è¯†(å°±æ˜¯ true)<ul><li>å¦‚æœ<code>callback(true)</code>è¿”å›ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå°†è¯¥å‡½æ•°èµ‹å€¼ç»™<code>task.callback</code>ï¼Œå°†å†æ¬¡è¿›å…¥å¾ªç¯ï¼Œæ‰§è¡Œ callback ä»»åŠ¡,å†æ¬¡è¿›å…¥å¾ªç¯çš„æ–¹æ³•å°±æ˜¯ä¸ä» taskQueue ä¸­å»æ‰ã€‚</li><li>å¦‚æœ<code>callback(true)</code>è¿”å›ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°†å‰”é™¤å½“å‰ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯å‰”é™¤ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ ·å°±æ²¡åŠæ³•å¾ªç¯è‡ªèº«äº†ã€‚å› ä¸ºå½“å‰çš„ä»»åŠ¡æ€»æ˜¯ä»»åŠ¡é˜Ÿåˆ—æœ€ä¼˜å…ˆæ‰§è¡Œçš„ï¼Œæ‰€ä»¥å°±æ˜¯å½“å‰æ‰§è¡Œæ‰çš„ã€‚æ‰€ä»¥å°±æ˜¯ä»»åŠ¡é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªã€‚</li><li>ç„¶ååšä¸€é<code>æå–å®šæ—¶é˜Ÿåˆ—ä¸­åˆ°æ—¶é—´çš„çš„ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—taskQueue(advanceTimers)</code>ï¼Œä¹‹åå–ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªä»»åŠ¡æ¥ç»§ç»­å¾ªç¯ã€‚</li></ul></li></ul></li><li>ä»¥é˜²<code>å½“å‰çš„ä»»åŠ¡(currentTask)</code>ä¸æ˜¯ <code>ä»»åŠ¡é˜Ÿåˆ—(taskQueue)</code>ä¸­çš„ç¬¬ä¸€ä¸ªï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½æ²¡ä»<code>ä»»åŠ¡é˜Ÿåˆ—(taskQueue)</code>ä¸­åˆ é™¤æ‰ï¼Œå†æ¬¡æ£€æŸ¥ currentTask æ˜¯å¦æ˜¯ nullï¼Œå¦‚æœæ˜¯ï¼Œå°±è¿”å› true ç»™<code>æ‰§è¡Œè¿‡æœŸçš„ä»»åŠ¡(performWorkUntilDeadline)</code>,å®ƒä¼šäº§ç”Ÿä¸€ä¸ª<code>è°ƒåº¦è¿‡æœŸä»»åŠ¡(schedulePerformWorkUntilDeadline)</code>ï¼›åŒæ—¶å¦‚æœä»»åŠ¡æ²¡æœ‰åˆ°è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œæ­¤æ—¶ currentTask è¿˜æ˜¯ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå°±è¿”å› true ç»™<code>æ‰§è¡Œåˆ°è¿‡æœŸçš„ä»»åŠ¡(performWorkUntilDeadline)</code>ï¼Œå®ƒä¼šäº§ç”Ÿä¸€ä¸ª<code>è°ƒåº¦è¿‡æœŸä»»åŠ¡(schedulePerformWorkUntilDeadline)</code></li><li>å¦‚æœä¸ºç©ºï¼Œé‚£ä¹ˆåªå‰©å®šæ—¶ä»»åŠ¡ï¼Œå°±é‡å¤å®šæ—¶ï¼Œç„¶åè§¦å‘<code>å¤„ç†è¶…æ—¶å‡½æ•°(handleTimeout)</code></li></ul></li></ul></li></ol><h2 id="è·¯ç¨‹ä¸Šçš„ç–‘æƒ‘ï¼Œçœ‹å®Œåè§£ç­”">è·¯ç¨‹ä¸Šçš„ç–‘æƒ‘ï¼Œçœ‹å®Œåè§£ç­”</h2><ol><li><code>å®šæ—¶ä»»åŠ¡</code>,<code>ä¼˜å…ˆçº§äº§ç”Ÿçš„æ—¶é—´é—´éš”é€ æˆçš„è¿‡æœŸæ—¶é—´</code>ï¼Œä¸€å¼€å§‹æ˜¯ç­‰å¾…çš„<code>å®šæ—¶æ—¶é—´</code>ï¼Œç­‰åˆ°åˆ¤æ–­å¦æ˜¯æ‰§è¡Œçš„æ—¶å€™ç”¨çš„æ˜¯<code>è¿‡æœŸæ—¶é—´</code>æ¥æ£€æŸ¥æ˜¯å¦å¤§äºå½“å‰æ—¶é—´ï¼Œå¦‚æœè¿˜æ²¡åˆ°ï¼Œé‚£ä¹ˆå°±è¿”å›æœ‰ä»»åŠ¡</li><li>å–æ¶ˆå‰ä¸€ä¸ª<code>å®šæ—¶ä»»åŠ¡</code>ï¼Œä¼šåœ¨ workLoop é‡Œé¢æ‰§è¡Œ<code>æå–åˆ°æ—¶é—´çš„å®šæ—¶ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—(advanceTimers)</code>,å’Œæ‰§è¡Œå®Œä»»åŠ¡é˜Ÿåˆ—åä¹Ÿä¼šæ‹¿<code>å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—</code>å†æ¬¡è®¾ç½®<code>å®šæ—¶å™¨(requestHostTimeout)</code>æ¥å†æ¬¡æ‰§è¡Œ<code>è¶…æ—¶å¤„ç†å‡½æ•°</code>æ¥æ£€æŸ¥åˆ°æœŸä»»åŠ¡ã€‚</li></ol><h2 id="å±æ€§">å±æ€§</h2><ol><li>ä¼˜å…ˆçº§å¯¹åº”çš„æ—¶é—´å»¶è¿Ÿ<ul><li>ImmediatePriorityï¼š -1 // ä¹Ÿå°±æ˜¯ç«‹å³æ‰§è¡Œ</li><li>UserBlockingPriorityï¼š 250 // ç”¨æˆ·é”å®šï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·ä¸€ç›´æ“ä½œçš„é—´éš”</li><li>IdlePriorityï¼šmaxSigned31BitIntï¼Œä¹Ÿå°±æ˜¯ 1073741823ï¼Œä¹Ÿå°±æ˜¯ 2^30 - 1 // ç©ºé—²</li><li>LowPriorityï¼š10000 // ä½ä¼˜å…ˆçº§</li><li>NormalPriorityï¼š5000 // æ­£å¸¸ä¼˜å…ˆçº§</li></ul></li><li>taskQueue æ˜¯åŒæ­¥ä»»åŠ¡é˜Ÿåˆ—</li><li>timerQueue å®šæ—¶ä»»åŠ¡ï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥ä¹Ÿä¸åœ¨è°ƒåº¦ä¹‹ä¸­ï¼Œç­‰åˆ°æ‰§è¡Œæ—¶é—´åæ‰è¿›å…¥è°ƒåº¦å¾ªç¯ã€‚</li><li>scheduledHostCallback<ul><li>requestHostCallback é‡Œèµ‹å€¼</li><li>performWorkUntilDeadline é‡Œæ‰§è¡Œ</li></ul></li><li>schedulePerformWorkUntilDeadline äº§ç”Ÿå®ä»»åŠ¡ï¼Œå°†æ‰§è¡ŒæƒåŠ›ç§»äº¤æµè§ˆå™¨<ul><li>å…³äºèµ‹å€¼æ˜¯ä¼˜å…ˆ setImmediateï¼Œå› ä¸ºæ˜¯ç»è¿‡ä¸€è½® event loop ç«‹å³æ‰§è¡Œï¼Œä½†æ˜¯å…¼å®¹æ€§ä¸å¥½ï¼Œå¯ä»¥ä½¿ç”¨ MessageChannel æ¥å®ç°ï¼Œå¦‚æœæ²¡æœ‰ MessageChannelï¼Œå†ç”¨ setTimeOut,ä½†æ˜¯æµè§ˆå™¨çš„ setTimeout(() =&gt; {â€¦},0)çš„ delay èµ·ç æ˜¯ 4ï¼Œä¹Ÿå°±æ˜¯ä¼šè¢«ä¿®æ”¹æˆ setTimeout(() =&gt; {â€¦},4)ï¼Œå°±æµªè´¹äº† 4ms</li><li>schedulePerformWorkUntilDeadline çš„å›è°ƒæ˜¯ performWorkUntilDeadline</li></ul></li><li>isHostCallbackScheduled é”å®š<code>ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯ç«‹å³æ‰§è¡Œçš„å®ä»»åŠ¡(schedulePerformWorkUntilDeadline)</code>åœ¨ä¸€æ¬¡ event loop å¾ªç¯åªæœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œã€‚</li><li>isMessageLoopRunning è·Ÿ isHostCallbackScheduled çš„ä½œç”¨ä¸€æ ·ï¼ŒåŒé‡ä¿é™©</li><li>isHostTimeoutScheduled æ˜¯ç”¨æ¥æ‰“æ–­ä¹‹å‰çš„ç­‰å¾…ä»»åŠ¡ï¼Œæ¯æ¬¡è¿›æ¥çš„ä»»åŠ¡æ˜¯å»¶è¿Ÿä»»åŠ¡ï¼Œå¹¶ä¸”åªæœ‰å»¶è¿Ÿä»»åŠ¡ï¼Œé‚£ä¹ˆä¹…æ‰“æ–­ä¸Šä¸€ä¸ªå»¶è¿Ÿä»»åŠ¡çš„ç­‰å¾…æ—¶é—´ã€‚</li><li>hasTimeRemainingï¼šä»£è¡¨å½“å‰å¸§æ˜¯å¦è¿˜æœ‰æ—¶é—´ç•™ç»™ react</li><li>è¿™é‡Œçš„ callback ä¹Ÿå°±æ˜¯å¤–éƒ¨ä¼ è¿›æ¥çš„æ‰§è¡Œå‡½æ•°ä¹Ÿå°±æ˜¯æ‰§è¡Œä»»åŠ¡</li><li><code>ä¸‹ä¸€æ¬¡æ—¶é—´å¾ªç¯ç»“æŸç«‹å³æ‰§è¡Œä»»åŠ¡</code> å°±æ˜¯ä¸€ä¸ªæ‰§è¡Œäº‹ä»¶çš„æ—¶æœº</li></ol><h2 id="å †æ’åº-Schedule-åˆ©ç”¨æœ€å°å †æ¥è·å–æœ€æ—©çš„ä»»åŠ¡">å †æ’åº(Schedule åˆ©ç”¨æœ€å°å †æ¥è·å–æœ€æ—©çš„ä»»åŠ¡)</h2><ol><li>è°ƒåº¦å°±æ˜¯ç”¨å †æ’åºæ¥è·å¾—æœ€æ—©è¿‡æœŸä»»åŠ¡çš„ï¼Œæœ€å°å †ï¼Œæœ€å°çš„æ—¶é—´æˆ³åœ¨ index=0 ä½ç½®</li><li>ä¹‹æ‰€ä»¥ç”¨å †æ’åºï¼Œæ˜¯å› ä¸ºæ—¶é—´å¤æ‚åº¦æ›´ä½ï¼Œæœ€å°å †æ„å»ºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ç²¾ç¡®æ—¶é—´å¤æ‚åº¦æ˜¯ n-log(n+1),æ¯” n è¿˜å°ã€‚æ¯æ¬¡åŠ å…¥ä¸€ä¸ªä»»åŠ¡ä¹‹åå°±æ„å»ºæœ€å°å †ï¼Œäº‹ä»¶å¤æ‚åº¦æ˜¯ O(n)ï¼Œæ¯”å†’æ³¡æ’åº O(n^2)å¿«å¾ˆå¤šã€‚</li><li><a href="https://github.com/March-Wind/tool/tree/master/src/algorithm/heap-sort">è®²è§£é“¾æ¥</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>React</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>é˜…è¯»æºç æ­¥éª¤</title>
    <link href="/2023/03/11/%E9%98%85%E8%AF%BB%E6%BA%90%E7%A0%81%E6%B8%90%E8%BF%9B%E6%AD%A5%E9%AA%A4/"/>
    <url>/2023/03/11/%E9%98%85%E8%AF%BB%E6%BA%90%E7%A0%81%E6%B8%90%E8%BF%9B%E6%AD%A5%E9%AA%A4/</url>
    
    <content type="html"><![CDATA[<h3 id="é˜…è¯»æºç æ­¥éª¤ï¼š">é˜…è¯»æºç æ­¥éª¤ï¼š</h3><ol><li>é˜…è¯»å®˜ç½‘ï¼Œ<blockquote><p>åŸå› ï¼šå®˜ç½‘ä¼šäº¤ä»£è¿™ä¸ªåº“æ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜çš„,å¼•å…¥ä»€ä¹ˆæ¦‚å¿µã€‚é˜…è¯»ä¸€äº› apiï¼Œä¹Ÿæœ‰åŠ©äºæ‹¼å‡‘è¿™ä¸ªåº“çš„å°è±¡ã€‚</p></blockquote></li><li>api éƒ½ä½¿ç”¨ä¸€é<blockquote><p>åŸå› ï¼šapi å°±æ˜¯æš´éœ²å‡ºæ¥çš„åŠŸèƒ½ï¼Œæºç æ˜¯å®ç°è¿™äº›åŠŸèƒ½çš„è¿‡ç¨‹ï¼Œä½¿ç”¨ apiï¼Œç„¶ååŸºäºè‡ªå·±çš„çŸ¥è¯†çŒœæƒ³å®ç°è¿‡ç¨‹ï¼Œæœ‰åŠ©äºå¯¹æºç ç»†èŠ‚çš„ç†è§£ï¼ŒçŒœé”™ä¹Ÿæ²¡å…³ç³»ã€‚</p></blockquote></li><li>é˜…è¯»å¼€å‘å·¥ä½œç»„çš„è®¨è®ºè´´<blockquote><p>åŸå› ï¼šè®¨è®ºå¸–ä¸­å¸¸å¸¸ä¼šè´´å‡ºä¸€äº›é—®é¢˜ï¼Œç„¶åæŒ‡å‡ºè§£å†³æ–¹æ¡ˆï¼Œå……åˆ†çš„é˜…è¯»ï¼Œæœ‰åŠ©äºçŸ¥é“æºç ä¸ºä»€ä¹ˆè¿™ä¹ˆå®ç°ã€‚çœ‹æºç çš„æ—¶å€™å°±èƒ½å‡å°‘å¾ˆå¤šç–‘é—®å’Œå¡ç‚¹ã€‚</p></blockquote></li><li>ä»å…¥å£ debug æºç ï¼š<ul><li>æŠ€å·§ï¼š<ol><li>ä¸»è¦æ‰¾åˆ°å‡ ä¸ªå…³é”®èŠ‚ç‚¹ï¼Œå’Œæ‰§è¡Œç»“å°¾ï¼Œå¯¹å˜é‡çš„è®°å¿†ï¼Œä¸ç†è§£ä¹Ÿæ²¡å…³ç³»</li><li>å¯¹æ²¡è§è¿‡çš„ api æˆ–ç®—æ³•æ‰«ç›²ï¼Œå¢åŠ ç†Ÿæ‚‰ç¨‹åº¦ã€‚</li></ol></li></ul></li><li>ç›´æ¥é˜…è¯»æºç ï¼š<ul><li>æŠ€å·§ï¼š<ol><li>å˜é‡å‘½åè¦ææ‡‚ï¼Œåº“çš„å‘½åä¸€èˆ¬éƒ½å¾ˆç²¾ç¡®ï¼Œå¼„æ‡‚å‘½åçš„å­—é¢æ„æ€æœ‰åŠ©äºç†è§£æ„å›¾ã€‚</li><li>é˜…è¯»æ³¨é‡Šï¼Œæœ‰åŠ©äºç†è§£äº¿å›¾ã€‚</li><li>ä¸ç†è§£çš„å˜é‡å¯ä»¥é€šè¿‡ vs code çš„ Find All References æ¥æ‰¾åˆ°ä½¿ç”¨ä½ç½®ï¼Œçœ‹çœ‹æ¯ä¸ªä½¿ç”¨ä½ç½®çš„ä¸Šä¸‹æ–‡ï¼Œæœ‰åŠ©äºç†è§£ã€‚</li><li>å¤šè¯» 5. é€šè¿‡ä½¿ç”¨ api æ–¹å¼å†æ¬¡ debugï¼ŒåŠ æ·±ç†è§£ã€‚</li></ol></li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>other</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
