<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ECharts 线条精确交互演示 (PC/移动端)</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 30px;
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 10px;
      }
      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }
      .chart-container {
        width: 100%;
        height: 500px;
        margin: 20px 0;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
      }
      .info {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 4px 4px 0;
      }
      .info h3 {
        margin: 0 0 10px 0;
        color: #1976d2;
      }
      .info ul {
        margin: 0;
        padding-left: 20px;
      }
      .info li {
        margin: 5px 0;
        color: #555;
      }
      .highlight {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        text-align: center;
        color: #856404;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🎯 ECharts 线条精确交互演示</h1>
      <p class="subtitle">
        演示透明辅助线如何实现精确的线条交互效果 (PC端Hover + 移动端点击)
      </p>

      <div class="info">
        <h3>📋 测试说明：</h3>
        <ul>
          <li><strong>蓝色线条</strong>：原始线条，宽度2px，正常显示</li>
          <li><strong>红色线条</strong>：原始线条，宽度2px，正常显示</li>
          <li>
            <strong>透明辅助区域</strong>：宽度12px，完全透明，用于扩大交互检测
          </li>
          <li>
            <strong>PC端测试重点</strong
            >：只有鼠标接近线条时才高亮，移动十字线经过数据点不会高亮
          </li>
          <li>
            <strong>移动端测试重点(自行切换手机模式F12选择手机模式)</strong
            >：点击线条附近可高亮切换，支持取消和切换
          </li>
        </ul>
      </div>

      <div class="highlight">
        💡 <strong>PC端测试</strong>：①鼠标hover线条附近→线条高亮
        ②十字线经过→不高亮！<br />
        📱 <strong>移动端测试</strong>：①点击线条附近→高亮切换
        ②再次点击→取消高亮！
      </div>

      <div id="chart" class="chart-container"></div>

      <div class="info">
        <h3>🔧 实现原理：</h3>
        <ul>
          <li>
            <strong>原理1：十字线经过数据点时不触发线条高亮：</strong
            >全局禁用axisPointer触发系列强调效果
            <pre>
              // 全局禁用axisPointer触发系列强调效果
              axisPointer: {
                triggerEmphasis: false, // 关键：全局禁用axisPointer触发系列强调效果
              }

              // 每个线条里的triggerEmphasis: false没有那么关键
              // 也就是series里每项的triggerEmphasis: false没有那么关键，但是也写上吧
              series: [
                {
                  ....
                  triggerEmphasis: false,
                }
              ]
            </pre>
            <code>triggerEmphasis: false</code>
          </li>
          <li>
            <strong>原理2：线条交互区域扩大检测：</strong
            >为每条线创建同名的透明辅助粗线（宽12px），比原始线条宽6倍，而且用户看不见，然后辅助粗线响应交互事件（PC端hover、移动端点击），也发给同名的原始线高亮，这样就扩大了交互区域

            <ul>
              <li>
                <strong>PC端：</strong>hover辅助线→高亮原始线，mouseout→恢复正常
              </li>
              <li>
                <strong>移动端：</strong
                >点击辅助线/原始线→切换高亮状态，支持取消和切换
              </li>
              <li>
                <strong>小技巧：</strong>辅助线置于底层（z:
                -1），用户看不见但能响应交互
              </li>
              <li>
                <strong>小技巧：</strong>通过dispatchAction高亮同名的原始线条
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/echarts@6.0.0/dist/echarts.min.js"></script>
    <script>
      // 初始化ECharts实例
      const chartDom = document.getElementById('chart');
      const myChart = echarts.init(chartDom);

      // 生成示例数据
      const generateData = (base, variance) => {
        const data = [];
        for (let i = 0; i < 50; i++) {
          data.push([
            i,
            base + Math.sin(i * 0.2) * variance + Math.random() * 20 - 10,
          ]);
        }
        return data;
      };

      const data1 = generateData(100, 30); // 蓝色线数据
      const data2 = generateData(150, 40); // 红色线数据

      const option = {
        title: {
          text: '线条精确交互测试 (PC端Hover / 移动端点击)',
          left: 'center',
          textStyle: {
            fontSize: 16,
          },
        },
        // 🎯 全局axisPointer配置 - 禁用自动强调
        axisPointer: {
          triggerEmphasis: false, // 关键：全局禁用axisPointer触发系列强调效果
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'cross',
            crossStyle: {
              color: '#999',
            },
            triggerEmphasis: false, // 🎯 关键：禁用axisPointer触发系列强调效果
          },
        },
        legend: {
          data: ['趋势线A', '趋势线B'],
          top: 40,
        },
        grid: {
          left: '3%',
          right: '4%',
          bottom: '3%',
          top: '15%',
          containLabel: true,
        },
        xAxis: {
          type: 'value',
          name: '时间点',
        },
        yAxis: {
          type: 'value',
          name: '数值',
        },
        series: [
          // === 原始线条A ===
          {
            name: '趋势线A',
            type: 'line',
            data: data1,
            smooth: true,
            lineStyle: {
              width: 2,
              color: '#1890ff',
            },
            itemStyle: {
              color: '#1890ff',
            },
            emphasis: {
              scale: false,
              lineStyle: {
                width: 4,
                shadowColor: 'rgba(24, 144, 255, 0.8)',
                shadowBlur: 8,
                shadowOffsetY: 2,
              },
            },
            showSymbol: false,
            hoverAnimation: true,
            triggerLineEvent: true,
            triggerEmphasis: false, // 🎯 关键：禁用被axisPointer自动强调
          },
          // === 透明辅助线A ===
          {
            name: '趋势线A', // 🎯 关键：同名！
            type: 'line',
            data: data1, // 🎯 关键：同数据！
            smooth: true,
            lineStyle: {
              width: 12, // 🚀 6倍宽度用于hover检测
              color: 'transparent', // 👻 完全透明
              opacity: 0,
            },
            itemStyle: {
              color: 'transparent',
              opacity: 0,
            },
            showInLegend: false, // 🚫 不显示在图例中
            showSymbol: false,
            hoverAnimation: false,
            triggerLineEvent: true,
            triggerEmphasis: false, // 🎯 关键：禁用被axisPointer自动强调
            z: -1, // 🎯 底层，不遮挡其他元素
          },

          // === 原始线条B ===
          {
            name: '趋势线B',
            type: 'line',
            data: data2,
            smooth: true,
            lineStyle: {
              width: 2,
              color: '#ff4d4f',
            },
            itemStyle: {
              color: '#ff4d4f',
            },
            emphasis: {
              scale: false,
              lineStyle: {
                width: 4,
                shadowColor: 'rgba(255, 77, 79, 0.8)',
                shadowBlur: 8,
                shadowOffsetY: 2,
              },
            },
            showSymbol: false,
            hoverAnimation: true,
            triggerLineEvent: true,
            triggerEmphasis: false, // 🎯 关键：禁用被axisPointer自动强调
          },
          // === 透明辅助线B ===
          {
            name: '趋势线B', // 🎯 关键：同名！
            type: 'line',
            data: data2, // 🎯 关键：同数据！
            smooth: true,
            lineStyle: {
              width: 12, // 🚀 6倍宽度用于hover检测
              color: 'transparent', // 👻 完全透明
              opacity: 0,
            },
            itemStyle: {
              color: 'transparent',
              opacity: 0,
            },
            showInLegend: false, // 🚫 不显示在图例中
            showSymbol: false,
            hoverAnimation: false,
            triggerLineEvent: true,
            triggerEmphasis: false, // 🎯 关键：禁用被axisPointer自动强调
            z: -1, // 🎯 底层，不遮挡其他元素
          },
        ],
      };

      // 设置图表配置
      myChart.setOption(option);

      // 🎯 检测是否为移动设备
      const isMobile =
        /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent
        ) || window.innerWidth <= 768;

      let currentHighlighted = null; // 记录当前高亮的系列

      // 🎯 关键事件处理：实现精确的hover联动
      myChart.on('mouseover', function (params) {
        if (isMobile) return; // 移动端跳过hover事件

        console.log('🎯 Hover事件触发:', params.seriesName);

        if (params.seriesName) {
          // 高亮所有同名系列（原始线条会被高亮）
          myChart.dispatchAction({
            type: 'highlight',
            seriesName: params.seriesName,
          });

          // 同时高亮图例
          myChart.dispatchAction({
            type: 'legendHighlight',
            name: params.seriesName,
          });

          // 在页面上显示提示
          showHoverInfo(params.seriesName, isMobile ? '点击高亮' : '高亮');
        }
      });

      myChart.on('mouseout', function (params) {
        if (isMobile) return; // 移动端跳过hover事件

        console.log('🔄 Mouse离开:', params.seriesName);

        if (params.seriesName) {
          // 取消高亮
          myChart.dispatchAction({
            type: 'downplay',
            seriesName: params.seriesName,
          });

          myChart.dispatchAction({
            type: 'legendDownplay',
            name: params.seriesName,
          });

          // 清除提示
          showHoverInfo(params.seriesName, '恢复');
        }
      });

      // 🎯 点击事件处理（PC端和移动端）
      myChart.on('click', function (params) {
        console.log('📱 点击事件触发:', params.seriesName, '移动端:', isMobile);

        if (params.seriesName) {
          // 点击到了线条
          if (isMobile) {
            // 移动端：点击切换高亮状态
            if (currentHighlighted === params.seriesName) {
              // 当前系列已高亮，取消高亮
              myChart.dispatchAction({
                type: 'downplay',
                seriesName: params.seriesName,
              });
              myChart.dispatchAction({
                type: 'legendDownplay',
                name: params.seriesName,
              });
              currentHighlighted = null;
              showMobileInfo(params.seriesName, '取消高亮');
            } else {
              // 先清除之前的高亮
              if (currentHighlighted) {
                myChart.dispatchAction({
                  type: 'downplay',
                  seriesName: currentHighlighted,
                });
                myChart.dispatchAction({
                  type: 'legendDownplay',
                  name: currentHighlighted,
                });
              }

              // 高亮新的系列
              myChart.dispatchAction({
                type: 'highlight',
                seriesName: params.seriesName,
              });
              myChart.dispatchAction({
                type: 'legendHighlight',
                name: params.seriesName,
              });
              currentHighlighted = params.seriesName;
              showMobileInfo(params.seriesName, '点击高亮');
            }
          } else {
            // PC端：点击选中图例
            myChart.dispatchAction({
              type: 'legendToggleSelect',
              name: params.seriesName,
            });
            showHoverInfo(params.seriesName, '图例切换');
          }
        } else if (isMobile && currentHighlighted) {
          // 移动端：点击空白区域，取消当前高亮
          myChart.dispatchAction({
            type: 'downplay',
            seriesName: currentHighlighted,
          });
          myChart.dispatchAction({
            type: 'legendDownplay',
            name: currentHighlighted,
          });
          showMobileInfo(currentHighlighted, '取消高亮');
          currentHighlighted = null;
        }
      });

      // 显示hover状态信息（PC端）
      function showHoverInfo(seriesName, action) {
        const info = document.querySelector('.highlight');
        if (action === '高亮' || action === '点击高亮') {
          info.innerHTML = `✨ <strong>${seriesName}</strong> 正在高亮显示！`;
          info.style.background = '#d4edda';
          info.style.borderColor = '#c3e6cb';
          info.style.color = '#155724';
        } else if (action === '图例切换') {
          info.innerHTML = `🔄 <strong>${seriesName}</strong> 图例状态已切换！`;
          info.style.background = '#e3f2fd';
          info.style.borderColor = '#bbdefb';
          info.style.color = '#1565c0';
        } else {
          info.innerHTML = isMobile
            ? '📱 <strong>移动端</strong>：点击线条附近→高亮切换！再次点击→取消高亮！点击空白→取消'
            : '💡 <strong>PC端</strong>：鼠标hover线条附近→高亮 / 十字线经过→不高亮！';
          info.style.background = '#fff3cd';
          info.style.borderColor = '#ffeaa7';
          info.style.color = '#856404';
        }
      }

      // 显示移动端状态信息
      function showMobileInfo(seriesName, action) {
        const info = document.querySelector('.highlight');
        if (action === '点击高亮') {
          info.innerHTML = `📱 <strong>${seriesName}</strong> 已高亮！再次点击可取消`;
          info.style.background = '#d4edda';
          info.style.borderColor = '#c3e6cb';
          info.style.color = '#155724';
        } else if (action === '取消高亮') {
          info.innerHTML = `📱 <strong>${seriesName}</strong> 高亮已取消！点击其他线条可高亮`;
          info.style.background = '#f8d7da';
          info.style.borderColor = '#f5c6cb';
          info.style.color = '#721c24';
        }
      }

      // 响应式处理
      window.addEventListener('resize', function () {
        myChart.resize();
      });

      // 添加说明文字
      console.log('📊 Demo加载完成！');
      console.log('🎯 测试要点：');
      if (isMobile) {
        console.log('📱 移动端模式：');
        console.log('1. 点击线条附近 → 高亮切换');
        console.log('2. 再次点击同一线条 → 取消高亮');
        console.log('3. 点击其他线条 → 切换到新线条高亮');
        console.log('4. 点击空白区域 → 取消当前高亮');
      } else {
        console.log('💻 PC端模式：');
        console.log('1. 鼠标hover线条附近 → 线条高亮');
        console.log('2. 十字线经过数据点 → 线条不高亮');
        console.log('3. 鼠标离开 → 恢复正常');
      }
      console.log('5. 透明辅助线扩大了交互检测范围（12px）');

      // 🎯 初始化提示信息
      showHoverInfo('', '初始化');
    </script>
  </body>
</html>
